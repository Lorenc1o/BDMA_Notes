<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>INFOH417 - Database Systems Architecture</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<!-- html --> 
<meta name="src" content="summary.tex"> 
<link rel="stylesheet" type="text/css" href="summary.css"> 
</head><body 
>
   <div class="maketitle">
                                                                                            
                                                                                            
                                                                                            
                                                                                            

<h2 class="titleHead">INFOH417 - Database Systems Architecture</h2>
 <div class="author" ><span 
class="ecrm-1200">Jose Antonio Lorencio Abril</span></div><br />
<div class="date" ><span 
class="ecrm-1200">Fall 2022</span></div>
   </div>
<div class="center" 
>
<!--l. 79--><p class="noindent" >
<!--l. 80--><p class="noindent" ><img 
src="0_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___x-Universit___libre_de_Bruxelles__logo__svg.png" alt="PIC"  
width="7" height="7" >
</div>
                                                                                            <div class="flushright" 
>
<!--l. 83--><p class="noindent" >
 Professor: Mahmoud Sakr
</div>
                                                                                            <div class="flushright" 
>
<!--l. 87--><p class="noindent" >
 Student e-mail: jose.lorencio.abril@ulb.be
</div>
<!--l. 91--><p class="indent" >
                                                                                            
                                                                                            
<!--l. 98--><p class="noindent" >This
is
a
summary
of
the
course
<span 
class="ecti-1000">Database</span>
<span 
class="ecti-1000">Systems</span>
<span 
class="ecti-1000">Architecture</span>,
taught
at
the
Université
Libre
de
Bruxelles
by
Professor
Mahmoud
Sakr
in
the
academic
year
22/23.
Most
of
the
content
of
this
document
is
adapted
from
the
course
notes
by
Sakr,
<span class="cite">[<a 
href="#XSakr2022">3</a>]</span>,
so
I
won&#8217;t
be
citing
it
all
the
time.
Other
references
will
be
provided
                                                                                            
                                                                                            
when
used.
<!--l. 100--><p class="indent" >
                                                                                            
                                                                                            
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="partToc" >I&#x00A0;&#x00A0;<a 
href="#x1-4000I" id="QQ2-1-4">Query Planning: Translating SQL into Relational Algebra</a></span>
<br />   &#x00A0;<span class="sectionToc" >1 <a 
href="#x1-50001" id="QQ2-1-5">Relational Algebra</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >1.1 <a 
href="#x1-60001.1" id="QQ2-1-6">The extended relational algebra</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >1.2 <a 
href="#x1-70001.2" id="QQ2-1-7">Relational algebra expressions</a></span>
<br />   &#x00A0;<span class="sectionToc" >2 <a 
href="#x1-80002" id="QQ2-1-8">Translating SQL into Relational Algebra</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >2.1 <a 
href="#x1-90002.1" id="QQ2-1-9">SELECT-FROM-WHERE statemets without subqueries</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >2.2 <a 
href="#x1-100002.2" id="QQ2-1-10">Normalizing WHERE-subqueries into EXISTS and NOT EXISTS form</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >2.3 <a 
href="#x1-110002.3" id="QQ2-1-11">Translating SELECT-FROM-WHERE subqueries</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >2.4 <a 
href="#x1-120002.4" id="QQ2-1-12">De-correlation of subqueries appearing in a conjunctive WHERE condition</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >2.5 <a 
href="#x1-170002.5" id="QQ2-1-17">Flattening subqueries in bag-based relations</a></span>
<br />   <span class="partToc" >II&#x00A0;&#x00A0;<a 
href="#x1-18000II" id="QQ2-1-18">Query Optimization</a></span>
<br />   &#x00A0;<span class="sectionToc" >3 <a 
href="#x1-190003" id="QQ2-1-19">System-R</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x1-200003.1" id="QQ2-1-20">Architecture Components</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x1-210003.2" id="QQ2-1-22">Query language</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.3 <a 
href="#x1-250003.3" id="QQ2-1-27">Catalogues</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.4 <a 
href="#x1-260003.4" id="QQ2-1-28">Cursors</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.5 <a 
href="#x1-270003.5" id="QQ2-1-29">Clustering images</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.6 <a 
href="#x1-280003.6" id="QQ2-1-30">Optimizer</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >3.7 <a 
href="#x1-320003.7" id="QQ2-1-34">PostgreSQL in relation to System R</a></span>
<br />   &#x00A0;<span class="sectionToc" >4 <a 
href="#x1-330004" id="QQ2-1-35">Query Optimization</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.1 <a 
href="#x1-340004.1" id="QQ2-1-36">Cost-based query optimization</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.2 <a 
href="#x1-350004.2" id="QQ2-1-37">Viewing query evaluation plans</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.3 <a 
href="#x1-360004.3" id="QQ2-1-38">Generating equivalent expressions</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.4 <a 
href="#x1-370004.4" id="QQ2-1-39">Enumeration of equivalent expressions</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.5 <a 
href="#x1-380004.5" id="QQ2-1-40">Cost estimation</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >4.6 <a 
href="#x1-390004.6" id="QQ2-1-41">Choice of execution plan</a></span>
<br />   &#x00A0;<span class="sectionToc" >5 <a 
href="#x1-440005" id="QQ2-1-48">Statistics for cost estimation</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >5.1 <a 
href="#x1-450005.1" id="QQ2-1-49">Histograms</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >5.2 <a 
href="#x1-460005.2" id="QQ2-1-50">Estimation of selection size</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >5.3 <a 
href="#x1-470005.3" id="QQ2-1-51">Estimation of the size of joins</a></span>
<br />   <span class="partToc" >III&#x00A0;&#x00A0;<a 
href="#x1-48000III" id="QQ2-1-52">Indexing</a></span>
<br />   &#x00A0;<span class="sectionToc" >6 <a 
href="#x1-490006" id="QQ2-1-53">Conventional indexes</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >6.1 <a 
href="#x1-500006.1" id="QQ2-1-54">Sparse second level index</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >6.2 <a 
href="#x1-510006.2" id="QQ2-1-55">How to deal with duplicate keys.</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >6.3 <a 
href="#x1-520006.3" id="QQ2-1-56">How to delete records</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >6.4 <a 
href="#x1-550006.4" id="QQ2-1-59">How to insert records</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >6.5 <a 
href="#x1-560006.5" id="QQ2-1-60">Secondary indexes</a></span>
<br />   &#x00A0;<span class="sectionToc" >7 <a 
href="#x1-580007" id="QQ2-1-62">B-Trees</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >7.1 <a 
href="#x1-590007.1" id="QQ2-1-64">Lookup in BTree</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >7.2 <a 
href="#x1-600007.2" id="QQ2-1-65">Range queries</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >7.3 <a 
href="#x1-610007.3" id="QQ2-1-66">Insertion into a BTree</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >7.4 <a 
href="#x1-620007.4" id="QQ2-1-67">Deletion from a BTree</a></span>
<br />   <span class="partToc" >IV&#x00A0;&#x00A0;<a 
href="#x1-63000IV" id="QQ2-1-68">Physical Query Plans</a></span>
<br />   &#x00A0;<span class="sectionToc" >8 <a 
href="#x1-640008" id="QQ2-1-69">Physical Query Plans</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >8.1 <a 
href="#x1-650008.1" id="QQ2-1-70">Computing joins</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >8.2 <a 
href="#x1-660008.2" id="QQ2-1-75">Factors that affect performance</a></span>
<br />   <span class="partToc" >V&#x00A0;&#x00A0;<a 
href="#x1-72000V" id="QQ2-1-81">Extensibility</a></span>
<br />   &#x00A0;<span class="sectionToc" >9 <a 
href="#x1-730009" id="QQ2-1-82">Extensible databases: PostgreSQL</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >9.1 <a 
href="#x1-740009.1" id="QQ2-1-83">Types</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >9.2 <a 
href="#x1-800009.2" id="QQ2-1-89">Functions</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >9.3 <a 
href="#x1-860009.3" id="QQ2-1-95">Procedures</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >9.4 <a 
href="#x1-870009.4" id="QQ2-1-96">Interfacing extensions to indexes</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >9.5 <a 
href="#x1-880009.5" id="QQ2-1-97">Steps to create a PostgreSQL extension</a></span>
                                                                                            
                                                                                            
<br />   <span class="partToc" >VI&#x00A0;&#x00A0;<a 
href="#x1-89000VI" id="QQ2-1-98">Failure Recovery and concurrency control</a></span>
<br />   &#x00A0;<span class="sectionToc" >10 <a 
href="#x1-9000010" id="QQ2-1-99">Failure recovery</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >10.1 <a 
href="#x1-9100010.1" id="QQ2-1-100">Key problem: unfinished transactions</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >10.2 <a 
href="#x1-9200010.2" id="QQ2-1-101">Logging</a></span>
<br />   &#x00A0;<span class="sectionToc" >11 <a 
href="#x1-10000011" id="QQ2-1-111">Concurrency control</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >11.1 <a 
href="#x1-10100011.1" id="QQ2-1-112">Schedules: serial, serializable and conflict-serializable</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >11.2 <a 
href="#x1-10400011.2" id="QQ2-1-115">How to enforce serializability: locking</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >11.3 <a 
href="#x1-10700011.3" id="QQ2-1-118">Shared locks</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >11.4 <a 
href="#x1-10800011.4" id="QQ2-1-119">More types of locks</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >11.5 <a 
href="#x1-11100011.5" id="QQ2-1-122">Lock granularity</a></span>
<br />   <span class="partToc" >VII&#x00A0;&#x00A0;<a 
href="#x1-112000VII" id="QQ2-1-123">Distributed Databases</a></span>
<br />   &#x00A0;<span class="sectionToc" >12 <a 
href="#x1-11300012" id="QQ2-1-124">Distributed databases</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.1 <a 
href="#x1-11400012.1" id="QQ2-1-125">Data distribution</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.2 <a 
href="#x1-11500012.2" id="QQ2-1-126">Distributed data access: distributed SQL</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.3 <a 
href="#x1-12000012.3" id="QQ2-1-131">Distributed transactions</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.4 <a 
href="#x1-12400012.4" id="QQ2-1-135">Replication</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.5 <a 
href="#x1-12800012.5" id="QQ2-1-139">CAP theorem</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.6 <a 
href="#x1-12900012.6" id="QQ2-1-140">PACELC theorem</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc" >12.7 <a 
href="#x1-13000012.7" id="QQ2-1-141">More trade-offs</a></span>
   </div>
<!--l. 104--><p class="indent" >
                                                                                            
                                                                                            
   <h3 class="likesectionHead"><a 
 id="x1-2000"></a>List of Figures</h3>
   <div class="tableofcontents"><span class="lofToc" >1&#x00A0;<a 
href="#x1-20001r1">Architecture of System R</a></span><br /><span class="lofToc" >2&#x00A0;<a 
href="#x1-22008r2">Result of the program. Stored data in EMP
(left). Active Set (right). </a></span><br /><span class="lofToc" >3&#x00A0;<a 
href="#x1-42001r3">A left-deep join tree (top) and not a left-deep join
tree (bottom).</a></span><br /><span class="lofToc" >4&#x00A0;<a 
href="#x1-58001r4">A BTree. Source: [2].</a></span><br />
   </div>
<!--l. 108--><p class="noindent" >
   <h3 class="likesectionHead"><a 
 id="x1-3000"></a>List of Algorithms</h3>
   <div class="tableofcontents">
   1 <a 
href="#x1-41017r1"><span 
class="ecbx-1000">procedure </span>findbestplan(S)</a>
<br />   2 <a 
href="#x1-65005r2">Iteration Join</a>
<br />   3 <a 
href="#x1-65023r3">Merge Join</a>
<br />   4 <a 
href="#x1-65028r4">Index Join</a>
<br />   5 <a 
href="#x1-65034r5">Hash Join (k buckets G1...Gk, H1...Hk)</a>
<br />   6 <a 
href="#x1-94016r6">Undo logging: recovery rules</a>
<br />   7 <a 
href="#x1-95019r7">Redo logging: recovery rules</a>
   </div>
<!--l. 110--><p class="indent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;I<br /></span><a 
 id="x1-4000I"></a>Query Planning: Translating SQL into Relational Algebra</h1>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-50001"></a>Relational Algebra</h3>
<!--l. 116--><p class="noindent" >We are going to start with some definitions:
   <div class="tcolorbox tcolorbox" id="tcolobox-1">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 119--><p class="noindent" ><span class="head">
<a 
 id="x1-5001r1"></a>
<span 
class="ecbx-1000">Definition 1.1.</span>   </span>A  <span 
class="ecbx-1000">relation </span>is  a  table  whose  columns  have  names,  called  <span 
class="ecbx-1000">attributes</span>.  The  set  of
all attributes is called the <span 
class="ecbx-1000">schema of the relation</span>. The rows of the table are tuples of values for
each of the attributes, and are called simply <span 
class="ecbx-1000">tuples</span>. We are going to denote <span 
class="cmmi-10">R </span>a relation, and we
will  express  it  as  <span 
class="cmmi-10">R  </span><span 
class="cmsy-10">~ </span><img 
src="summary0x.png" alt="[A1,...,An]"  class="left" align="middle">  to  indicate  the  schema  of  the  relation,  <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,i </span><span 
class="cmr-10">=  1</span><span 
class="cmmi-10">,...,n </span>are  the
attributes of the schema. If two relations, <span 
class="cmmi-10">R </span>and <span 
class="cmmi-10">R</span><span 
class="cmsy-10">&#x2032;</span>, share the same schema, we will simply write <span 
class="cmmi-10">R </span><span 
class="cmsy-10">&#x2243;</span>
<span 
class="cmmi-10">R</span><span 
class="cmsy-10">&#x2032;</span><span class="footnote-mark"><a 
href="summary2.html#fn1x2"><sup class="textsuperscript">a</sup></a></span><a 
 id="x1-5002f0"></a> .
<!--l. 130--><p class="noindent" >A relation is <span 
class="ecbx-1000">set-based </span>if there are no duplicate tuples in it. If this is not the case, the relation is
<span 
class="ecbx-1000">bag-based</span>.
<!--l. 133--><p class="noindent" >A <span 
class="ecbx-1000">relational algebra operator </span>takes as input 1 or more relations and produces as output a new
relation. More formally, if we have a set of relations <span 
class="cmr-10">&#x03A3; = </span><img 
src="summary1x.png" alt="{R ,...,R }
  1     n"  class="left" align="middle"><span 
class="cmsy-10">&#x2282;<img 
src="cmsy10-55.png" alt="U" class="10x-x-55" /></span>, where <span 
class="cmsy-10"><img 
src="cmsy10-55.png" alt="U" class="10x-x-55" /> </span>identifies the set of
all possible relations, a relational algebra operator is a function
<div class="math-display" >
<img 
src="summary2x.png" alt="Op : P (&#x03A3;) &#x2192; U,
" class="math-display" ></div>
<!--l. 141--><p class="noindent" >being <span 
class="cmsy-10"><img 
src="cmsy10-50.png" alt="P" class="10x-x-50" /></span><img 
src="summary3x.png" alt="(&#x03A3;)"  class="left" align="middle"> the power set of <span 
class="cmr-10">&#x03A3;</span>.
</div>
<!--l. 142--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 145--><p class="noindent" ><span class="head">
<a 
 id="x1-5003r1"></a>
<span 
class="ecbx-1000">Example 1.1.</span>  </span>As an example, we can take <span 
class="cmr-10">&#x03A3; = </span><img 
src="summary4x.png" alt="{StarsIn,M ovieStar}"  class="left" align="middle">, <span 
class="cmmi-10">StartsIn </span><span 
class="cmr-10">= </span><img 
src="summary5x.png" alt="[starN ame,filmN  ame]"  class="left" align="middle">,
<span 
class="cmmi-10">MovieStar </span><span 
class="cmr-10">= </span><img 
src="summary6x.png" alt="[name, birthDate]"  class="left" align="middle">. In this case, an operator <span 
class="cmmi-10">Op </span>could be such that produces the relation that
contains all names of films in which some movie stars in <span 
class="cmmi-10">MovieStar </span>born in 1960 participated.
   </div>
<!--l. 151--><p class="indent" >
In this example, we have explained what we would like our operator to do, but we need some way to
actually compute this. For this, there are some basic operators that can be combined to create complex
operators.
                                                                                            
                                                                                            
<!--l. 156--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-60001.1"></a>The extended relational algebra</h4>
<!--l. 158--><p class="noindent" >Let&#8217;s define a set of operators that are useful:
<!--l. 160--><p class="indent" >   The <span 
class="ecbx-1000">union </span>of two relations with the same schema returns another relation with the same schema and all tuples in
any of the two input relations: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>such that <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub> <span 
class="cmsy-10">&#x2243; </span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">j</span></sub>, then
   <div class="math-display" >
<img 
src="summary7x.png" alt="Ri &#x222A; Rj = {x|x &#x2208; Ri &#x2228; x &#x2208; Rj} &#x2243; Ri &#x2243; Rj.
" class="math-display" ></div>
<!--l. 168--><p class="indent" >   Note, nonetheless, that the result of the operator <span 
class="cmsy-10">&#x222A; </span>is different in set-based relations than in bag-based
relations.
   <div class="newtheorem">
<!--l. 170--><p class="noindent" ><span class="head">
<a 
 id="x1-6001r2"></a>
<span 
class="ecbx-1000">Example 1.2.</span>  </span>An example of the operator <span 
class="cmsy-10">&#x222A;</span>:
<!--l. 173--><p class="indent" >
   <div class="math-display" >
<img 
src="summary8x.png" alt="                        (            bag-based )
                        ||| &#x230A;set-based&#x230B; &#x230A; A   B &#x230B; |||
&#x230A;  A  B &#x230B;    &#x230A;       &#x230B;  ||||   A   B   |  1  2 | ||||
|  1  2 | &#x22C3;    A  B     |{ ||  1  2 || ||  3  4 || |}
|&#x2308;  3  4 |&#x2309;    &#x2308; 3  4  &#x2309; = | || 3  4 ||,||  5  6 || |
   5  6        1  5     |||| &#x2308;  5  6 &#x2309; |&#x2308;  1  5 |&#x2309; ||||
                        |||(    1  5      3  4   |||)
" class="math-display" ></div>
   </div>
<!--l. 198--><p class="indent" >
The <span 
class="ecbx-1000">intersection </span>of two relations with the same schema returns another relation with the same schema and all tuples
in both of the two input relations: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>such that <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub> <span 
class="cmsy-10">&#x2243; </span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">j</span></sub>, then
   <div class="math-display" >
<img 
src="summary9x.png" alt="Ri &#x2229; Rj = {x|x &#x2208; Ri &#x2227; x &#x2208; Rj} &#x2243; Ri &#x2243; Rj.
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 207--><p class="noindent" ><span class="head">
<a 
 id="x1-6002r3"></a>
<span 
class="ecbx-1000">Example 1.3.</span>  </span>An example of the operator <span 
class="cmsy-10">&#x2229;</span>:
   <div class="math-display" >
<img 
src="summary10x.png" alt="&#x230A;       &#x230B;   &#x230A;       &#x230B;
| A   B | &#x22C2;   A   B     [       ]
|&#x2308;  1  2 |&#x2309;   &#x2308;  3  4 &#x2309; =   A  B   .
   3  4        1  5       3   4
   5  6
" class="math-display" ></div>
   </div>
<!--l. 224--><p class="indent" >
The <span 
class="ecbx-1000">difference </span>of two relations with the same schema returns another relation with the same schema and all tuples in
the first input relations which don&#8217;t appear in the second input relation: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>such that <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub> <span 
class="cmsy-10">&#x2243; </span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">j</span></sub>,
then
   <div class="math-display" >
<img 
src="summary11x.png" alt="Ri - Rj = {x|x &#x2208; Ri &#x2227; x &#x2215;&#x2208; Rj } &#x2243; Ri &#x2243; Rj.
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 233--><p class="noindent" ><span class="head">
<a 
 id="x1-6003r4"></a>
<span 
class="ecbx-1000">Example 1.4.</span>  </span>An example of the operator <span 
class="cmsy-10">-</span>:
   <div class="math-display" >
<img 
src="summary12x.png" alt="&#x230A;       &#x230B;
  A   B     &#x230A; A  B  &#x230B;   &#x230A; A  B  &#x230B;
|| 1   2 || - &#x2308; 3   4 &#x2309; = &#x2308; 1  2  &#x2309;.
&#x2308; 3   4 &#x2309;     1   5       5  6
  5   6
" class="math-display" ></div>
   </div>
<!--l. 251--><p class="indent" >
The <span 
class="ecbx-1000">selection </span>operator applies a condition on the values of the tuples of the input relation and returns only those
tuples that fullfil the condition: Let <span 
class="cmmi-10">R </span><span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>and <span 
class="cmmi-10">P </span>a condition, then
   <div class="math-display" >
<img 
src="summary13x.png" alt="&#x03C3;P (R) = {x|x &#x2208; R &#x2227; P (R) == true}.
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 260--><p class="noindent" ><span class="head">
<a 
 id="x1-6004r5"></a>
<span 
class="ecbx-1000">Example 1.5.</span>  </span>An example of the operator <span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmmi-7">P</span></sub>:
   <div class="math-display" >
<img 
src="summary14x.png" alt="    ( &#x230A;       &#x230B;)
        A   B       &#x230A; A  B  &#x230B;
&#x03C3;A&#x2265;3|| ||  1  2 ||||  = &#x2308; 3   4 &#x2309;.
    ( &#x2308;  3  4 &#x2309;)      5   6
         5  6
" class="math-display" ></div>
<!--l. 274--><p class="indent" >   In this case, the condition <span 
class="cmmi-10">P </span>is: &#8217;<span 
class="ecti-1000">the value of </span><span 
class="cmmi-10">A </span><span 
class="ecti-1000">is bigger than or equal than 3</span>&#8217;.
   </div>
<!--l. 276--><p class="indent" >
The <span 
class="ecbx-1000">projection </span>operator returns all tuples of the input relation, but deleting all unspecified attributes: Let <span 
class="cmmi-10">R </span><span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>and
<span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">j</span><sub><span 
class="cmr-5">1</span></sub></sub><span 
class="cmmi-10">,...,A</span><sub><span 
class="cmmi-7">j</span><sub><span 
class="cmmi-5">k</span></sub></sub> <span 
class="cmsy-10">&#x2208;</span><img 
src="summary15x.png" alt="[A ,...,A  ]
  1     n"  class="left" align="middle"> <span 
class="cmsy-10">~ </span><span 
class="cmmi-10">R</span>, then
   <div class="math-display" >
<img 
src="summary16x.png" alt="                 &#x2032;
&#x03A0;Aj1,...,Ajk (R ) = R [Aj1,...,Aj] = {y|&#x2203;x &#x2208; R s.t.x(Aj1,...,Ajk) = y}.
                        k
" class="math-display" ></div>
<!--l. 284--><p class="indent" >   The result of this operation also depends on the type of relations used.
   <div class="newtheorem">
<!--l. 286--><p class="noindent" ><span class="head">
<a 
 id="x1-6005r6"></a>
<span 
class="ecbx-1000">Example 1.6.</span>  </span>An example of the operator <span 
class="cmr-10">&#x03A0;</span><sub><img 
src="summary17x.png" alt="[Aj ,...,Aj ]
  1    k"  class="left" align="middle"></sub>:
   <div class="math-display" >
<img 
src="summary18x.png" alt="                          (                    )
    ( &#x230A;              &#x230B;)   || &#x230A;set-based&#x230B; &#x230A;bag-based&#x230B;||
    | | A   B  C  D  ||   ||||   A   C   | A   C |||||
    || || 1   2  3   5 ||||   { ||  1  3 || ||  1  3 ||}
&#x03A0;A,C|( |&#x2308; 3   4  3   6 |&#x2309;|) = || &#x2308;  3  3 &#x2309;,|&#x2308;  3  3 |&#x2309;||  .
        5   6  5   9      ||||    5  5      5  5  ||||
        1   6  3   5      (              1  3  )
" class="math-display" ></div>
   </div>
<!--l. 308--><p class="indent" >
The <span 
class="ecbx-1000">cartesian product </span>of two relations with disjoint schemas returns a relation with the schema resulting of
combining both schemas and with all possible tuples made out of tuples from the first relation and tuples from the
second relation: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>such that their schemas are disjoint, then
   <div class="math-display" >
<img 
src="summary19x.png" alt="Ri &#x00D7; Rj = {z = (x,y)|x &#x2208; Ri &#x2227; y &#x2208; Rj }.
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 318--><p class="noindent" ><span class="head">
<a 
 id="x1-6006r7"></a>
<span 
class="ecbx-1000">Example 1.7.</span>  </span>An example of the operator <span 
class="cmsy-10">&#x00D7;</span>:
   <div class="math-display" >
<img 
src="summary20x.png" alt="                        &#x230A;              &#x230B;
                          A   B  C   D
&#x230A;        &#x230B;  &#x230A; C   D &#x230B;   ||  1  2  2   6 ||
   A  B     |  2  6 |   ||  1  2  3   7 ||
&#x2308;  1  2  &#x2309;&#x00D7; |&#x2308;  3  7 |&#x2309; = ||  1  2  4   9 || .
   3  4        4  9     ||  3  4  2   6 ||
                        &#x2308;  3  4  3   7 &#x2309;
                           3  4  4   9
" class="math-display" ></div>
   </div>
<!--l. 340--><p class="indent" >
The <span 
class="ecbx-1000">natural join </span>of two tuples whose schemas share at most one attribute returns a relation with the schema resulting
of combining both schemas and with all possible tuples made out of tuples from the first relation and tuples from the
second relation with the condition that they have the same value for the shared attribute: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>such that
their schemas share at most one attribute, <span 
class="cmmi-10">A</span>, then
   <div class="math-display" >
<img 
src="summary21x.png" alt="Ri &#x22B3;&#x22B2; Rj = {z = (x,y)|x &#x2208; Ri &#x2227; y &#x2208; Rj &#x2227; x(A) = y (A)}.
" class="math-display" ></div>
<!--l. 351--><p class="indent" >   Note that if the relations are disjoint, the natural join gives the same results as the cartesian product.
   <div class="newtheorem">
<!--l. 353--><p class="noindent" ><span class="head">
<a 
 id="x1-6007r8"></a>
<span 
class="ecbx-1000">Example 1.8.</span>  </span>An example of the operator <img 
src="summary22x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" >:
   <div class="math-display" >
<img 
src="summary23x.png" alt="            &#x230A;       &#x230B;
&#x230A; A   B &#x230B;     B   D     &#x230A; A   B  D  &#x230B;
&#x2308; 1   2 &#x2309; &#x22B3;&#x22B2; || 2   6 || = &#x2308; 1   2  6  &#x2309;.
  3   4     &#x2308; 3   7 &#x2309;     3   4  9
              4   9
" class="math-display" ></div>
   </div>
<!--l. 371--><p class="indent" >
The <span 
class="ecbx-1000">theta join </span>of two relations given a condition <span 
class="cmmi-10">P </span>returns all the tuples in the cartesian product of the two relations
that fullfil the condition <span 
class="cmmi-10">P</span>: Let <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3; </span>and <span 
class="cmmi-10">P </span>a condition, then
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary24x.png" alt="R &#x22B3;&#x22B2;  R  = {x|x &#x2208; R &#x00D7; R  &#x2227;  P (x) == true} = &#x03C3; (R &#x00D7; R ).
 i  P  j          i    j                   P   i   j
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 380--><p class="noindent" ><span class="head">
<a 
 id="x1-6008r9"></a>
<span 
class="ecbx-1000">Example 1.9.</span>  </span>An example of the operator <img 
src="summary25x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><sub><span 
class="cmmi-7">P</span></sub>:
   <div class="math-display" >
<img 
src="summary26x.png" alt="                &#x230A;       &#x230B;
&#x230A;        &#x230B;        C   D     &#x230A;              &#x230B;
&#x2308;  A  B  &#x2309;      ||  2  6 ||   &#x2308; A   B  C   D &#x2309;
   1  2   &#x22B3;&#x22B2;B=C &#x2308;  3  7 &#x2309; =    1  2  2   6   .
   3  4            4  9        3  4  4   9
" class="math-display" ></div>
   </div>
<!--l. 398--><p class="indent" >
The <span 
class="ecbx-1000">left/right/full outer join </span>operators are similar to the theta join, but for those tuples in the left/right/both
relation that does not find a match in the other relation, it returns a new tuples with the values of the tuple and the
rest of the attributes empty.
   <div class="newtheorem">
<!--l. 403--><p class="noindent" ><span class="head">
<a 
 id="x1-6009r10"></a>
<span 
class="ecbx-1000">Example 1.10.</span>  </span>An example of <span 
class="cmr-10">=</span> <img 
src="summary27x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">,</span><span 
class="cmmi-10">&#x00A0;</span><img 
src="summary28x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" > <span 
class="cmr-10">=</span><span 
class="cmmi-10">,</span><span 
class="cmr-10">=</span> <img 
src="summary29x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" > <span 
class="cmr-10">=</span>:
   <div class="math-display" >
<img 
src="summary30x.png" alt="&#x230A; A   B &#x230B;        &#x230A; C   D &#x230B;   &#x230A;  A  B  C   D &#x230B;
|  1  2 |        |  2  6 |   |  1  2   2  6 |
|&#x2308;  3  4 |&#x2309; =&#x22B3;&#x22B2;B=C |&#x2308;  3  7 |&#x2309; = |&#x2308;  3  4   4  9 |&#x2309;
   5  5             4  9        5  5
" class="math-display" ></div>
<!--l. 423--><p class="indent" >
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary31x.png" alt="&#x230A; A   B &#x230B;        &#x230A; C   D &#x230B;   &#x230A;  A  B  C   D &#x230B;
|  1  2 |        |  2  6 |   |  1  2   2  6 |
|&#x2308;  3  4 |&#x2309; &#x22B3;&#x22B2;=B=C |&#x2308;  3  7 |&#x2309; = |&#x2308;  3  4   4  9 |&#x2309;
   5  5             4  9               3  7
" class="math-display" ></div>
<!--l. 441--><p class="indent" >
   <div class="math-display" >
<img 
src="summary32x.png" alt="                               &#x230A;              &#x230B;
&#x230A;  A  B &#x230B;          &#x230A; C   D &#x230B;     A   B  C  D
|  1  2 |          |  2  6 |   || 1   2  2   6 ||
|&#x2308;  3  4 |&#x2309; = &#x22B3;&#x22B2;=B=C  |&#x2308;  3  7 |&#x2309; = || 3   4  4   9 ||
   5  5               4  9     &#x2308; 5   5        &#x2309;
                                        3   7
" class="math-display" ></div>
   </div>
<!--l. 460--><p class="indent" >
The <span 
class="ecbx-1000">renaming operator </span>changes the name of a relation, <span 
class="cmmi-10">&#x03C1;</span><img 
src="summary33x.png" alt="(R )"  class="left" align="middle"> <span 
class="cmr-10">= </span><span 
class="cmmi-10">R</span><span 
class="cmsy-10">&#x2032;</span>. The <span 
class="ecbx-1000">feature rename operator </span>changes the
name of an attribute in a relation, <span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x2192; </span><span 
class="cmmi-10">A</span><span 
class="cmsy-10">&#x2032;</span>.
<!--l. 465--><p class="indent" >   The <span 
class="ecbx-1000">aggregation operator </span>of a relation returns another relation in which the tuples that share the value of the
aggregating attribute are merged using an <span 
class="ecbx-1000">aggregate function</span>: Let <span 
class="cmmi-10">R </span><span 
class="cmsy-10">&#x2208; </span><span 
class="cmr-10">&#x03A3;</span>, with <span 
class="cmmi-10">R </span><span 
class="cmsy-10">~</span><img 
src="summary34x.png" alt="[A ,...,A ,A]
  1    n"  class="left" align="middle">, <span 
class="cmmi-10">A </span>the
aggregating attribute and <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,f</span><sub><span 
class="cmmi-7">n</span></sub> the aggregating functions for the rest of the attributes, then
   <div class="math-display" >
<img 
src="summary35x.png" alt="&#x03B3;              (R ) = {z = (v ,f (AvA ),...f (AvA))|v &#x2208; R (A)},
 A,f1(A1),...,fn(An)           A  1   1     n   n    A
" class="math-display" ></div>
<!--l. 474--><p class="indent" >   where <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">j</span></sub><sup><span 
class="cmmi-7">v</span><sub><span 
class="cmmi-5">A</span></sub></sup> is a short notation for
   <div class="math-display" >
<img 
src="summary36x.png" alt="AvjA= &#x03A0;Aj (&#x03C3;A=vA (R )),
" class="math-display" ></div>
<!--l. 478--><p class="indent" >   i.e. all values in <span 
class="cmmi-10">R</span><img 
src="summary37x.png" alt="(  v )
 A jA"  class="left" align="middle"> such that come from a tuple whose values for the attribute <span 
class="cmmi-10">A </span>is <span 
class="cmmi-10">v</span>.
   <div class="newtheorem">
<!--l. 480--><p class="noindent" ><span class="head">
<a 
 id="x1-6010r11"></a>
<span 
class="ecbx-1000">Example 1.11.</span>  </span>An example of the operator <span 
class="cmmi-10">&#x03B3;</span><sub><span 
class="cmmi-7">A,f</span><sub><span 
class="cmr-5">1</span></sub><img 
src="summary38x.png" alt="(A1)"  class="left" align="middle"><span 
class="cmmi-7">,...,f</span><sub><span 
class="cmmi-5">n</span></sub><img 
src="summary39x.png" alt="(An)"  class="left" align="middle"><img 
src="summary40x.png" alt="(R)"  class="left" align="middle"></sub>:
   <div class="math-display" >
<img 
src="summary41x.png" alt="        &#x230A;       &#x230B;
        |  A  B |   &#x230A;            &#x230B;
        ||  1  2 ||   | A   min (B )|
&#x03B3;A,min(B)||  1  1 || = |&#x2308;  1     1   |&#x2309; .
        |&#x2308;  3  7 |&#x2309;      3     7
           3  9        4     4
           4  4
" class="math-display" ></div>
   </div>
<!--l. 497--><p class="indent" >
<!--l. 499--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-70001.2"></a>Relational algebra expressions</h4>
<!--l. 501--><p class="noindent" >Now, we can build expressions in relational algebra to get new relations from current ones. Let&#8217;s return to Example <a 
href="#x1-5003r1">1.1<!--tex4ht:ref: ex:1-1 --></a>,
we can define the operator <span 
class="cmmi-10">Op </span>such that produces the relation that contains all names of films in which some movie
stars in <span 
class="cmmi-10">MovieStar </span>born in 1960 participated as:
   <div class="math-display" >
<img 
src="summary42x.png" alt="R &#x2032; = Op (M ovieStar,StarsIn ) = &#x03A0;filmName (&#x03C3;birthDate.year=1960(M ovieStar &#x22B3;&#x22B2;name=starName StarsIn)).
" class="math-display" ></div>
<!--l. 510--><p class="indent" >   Relational algebra is the theoretical basis of the <span 
class="ecbx-1000">SQL language</span>, meaning SQL is designed as an implementation of
the relational algebra operators that we have seen so far. The equivalent SQL sentence to the last RA operator, <span 
class="cmmi-10">OP</span>,
is
   <!--l. 515-->
   <div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-7001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">filmName</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7002r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">JOIN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ON</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7004r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">birthDate</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">year</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1960;</span></span></div>
   
                                                                                            
                                                                                            
<!--l. 522--><p class="indent" >   As explained in <span class="cite">[<a 
href="#XSQLtoRA">4</a>]</span>, translating an arbitrary SQL query into a <span 
class="ecbx-1000">logical query plan</span>, or, equivalently, a relational
algebra expression, is a complex task. Let&#8217;s first give some examples.
   <div class="newtheorem">
<!--l. 525--><p class="noindent" ><span class="head">
<a 
 id="x1-7005r12"></a>
<span 
class="ecbx-1000">Example 1.12.</span>  </span>We are going to work with some examples now. Let&#8217;s our database have the following
relations:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 529--><p class="noindent" >Movie(title: string, year: int, length: int, genre: string, studioName: string, producerCERT: int)
     </li>
     <li class="itemize">
     <!--l. 531--><p class="noindent" >MovieStar(name: string, address: string, gender: char, birthdate:date)
     </li>
     <li class="itemize">
     <!--l. 532--><p class="noindent" >StarsIn(movieTitle: string, movieYear: string, starName: string)
     </li>
     <li class="itemize">
     <!--l. 533--><p class="noindent" >MovieExec(name: string, address: string, CERT: int, netWorth: int)
     </li>
     <li class="itemize">
     <!--l. 534--><p class="noindent" >Studio(name: string, address: string, presCERT: int)</li></ul>
<!--l. 536--><p class="noindent" >SQL:
   <!--l. 538-->
   <div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-7006r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">numStars</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7007r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">M</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7008r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">M</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7009r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">GROUP</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 545--><p class="indent" >   RA:
   <div class="math-display" >
<img 
src="summary43x.png" alt="&#x03B3;                                 (&#x03C1; (StarsIn) &#x22B3;&#x22B2;               &#x03C1;  (M ovieStar)).
 M.movieTitle, count(S.starName )&#x2192;numStars S           S.starName=M.name  M
" class="math-display" ></div>
<!--l. 550--><p class="indent" >   SQL: <!--l. 551-->
   <div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-7010r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">numStars</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7011r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">M</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7012r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">M</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7013r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">GROUP</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-7014r5"></a></span><span style="color:#000000"><span 
class="ectt-1000">HAVING</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">5;</span></span></div>
   
<!--l. 559--><p class="indent" >   RA:
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary44x.png" alt="&#x03C3;numStars&#x003E;5 (&#x03B3;M.movieTitle, count(S.starName)&#x2192;numStars (&#x03C1;S (StarsIn) &#x22B3;&#x22B2;S.starName=M.name &#x03C1;M (M ovieStar))).
" class="math-display" ></div>
   </div>
<!--l. 564--><p class="indent" >
At this point, one can understand that it is not easy at all to automatize this procedure of translating from SQL to RA.
Not only the process is not trivial as is, but it is also needed to take into consideration that one SQL sentence can be
translated into several equivalent RA expressions, which will ultimately be executed in a computer and the election of
the translation to execute will affect the efficiency of the program. Let&#8217;s review the paper <span class="cite">[<a 
href="#XSQLtoRA">4</a>]</span>, explaining each of the
translations, assuming set-based relations.
<!--l. 574--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-80002"></a>Translating SQL into Relational Algebra</h3>
<!--l. 576--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-90002.1"></a>SELECT-FROM-WHERE statemets without subqueries</h4>
<!--l. 578--><p class="noindent" >A query of the form:
   <!--l. 580-->
   <div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-9001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-9002r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">T1</span></span><span style="color:#000000"><span 
class="ectt-1000">,...,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Rn</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Tn</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-9003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">condition</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 586--><p class="indent" >   in which the condition does not involve subqueries, we can translate it as
   <div class="math-display" >
<img 
src="summary45x.png" alt="&#x03A0;select-list(&#x03C3;condition(&#x03C1;T1(R1)&#x00D7; ...&#x00D7; &#x03C1;Tn(Rn ))).
" class="math-display" ></div>
<!--l. 593--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-100002.2"></a>Normalizing WHERE-subqueries into EXISTS and NOT EXISTS form</h4>
<!--l. 595--><p class="noindent" >In general, queries in which there are subqueries in the WHERE clause can arise, and they need to be translated, too.
The property used in these cases is that subqueries occurring in the WHERE clause that use the operators
<span 
class="cmr-10">=</span><span 
class="cmmi-10">,&#x003C;,&#x003E;,&#x003C;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">,&#x003E;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">,&#x003C;&#x003E;,EXISTS,IN,NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS,NOT</span><span 
class="cmmi-10">&#x00A0;IN </span>or the quantifiers <span 
class="cmmi-10">ANY </span>or <span 
class="cmmi-10">ALL </span>can all be rewritten to
use the operators <span 
class="cmmi-10">EXISTS </span>and <span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS</span>.
   <div class="tcolorbox tcolorbox" id="tcolobox-2">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 603--><p class="noindent" ><span class="head">
<a 
 id="x1-10001r1"></a>
<span 
class="ecbx-1000">Proposition 2.1.</span>   </span><span 
class="ecti-1000">All  conditions  using  a  subquery  can  be  rewritten  using  only  </span><span 
class="cmmi-10">EXISTS  </span><span 
class="ecti-1000">and</span>
<span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS</span><span 
class="ecti-1000">.</span>
</div>
<!--l. 606--><p class="noindent" >
 
</div> 
</div>
   <div class="proof">
<!--l. 610--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>Let&#8217;s proof some of the results:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 612--><p class="noindent" >The result using the <span 
class="cmmi-10">EXISTS </span>and <span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS </span>operators is obvious.
     </li>
     <li class="itemize">
     <!--l. 613--><p class="noindent" >Case <span 
class="cmr-10">= </span><span 
class="cmmi-10">ANY </span>: a query would look like the following: <!--l. 614-->
     <div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-10002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10003r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10004r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ANY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10005r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10006r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
     
     </li></ul>
<!--l. 622--><p class="noindent" >An equivalent query is: <!--l. 623-->
   <div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-10007r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10008r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10009r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10010r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10011r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 631--><p class="noindent" >Case <span 
class="cmr-10">= </span><span 
class="cmmi-10">ALL</span>:</li></ul>
<!--l. 633-->
   <div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-10012r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10013r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10014r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10015r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10016r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 641--><p class="indent" >   An equivalent query is: <!--l. 642-->
   <div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-10017r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10018r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10019r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">NOT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10020r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10021r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 650--><p class="indent" >   The rest of the cases <span 
class="cmmi-10">binaryOP </span><span 
class="cmr-10">+ </span><span 
class="cmmi-10">ANY </span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">ALL </span>is similar.
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 652--><p class="noindent" >Case <span 
class="cmmi-10">IN</span>:</li></ul>
<!--l. 654-->
   <div class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-10022r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10023r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10024r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">IN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10025r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10026r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
                                                                                            
                                                                                            
<!--l. 662--><p class="indent" >   An equivalent query is: <!--l. 663-->
   <div class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-10027r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10028r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10029r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10030r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10031r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cond</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 671--><p class="indent" >   The case <span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;IN </span>is analogous.                                                                                               __
   </div>
   <div class="newtheorem">
<!--l. 673--><p class="noindent" ><span class="head">
<a 
 id="x1-10032r1"></a>
<span 
class="ecbx-1000">Example 2.1.</span>  </span>Let&#8217;s see some examples from the paper:
<!--l. 676--><p class="indent" >   The query <!--l. 677-->
   <div class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-10033r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10034r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">IN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10035r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10036r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">birthdate</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1960);</span></span></div>
   
<!--l. 683--><p class="indent" >   is equivalent to: <!--l. 684-->
   <div class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-10037r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10038r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10039r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10040r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">birthdate</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1960</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 691--><p class="indent" >   The query
   <!--l. 693-->
   <div class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-10041r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieExec</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10042r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">netWorth</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">E</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">networth</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10043r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieExec</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">E</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 698--><p class="indent" >   is equivalent to: <!--l. 699-->
   <div class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-10044r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieExec</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10045r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">NOT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">E</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">networth</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10046r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieExec</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">E</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10047r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">netWorth</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">E</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">netWorth</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
   </div>
<!--l. 705--><p class="indent" >
Without loss of generality, we can now assume that all subqueries in the where clause are of the form <span 
class="cmmi-10">EXISTS </span>or
<span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS</span>.
<!--l. 709--><p class="indent" >   Now, to translate a query with subqueries, in which an arbitrary number of subqueries inside the subqueries may
arise, it seems logical to proceed recursively. The idea is to translate into RA from inner queries to outer queries. For
subqueries that do not contain more subqueries, we could translate them as in Section <a 
href="#x1-90002.1">2.1<!--tex4ht:ref: subsec:SELECT-FROM-WHERE-statemets-without-SUB --></a>. The problem in this case is
that the subqueries can refer to attributes of relations appearing in the FROM clause of the outer queries. This is
known as <span 
class="ecbx-1000">correlated queries</span>.
   <div class="newtheorem">
<!--l. 717--><p class="noindent" ><span class="head">
<a 
 id="x1-10048r2"></a>
<span 
class="ecbx-1000">Example 2.2.</span>  </span>A correlated query.
   <!--l. 720-->
   <div class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-10049r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">movieTitle</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10050r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">StarsIn</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10051r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10052r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-10053r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">birthdate</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1960</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
   </div>
<!--l. 727--><p class="indent" >
The outer relations from which a correlated subquery uses certain attributes are called
<span 
class="ecbx-1000">context relations</span>. The attributes of the context relations are the <span 
class="ecbx-1000">parameters </span>of the
subquery<span class="footnote-mark"><a 
href="summary3.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-10054f1"></a> .
                                                                                            
                                                                                            
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-110002.3"></a>Translating SELECT-FROM-WHERE subqueries</h4>
<!--l. 734--><p class="noindent" >To translate a SELECT-FROM-WHERE statement that is used as a subquery, we must make the following
modifications to the method from Section <a 
href="#x1-90002.1">2.1<!--tex4ht:ref: subsec:SELECT-FROM-WHERE-statemets-without-SUB --></a>:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 738--><p class="noindent" >We must add all context relations to the cartesian product of the relations in the FROM list.
     </li>
     <li class="itemize">
     <!--l. 740--><p class="noindent" >We must add all parameters as attributes to the projection <span 
class="cmmi-10">&#x03C0;</span>.</li></ul>
<div class="newtheorem">
<!--l. 742--><p class="noindent" ><span class="head">
<a 
 id="x1-11001r3"></a>
<span 
class="ecbx-1000">Example 2.3.</span>  </span>The subquery from Example <a 
href="#x1-10048r2">2.2<!--tex4ht:ref: ex:A-correlated-query. --></a>:
   <!--l. 745-->
   <div class="lstlisting" id="listing-16"><span class="label"><a 
 id="x1-11002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-11003r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">MovieStar</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-11004r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">birthdate</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1960</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">name</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">starName</span></span></div>
   
<!--l. 751--><p class="indent" >   is translated into
   <div class="math-display" >
<img 
src="summary46x.png" alt="&#x03A0;movieTitle,movieY ear,starName,name(&#x03C3;birthdate=1960 &#x2227; name=starName(StarsIn&#x00D7; M ovieStar)).
" class="math-display" ></div>
</div>
<!--l. 755--><p class="indent" >
<!--l. 757--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-120002.4"></a>De-correlation of subqueries appearing in a conjunctive WHERE condition</h4>
<!--l. 759--><p class="noindent" >Now, let&#8217;s focus on a particular case:
<!--l. 761--><p class="indent" >   Suppose we have a query of the general form:
   <!--l. 763-->
   <div class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-12001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Select</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-12002r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">from</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">list</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-12003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">condition</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 769--><p class="indent" >   And the following assumption: <span 
class="ecti-1000">the condition is a conjunction (AND) of SELECT-FROM-WHERE</span>
<span 
class="ecti-1000">subqueries, possibly with an additional condition that does not contain subqueries</span>, i.e., the condition is of the
form
   <div class="math-display" >
                                                                                            
                                                                                            
<img 
src="summary47x.png" alt="&#x03D5; AN D EXIST  S(Q1) AN D EXIST  S(Q2 ) AN D...AN D NOT  EXIST  S (P1) AN D...
" class="math-display" ></div>
<!--l. 776--><p class="indent" >   where <span 
class="cmmi-10">&#x03D5; </span>denotes the subquery-free condition and <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,Q</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">,P</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,P</span><sub><span 
class="cmmi-7">m</span></sub> are select statements. The translation is done
in four steps:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-12005x1">
     <!--l. 779--><p class="noindent" >Translate <span 
class="cmmi-10">&#x03D5;</span>.
     </li>
<li 
  class="enumerate" id="x1-12007x2">
     <!--l. 780--><p class="noindent" >De-correlate the EXISTS subqueries.
     </li>
<li 
  class="enumerate" id="x1-12009x3">
     <!--l. 781--><p class="noindent" >De-correlate the NOT EXISTS subqueries.
     </li>
<li 
  class="enumerate" id="x1-12011x4">
     <!--l. 782--><p class="noindent" >Apply the projection <span 
class="cmr-10">&#x03A0;</span><sub><span 
class="cmmi-7">Select</span><span 
class="cmsy-7">-</span><span 
class="cmmi-7">list</span></sub><span 
class="cmmi-10">.</span></li></ol>
<!--l. 785--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">2.4.1   </span> <a 
 id="x1-130002.4.1"></a>Translating <span 
class="cmmi-10">&#x03D5;</span></h5>
<!--l. 787--><p class="noindent" >It is translated using the method of Section <a 
href="#x1-90002.1">2.1<!--tex4ht:ref: subsec:SELECT-FROM-WHERE-statemets-without-SUB --></a>, but the following context relations must be included:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 790--><p class="noindent" >All context relations for which parameters occur in <span 
class="cmmi-10">&#x03D5;</span>.
     </li>
     <li class="itemize">
     <!--l. 791--><p class="noindent" >All context relations for which parameters only occur in NOT EXISTS subqueries.</li></ul>
<!--l. 794--><p class="noindent" >We will obtain a expression of the form
   <div class="math-display" >
<img 
src="summary48x.png" alt="&#x03C3; (E),
 &#x03D5;
" class="math-display" ></div>
<!--l. 798--><p class="indent" >   where <span 
class="cmmi-10">E </span>is a cartesian product of all the context relations involved. From now on, we are going to adapt and refine
<span 
class="cmmi-10">E </span>gradually when de-correlating the subqueries.
   <div class="newtheorem">
<!--l. 801--><p class="noindent" ><span class="head">
<a 
 id="x1-13001r4"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 2.4.</span>  </span>Consider the following query, with relations <span 
class="cmmi-10">R</span><img 
src="summary49x.png" alt="(A,B )"  class="left" align="middle"> and <span 
class="cmmi-10">S</span><img 
src="summary50x.png" alt="(C )"  class="left" align="middle">:
   <!--l. 805-->
   <div class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-13002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13003r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13004r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13005r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13006r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13007r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EXISTS</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13008r7"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R3</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R3</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13009r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R3</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13010r9"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R3</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R3</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">C</span></span><span style="color:#000000"><span 
class="ectt-1000">));</span></span></div>
   
<!--l. 817--><p class="indent" >   Let&#8217;s denote the queries, from outer to inner: <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,Q</span><sub><span 
class="cmr-7">2</span></sub> and <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">3</span></sub>. <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">1</span></sub> does not have a subquery-free part, so we continue
with <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub>. The subquery-free part of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub> is:
   <!--l. 821-->
   <div class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-13011r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">*</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13012r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-13013r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">B</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 827--><p class="indent" >   So it can be translated as
   <div class="math-display" >
<img 
src="summary51x.png" alt="&#x03C3;R2.A=R1.B(&#x03C1;R2(R) &#x00D7;&#x03C1;R1 (R)).
" class="math-display" ></div>
<!--l. 831--><p class="indent" >   Note that <span 
class="cmmi-10">S </span>is a context relation for this subquery-free part, but no parameter from it is needed and it is not only
used in NOT EXISTS clauses, so it is not added.
   </div>
<!--l. 834--><p class="indent" >
<!--l. 836--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">2.4.2   </span> <a 
 id="x1-140002.4.2"></a>De-correlating EXISTS subqueries</h5>
<!--l. 838--><p class="noindent" >After translating the subquery-free part, we translate all the subqueries <span 
class="cmmi-10">EXISTS</span><img 
src="summary52x.png" alt="(Qi)"  class="left" align="middle"> as explained in Section <a 
href="#x1-110002.3">2.3<!--tex4ht:ref: subsec:Translating-SELECT-FROM-WHERE-suB --></a>,
obtaining an algebra expression <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">Q</span><sub><span 
class="cmmi-5">i</span></sub></sub>.
<!--l. 842--><p class="indent" >   Let <span 
class="cmmi-10">A</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,A</span><sub><span 
class="cmmi-7">p</span></sub> be the list of parameters of context relations of <span 
class="cmmi-10">Q</span><sub><span 
class="cmmi-7">i</span></sub>. We can translate <span 
class="cmmi-10">EXISTS</span><img 
src="summary53x.png" alt="(Qi)"  class="left" align="middle"> by joining <span 
class="cmmi-10">E </span>with
the space of parameters for <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">Q</span><sub><span 
class="cmmi-5">i</span></sub></sub>, namely <span 
class="cmr-10">&#x03A0;</span><sub><span 
class="cmmi-7">A</span><sub><span 
class="cmr-5">1</span></sub><span 
class="cmmi-7">,...,A</span><sub><span 
class="cmmi-5">p</span></sub></sub><img 
src="summary54x.png" alt="(EQi )"  class="left" align="middle"> <span 
class="cmr-10">:</span>
   <div class="math-display" >
<img 
src="summary55x.png" alt="E := E &#x22B3;&#x22B2; &#x03C0;A1,...,Ap (EQi).
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 849--><p class="noindent" ><span class="head">
<a 
 id="x1-14001r5"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 2.5.</span>  </span>Let&#8217;s continue the translation of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub> from Example <a 
href="#x1-13001r4">2.4<!--tex4ht:ref: ex:decorr-ex1 --></a>. Now, we have to translate <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">3</span></sub> as:
   <div class="math-display" >
<img 
src="summary56x.png" alt="&#x03C3;R3.A=R2.B &#x2227; R3.B=S.C (&#x03C1;R3(R) &#x00D7;&#x03C1;R2 (R)&#x00D7; S).
" class="math-display" ></div>
<!--l. 856--><p class="indent" >   At this point, we have
   <div class="math-display" >
<img 
src="summary57x.png" alt="E = &#x03C1;R2 (R )&#x00D7; &#x03C1;R1 (R),
" class="math-display" ></div>
<!--l. 860--><p class="indent" >
   <div class="math-display" >
<img 
src="summary58x.png" alt="EQ3 = &#x03C3;R3.A=R2.B &#x2227; R3.B=S.C (&#x03C1;R3(R) &#x00D7;&#x03C1;R2 (R)&#x00D7; S),
" class="math-display" ></div>
<!--l. 863--><p class="indent" >   and by joining <span 
class="cmmi-10">E </span>and <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">Q</span><sub><span 
class="cmr-5">3</span></sub></sub> on the parameters of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">3</span></sub> we ensure that we are taking the correct tuples from <span 
class="cmmi-10">E</span>
and <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">Q</span><sub><span 
class="cmr-5">3</span></sub></sub>. In particular, we are taking the tuples in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> for which tuples in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">3</span></sub> and <span 
class="cmmi-10">S </span>exist that satisfy the
requirements of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub>:
   <div class="math-display" >
<img 
src="summary59x.png" alt="&#x03C1;R (R )&#x00D7; &#x03C1;R (R) &#x22B3;&#x22B2; &#x03A0;R .A,R .B,S.C (&#x03C3;R3.A=R2.B &#x2227; R3.B=S.C (&#x03C1;R3(R)&#x00D7; &#x03C1;R2 (R )&#x00D7; S)).
  2        1        2   2
" class="math-display" ></div>
<!--l. 871--><p class="indent" >   Note that this expression can be simplified:
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary60x.png" alt="E := &#x03C1;  (R) &#x22B3;&#x22B2; &#x03A0;          (&#x03C3;                  (&#x03C1;  (R)&#x00D7; &#x03C1;   (R )&#x00D7; S)),
      R1       R2.A,R2.B,S.C   R3.A=R2.B &#x2227; R3.B=S.C  R3      R2
" class="math-display" ></div>
<!--l. 875--><p class="indent" >   because we are joining <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> with a subset of itself, so we will obtain the entire subset.
   </div>
<!--l. 877--><p class="indent" >
   <div class="newtheorem">
<!--l. 878--><p class="noindent" ><span class="head">
<a 
 id="x1-14002r1"></a>
<span 
class="ecti-1000">Remark </span>2.1<span 
class="ecti-1000">.</span>  </span>This simplification can always be done. Before joining with <span 
class="cmr-10">&#x03A0;</span><sub><span 
class="cmmi-7">A</span><sub><span 
class="cmr-5">1</span></sub><span 
class="cmmi-7">,...,A</span><sub><span 
class="cmmi-5">p</span></sub></sub><img 
src="summary61x.png" alt="(EQi)"  class="left" align="middle"><span 
class="cmmi-10">, </span>we can remove from
<span 
class="cmmi-10">E </span>all context relations for <span 
class="cmmi-10">Q</span><sub><span 
class="cmmi-7">i</span></sub>, because they are already present in the parameter space. This way, denoting by
<span 
class="cmmi-10">Ê</span> the adapted <span 
class="cmmi-10">E</span>, we can change what we explained later for
   <div class="math-display" >
<img 
src="summary62x.png" alt="     &#x02C6;
E := E &#x22B3;&#x22B2; &#x03A0;A1,...,Ap (EQi).
" class="math-display" ></div>
   </div>
<!--l. 887--><p class="indent" >
   <div class="newtheorem">
<!--l. 888--><p class="noindent" ><span class="head">
<a 
 id="x1-14003r6"></a>
<span 
class="ecbx-1000">Example 2.6.</span>  </span>Now we can translate <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub> as follows:
   <div class="math-display" >
<img 
src="summary63x.png" alt="E2 := &#x03C3;R2.A=R1.B (E) =
" class="math-display" ></div>
<!--l. 893--><p class="indent" >
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary64x.png" alt="&#x03C3;         (&#x03C1;   (R ) &#x22B3;&#x22B2; &#x03A0;          (&#x03C3;                   (&#x03C1;   (R )&#x00D7; &#x03C1;  (R) &#x00D7; S))).
 R2.A=R1.B  R1        R2.A,R2.B,S.C  R3.A=R2.B &#x2227; R3.B=S.C  R3       R2
" class="math-display" ></div>
<!--l. 896--><p class="indent" >   Notice how <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>  has been removed from the cartesian product of the subquery-free part of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">2</span></sub>  that we
translated in the first of the examples.
<!--l. 900--><p class="indent" >   Finally, the translation of the entire <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">1</span></sub> is
   <div class="math-display" >
<img 
src="summary65x.png" alt="&#x03A0;R1.A,R1.B(E2),
" class="math-display" ></div>
<!--l. 904--><p class="indent" >   where <span 
class="cmmi-10">&#x03C1;</span><sub><span 
class="cmmi-7">R</span><sub><span 
class="cmr-5">1</span></sub></sub><img 
src="summary66x.png" alt="(R)"  class="left" align="middle"> and <span 
class="cmmi-10">S </span>have been removed from the cartesian product originating from the translation of the
subquery-free part of <span 
class="cmmi-10">Q</span><sub><span 
class="cmr-7">1</span></sub> (the FROM clause).
   </div>
<!--l. 907--><p class="indent" >
<!--l. 909--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">2.4.3   </span> <a 
 id="x1-150002.4.3"></a>De-correlating NOT EXISTS subqueries</h5>
<!--l. 911--><p class="noindent" >Now we can de-correlate the <span 
class="cmmi-10">NOT</span><span 
class="cmmi-10">&#x00A0;EXISTS</span><img 
src="summary67x.png" alt="(Pj)"  class="left" align="middle"> subqueries. We start translating <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">j</span></sub> into a RA expression <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">P</span><sub><span 
class="cmmi-5">j</span></sub></sub>.
Again, we consider the parameters <span 
class="cmmi-10">A</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,A</span><sub><span 
class="cmmi-7">p</span></sub> of the context relations of <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">j</span></sub>. The difference now is that we don&#8217;t join <span 
class="cmmi-10">E</span>
and <span 
class="cmmi-10">E</span><sub><span 
class="cmmi-7">P</span><sub><span 
class="cmmi-5">j</span></sub></sub>, but we perform an anti-join:
   <div class="math-display" >
<img 
src="summary68x.png" alt="      --        (   )
E := E&#x22B3;&#x22B2;&#x03A0;A1,...,Ap  EPj ,
" class="math-display" ></div>
<!--l. 919--><p class="indent" >   where
   <div class="math-display" >
<img 
src="summary69x.png" alt=" --
R&#x22B3;&#x22B2;S = R- (R &#x22B3;&#x22B2; S) .
" class="math-display" ></div>
<!--l. 923--><p class="indent" >   In this anti-join, it necessary that <span 
class="cmmi-10">R </span>contains all attributes of <span 
class="cmmi-10">S</span>, and this is the reason why it is needed to add all
context relations appearing only in NOT EXISTS clauses to the cartesian product of the subquery-free part of the
query.
<!--l. 928--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">2.4.4   </span> <a 
 id="x1-160002.4.4"></a>Translating the Select-list</h5>
<!--l. 930--><p class="noindent" >Finally, we apply the projection <span 
class="cmr-10">&#x03A0;</span><sub><span 
class="cmmi-7">Select</span><span 
class="cmsy-7">-</span><span 
class="cmmi-7">list</span></sub>.
<!--l. 932--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-170002.5"></a>Flattening subqueries in bag-based relations</h4>
<!--l. 934--><p class="noindent" >Until now, we have supposed that all relations involved are set-based, but this is not the case in real
databases, where duplicates can occur. In this case, the requirements for flattening into a normal join
are:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 938--><p class="noindent" >There is a uniqueness condition that ensures that the subquery does not introduce any duplicates if it is
     flattened into the outer query block.
     </li>
     <li class="itemize">
     <!--l. 941--><p class="noindent" >Each table in the subquery&#8217;s FROM list (after any view, derived table, or subquery flattening) must be a
     base table.
     </li>
     <li class="itemize">
     <!--l. 943--><p class="noindent" >The subquery is not under an OR.
     </li>
     <li class="itemize">
     <!--l. 944--><p class="noindent" >The subquery is not in the SELECT list of the outer query block.
     </li>
     <li class="itemize">
     <!--l. 945--><p class="noindent" >The subquery type is EXISTS, IN, or ANY, or it is an expression subquery on the right side of a comparison
     operator.
     </li>
     <li class="itemize">
     <!--l. 947--><p class="noindent" >There are no aggregates in the SELECT list of the subquery.
     </li>
     <li class="itemize">
     <!--l. 948--><p class="noindent" >The subquery does not have a GROUP BY clause.
     </li>
     <li class="itemize">
     <!--l. 949--><p class="noindent" >The subquery does not have an ORDER BY, result offset, or fetch first clause.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 951--><p class="noindent" >If there is a WHERE clause in the subquery, there is at least one table in the subquery whose columns are
     in equality predicates with expressions that do not include any column references from the subquery block.
     These columns must be a superset of the key columns for any unique index on the table. For all other
     tables in the subquery, the columns in equality predicates with expressions that do not include columns
     from the same table are a superset of the unique columns for any unique index on the table.</li></ul>
<!--l. 960--><p class="noindent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;II<br /></span><a 
 id="x1-18000II"></a>Query Optimization</h1>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-190003"></a>System-R</h3>
<!--l. 966--><p class="noindent" >In this section, we are going to explain System R, which is a pioneering SQL system developed by IBM Research and
which was released in 1976, with an accompanying paper, <span class="cite">[<a 
href="#XsystemR">1</a>]</span>.
<!--l. 970--><p class="indent" >   System R was an experimental prototype database management system, with complete capability, including
application programming, query capability, conccurent access support, system recovery, etc.
<!--l. 974--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-200003.1"></a>Architecture Components</h4>
<!--l. 976--><p class="noindent" >System R is composed by several parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 978--><p class="noindent" ><span 
class="ecbx-1000">Relational Storage Interface (RSI)</span>: internal interface which handles access to single tuples of base
     relations.
     </li>
     <li class="itemize">
     <!--l. 980--><p class="noindent" ><span 
class="ecbx-1000">Relational  Storage  System  (RSS)</span>:  the  supporting  system  of  the  RSI.  It  is  a  complete  storage
     subsystem in the sense that it manages devices, space allocation, deadlock detection,... It maintain indexes
     on selected fields of base relations, and pointer chains across relations.
     </li>
     <li class="itemize">
     <!--l. 984--><p class="noindent" ><span 
class="ecbx-1000">Relational Data Interface (RDI)</span>: the external interface that can be called directly from a programming
     language. The <span 
class="ecbx-1000">SQL language </span>is embedded within the RDI, and is used as the basis for all data definition
     and manipulation.
     </li>
     <li class="itemize">
     <!--l. 988--><p class="noindent" ><span 
class="ecbx-1000">Relational Data System (RDS)</span>: supports the RDI, provides authorization, integrity enforcement and
     support for alternative views of data. The RDS contains an <span 
class="ecbx-1000">optimizer </span>which plans the execution of each
     RDI command, choosing a low cost access path to data from among those provided by the RSS. The
     RDS also maintains a set of <span 
class="ecbx-1000">catalog relations </span>which describe the other relations, views, images, links,
     assertions, and triggers known to the system.</li></ul>
<!--l. 996--><p class="noindent" >A logical diagram of this architecture is depicted in Figure <a 
href="#x1-20001r1">1<!--tex4ht:ref: fig:Architecture-of-System-R --></a>.
<!--l. 998--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                                            
                                                                                            
<a 
 id="x1-20001r1"></a>
                                                                                            
                                                                                            
<!--l. 999--><p class="noindent" ><img 
src="1_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___itecture_LectureNotes_source_systemR_drawio.png" alt="PIC"  
width="46" height="46" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">Architecture of System R</span></div><!--tex4ht:label?: x1-20001r1 -->
                                                                                            
                                                                                            
<!--l. 1000--><p class="indent" >   </div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-210003.2"></a>Query language</h4>
<!--l. 1005--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.2.1   </span> <a 
 id="x1-220003.2.1"></a>Data manipulation</h5>
<!--l. 1007--><p class="noindent" >The RDI interfaces SQL to a host programming language by means of a concept called a <span 
class="ecbx-1000">cursor</span>, which is a name used
at the RDI to identify a set of tuples called its <span 
class="ecbx-1000">active set</span>, and to maintain a position on one tuple of the set. The
cursor is associted with a set of tuples by means of the RDI operator <span 
class="ecbx-1000">SEQUEL</span>; the tuples may then be retrieved, one
at a time, by the RDI operator <span 
class="ecbx-1000">FETCH</span>. The program must first give the system the addresses of the program
variables to be used by means of the RDI operator <span 
class="ecbx-1000">BIND</span>.
   <div class="newtheorem">
<!--l. 1015--><p class="noindent" ><span class="head">
<a 
 id="x1-22001r1"></a>
<span 
class="ecbx-1000">Example 3.1.</span>  </span>Here, the host program identifies variables X and Y to the system and then issues a query whose
results are to be placed in these variables:
   <!--l. 1019-->
   <div class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-22002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BIND</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ADDR</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">));</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-22003r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BIND</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">Y</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ADDR</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">Y</span></span><span style="color:#000000"><span 
class="ectt-1000">));</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-22004r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SEQUEL</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">C1</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">NAME</span></span><span style="color:#000000"><span 
class="ectt-1000">:</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SAL</span></span><span style="color:#000000"><span 
class="ectt-1000">:</span></span><span style="color:#000000"><span 
class="ectt-1000">Y</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-22005r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EMP</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-22006r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">JOB</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">"</span></span><span style="color:#000000"><span 
class="ectt-1000">PROGRAMMER</span></span><span style="color:#000000"><span 
class="ectt-1000">"</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-22007r6"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FETCH</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">C1</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 1029--><p class="indent" >   The SEQUEL operator is associating the cursor C1 with the set of tuples which satisfy the query and positioning it
just before the first such tuple. The optimizer is invoked to choose an access path whereby the tuples may be
materialized, but no tuples are actually materialized in response to the SEQUEL call. The materialization is done as
they are called for, one at a time, by the FETCH operator. Each call to FETCH deliver the next tuple of the active set
into program variables X and Y. In Figure <a 
href="#x1-22008r2">2<!--tex4ht:ref: fig:exampleSystemR --></a> we can see an example of the stored data in the relation EMP and the
resulting Active Set. In this case, after calling FETCH(C1), the values of the variables would be X=&#8221;Mike&#8221; and
Y=800. If another call to FECTH(C1) were made, then the variables would be overrided to X=&#8221;Sarah&#8221; and
Y=810.
<!--l. 1042--><p class="indent" >   <hr class="figure"><div class="figure" 
><a 
 id="x1-22008r2"></a><!--tex4ht:inline--><div class="tabular"> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"></colgroup><colgroup id="TBL-2-2g"><col 
id="TBL-2-2"></colgroup><colgroup id="TBL-2-3g"><col 
id="TBL-2-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11">                <div class="multicolumn"  style="white-space:nowrap; text-align:center;">EMP</div>                         </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11"> NAME </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-2"  
class="td11"> SAL </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-3"  
class="td11"> JOB</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11">  &#8220;John&#8221;   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-2"  
class="td11"> 1000  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-3"  
class="td11">      &#8220;CEO&#8221;          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-1"  
class="td11"> &#8220;Mike&#8221; </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-2"  
class="td11"> 800 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-3"  
class="td11"> &#8220;PROGRAMMER&#8221;</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-1"  
class="td11"> &#8220;Sarah&#8221;  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-2"  
class="td11">  810   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-3"  
class="td11"> &#8220;PROGRAMMER&#8221;  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-1"  
class="td11"> </td></tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-3" class="tabular" 
 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-3-1-1"  
class="td11">    <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Active Set</div>      </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-1"  
class="td11"> NAME </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-2"  
class="td11"> SAL</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-1"  
class="td11"> &#8220;Mike&#8221;   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-2"  
class="td11">  800  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-1"  
class="td11"> &#8220;Sarah&#8221;  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-2"  
class="td11">  810  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-1"  
class="td11">        </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2: </span><span  
class="content">Result of the program. Stored data in EMP (left). Active Set (right). </span></div><!--tex4ht:label?: x1-22008r2 -->
<!--l. 1082--><p class="indent" >   </div><hr class="endfigure">
   </div>
<!--l. 1083--><p class="indent" >
The <span 
class="ecbx-1000">DESCRIBE </span>operator returns the degree and the data types of the active set. The degree is the number of
attributes. It is useful when this information is not known in advanced, so it can be inputted to the FETCH
operator.
<!--l. 1089--><p class="indent" >   The operator <span 
class="ecbx-1000">OPEN </span>is used to associate a cursor with an entire relation.
<!--l. 1092--><p class="indent" >   Each cursor remains active until an RDI operator <span 
class="ecbx-1000">CLOSE </span>or <span 
class="ecbx-1000">KEEP </span>is issued on it. CLOSE deactivates the cursor,
while KEEP causes the tuples identified by a cursor to be copied to form a new permanent relation in the
database.
<!--l. 1097--><p class="indent" >   The operator <span 
class="ecbx-1000">FETCH_HOLD </span>is as FETCH, but it also acquires a <span 
class="ecti-1000">hold </span>on the tuple returned, which prevents
other users from updating or deleting it until it is explicitly released by the <span 
class="ecbx-1000">RELEASE </span>operator or until the holding
transaction has ended.
                                                                                            
                                                                                            
<!--l. 1102--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.2.2   </span> <a 
 id="x1-230003.2.2"></a>Data definition</h5>
<!--l. 1104--><p class="noindent" >The SQL statement <span 
class="ecbx-1000">CREATE TABLE </span>is used to create a new base relation. For each field, the field name and data
type are specified. When a relation is no longer useful, it may be deleted by issuing a <span 
class="ecbx-1000">DROP TABLE</span>
statement.
<!--l. 1109--><p class="indent" >   Access paths include images and binary links. <span 
class="ecbx-1000">Images </span>are value orderings maintained on base relations by the RSS, using multilevel
index structures<span class="footnote-mark"><a 
href="summary4.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-23001f2"></a> ,
associating a value with one or more <span 
class="ecbx-1000">tuple identifiers (TIDs)</span>, which are internal addresses allowing rapid access to a
tuple. One image per relation can have the <span 
class="ecbx-1000">clustering property</span>, which causes tuples whose sort field values are close
to be physically stored near each other. <span 
class="ecbx-1000">Binary paths </span>are access paths in the RSS which link tuples in
one relation to related tuples of another relation through pointer chains. They are employed in a value
dependent manner: the user specifies that each tuple of Relation 1 is to be linked to the tuples in Relation 2
which have matching values in some field/s, and that the tuples on the link are to be ordered in some
way<span class="footnote-mark"><a 
href="summary5.html#fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-23002f3"></a> . A
link may be declared to have the clustering property.
<!--l. 1124--><p class="indent" >   A <span 
class="ecbx-1000">view </span>is a relation derived from one or more relations, and can be used in the same way as a base table. It can
be defined using the <span 
class="ecbx-1000">DEFINE VIEW </span>statement. Views are updated automatically when changes are
made to the base tables on which they are defined. When the statement <span 
class="ecbx-1000">DROP VIEW </span>is issued, the
indicated view and all other views defined in terms of it disappear from the system. Modifications to views
are only allowed if the tuples of the view are associated one-to-one with tuples of an underlying base
relation.
<!--l. 1133--><p class="indent" >   The statement <span 
class="ecbx-1000">KEEP TABLE </span>causes a temporary table to become permanent.
<!--l. 1136--><p class="indent" >   The statement <span 
class="ecbx-1000">EXPAND TABLE </span>is used to add a new field to an existing table.
   <h5 class="subsubsectionHead"><span class="titlemark">3.2.3   </span> <a 
 id="x1-240003.2.3"></a>Data Control</h5>
<!--l. 1141--><p class="noindent" >A <span 
class="ecbx-1000">transaction </span>is a series of RDI calls which the user wishes to be processed as an atomic act. A transaction starts
when the user issues a <span 
class="ecbx-1000">BEGIN_TRANS </span>statement and ends when <span 
class="ecbx-1000">END_TRANS </span>is called. Save points may be
specified by means of the operator <span 
class="ecbx-1000">SAVE</span>. When a transaction is active, the user may go back to the beginning of it, or
to any save point using <span 
class="ecbx-1000">RESTORE</span>.
<!--l. 1148--><p class="indent" >   Regarding <span 
class="ecbx-1000">authorization</span>, System R does not require a particular individual to be the DB administrator, but
allows each user to create his own data objects by executing the create staatements. The creator of an object has full
authorization on it. The user can gran selected capabilities for his objects to other users with the statement
<span 
class="ecbx-1000">GRANT</span>.
<!--l. 1154--><p class="indent" >   About <span 
class="ecbx-1000">integrity assertions</span>, any SQL predicate may be stated as an assertion about the integrity of data in a base
table or view. When an assertion is made by an <span 
class="ecbx-1000">ASSERT </span>statement, its truth is checked. If true, the assertion is
atuomatically enforced until it is explicitly dropped by a <span 
class="ecbx-1000">DROP ASSERTION </span>statement. Assertions may
describe the permissible states of the database or the permissible transitions in the database. For this
latter purpose, the keywords <span 
class="ecbx-1000">OLD </span>and <span 
class="ecbx-1000">NEW </span>are used in SQL to denote data values before and after
modification.
<!--l. 1164--><p class="indent" >   If an assertion is <span 
class="ecbx-1000">IMMEDIATE</span>, it cannot be suspended within a transaction, but is enforced after each data
modification. Also, <span 
class="ecti-1000">integrity points </span>may be established by the SQL <span 
class="ecbx-1000">ENFORCE INTEGRITY</span>.
<!--l. 1169--><p class="indent" >   <span 
class="ecbx-1000">Triggers </span>are a generalization of the concept of assertion, causing a prespecified sequence of SQL statements to be
executed when some triggering event occurs.
<!--l. 1173--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-250003.3"></a>Catalogues</h4>
<!--l. 1175--><p class="noindent" >Catalogues are maintained by the RDS, and they describe the information of the relations, views, images, links,
assertions and triggers known to the system. Each user may access a set of views of the system catalogs which contain
information pertinent to him. Users cannot modify a catalog directly, but it is modified indirectly, when tables are
                                                                                            
                                                                                            
created, an image is dropped, etc. A user can enter commments into his various catalog entries by means of the
<span 
class="ecbx-1000">COMMENT </span>statement.
<!--l. 1183--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.4   </span> <a 
 id="x1-260003.4"></a>Cursors</h4>
<!--l. 1185--><p class="noindent" >As we have seen, <span 
class="ecbx-1000">cursors </span>are pointers to specific tuples on a resulting table from a query. They can be used to retrieve
the values of the tuples individually or to store the tables into the database as permanent relations. Cursors are still
used, although they are often a low level feature that is not directly used by users, by it is used by the DBMS to
provide higher level features to the user.
<!--l. 1193--><p class="indent" >   In addition, SQL can be used to maniputale either one tuple at a time or a set of tuples with a single command. The
current tuple of a particular cursor may be selected for some operation using the predicate <span 
class="ecbx-1000">CURRENT TUPLE OF</span>
<span 
class="ecbx-1000">CURSOR</span>.
   <div class="newtheorem">
<!--l. 1197--><p class="noindent" ><span class="head">
<a 
 id="x1-26001r2"></a>
<span 
class="ecbx-1000">Example 3.2.</span>  </span>Give a 10% raise to all employees in Dept. 50.
   <!--l. 1200-->
   <div class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-26002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SEQUEL</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">UPDATE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EMP</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-26003r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">SET</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SAL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SAL</span></span><span style="color:#000000"><span 
class="ectt-1000">*1.1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-26004r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">DNO</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">50</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
   </div>
<!--l. 1206--><p class="indent" >
   <div class="newtheorem">
<!--l. 1208--><p class="noindent" ><span class="head">
<a 
 id="x1-26005r3"></a>
<span 
class="ecbx-1000">Example 3.3.</span>  </span>Individual update.
   <!--l. 1211-->
   <div class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-26006r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BIND</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">NEWSAL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ADDR</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">NEWSAL</span></span><span style="color:#000000"><span 
class="ectt-1000">));</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-26007r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">CALL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SEQUEL</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">UPDATE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">EMP</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-26008r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">SET</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SAL</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">NEWSAL</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-26009r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">CURRENT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">TUPLE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">OF</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">CURSOR</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">C</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
   </div>
<!--l. 1218--><p class="indent" >
<!--l. 1220--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.5   </span> <a 
 id="x1-270003.5"></a>Clustering images</h4>
<!--l. 1222--><p class="noindent" >Clustering images, as we have explained, are images (indexes) that can be used to physically store the data in the same
order as it is indexed. At most one image per relation can have the clustering property. The reason is simple: it is not
possible to store the same data physically in two different orders.
<!--l. 1228--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.6   </span> <a 
 id="x1-280003.6"></a>Optimizer</h4>
<!--l. 1230--><p class="noindent" >The objective of the optimizer is to find a low cost means of executing a SQL statement, given the data structures and
access paths available. For this, it attempts to minimize the expected number of pages to be fetches from disk
into the RSS buffers. The cost of CPU instructions is also taken into account by means of an adjustable
coefficient, <span 
class="cmmi-10">H</span>, which is multiplied by the number of tuple comparison operations to convert equivalent
                                                                                            
                                                                                            
page accesses. <span 
class="cmmi-10">H </span>is useful to adjust the metric for compute-bounded systems or disk access-bounded
systems.
<!--l. 1239--><p class="indent" >   The optimizers follows some steps when it receives a SQL statement:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-28002x1">
     <!--l. 1241--><p class="noindent" >Classify the SQL statement into one of several statement types.
     </li>
<li 
  class="enumerate" id="x1-28004x2">
     <!--l. 1242--><p class="noindent" >Examine the system catalogs to find the set of images and links which are pertinent to the given statement.
     </li>
<li 
  class="enumerate" id="x1-28006x3">
     <!--l. 1244--><p class="noindent" >A rough decision procedure is executed to find the set of reasonable methods of executing the statement.
     </li>
<li 
  class="enumerate" id="x1-28008x4">
     <!--l. 1246--><p class="noindent" >If there is more than one reasonable method, the <span 
class="ecbx-1000">expected cost formula </span>is evaluated for each method,
     and the minimizing method is choosing.</li></ol>
<!--l. 1250--><p class="noindent" >The following parameters, available in the system catalogues, are taken into account:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-28009x3.6">
     <!--l. 1253--><p class="noindent" ><span 
class="ecbx-1000">relation cardinality</span>: number of tuples
     </li>
<li 
  class="enumerate" id="x1-28010x3.6">
     <!--l. 1254--><p class="noindent" ><span 
class="ecbx-1000">number of pages occupied by the relation</span>
     </li>
<li 
  class="enumerate" id="x1-28011x3.6">
     <!--l. 1255--><p class="noindent" ><span 
class="ecbx-1000">average number of tuples per page:</span>
<div class="math-display" >
<img 
src="summary70x.png" alt="T = R-.
    D
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-28012x3.6">
     <!--l. 1260--><p class="noindent" ><span 
class="ecbx-1000">image cardinality</span>: number of distinct sort fields values in a given image.
                                                                                            
                                                                                            
     </li>
<li 
  class="enumerate" id="x1-28013x3.6">
     <!--l. 1262--><p class="noindent" ><span 
class="ecbx-1000">coefficient of CPU cost</span>: <img 
src="summary71x.png" alt="-1
H"  class="frac" align="middle"> is the number of tuple comparisons which are considered equivalent in cost
     to one disk page access.</li></ol>
<!--l. 1266--><p class="noindent" >An image <span 
class="ecbx-1000">match </span>a predicate if the sort field of the image is the field which is tested by the predicate.
<!--l. 1269--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.6.1   </span> <a 
 id="x1-290003.6.1"></a>Simple query optimization</h5>
<!--l. 1271--><p class="noindent" >In the case of a simple query on a single relation, the optimizer compares the available images with the predicates of the
query, in order to determine which of the following eight methods are available:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-29001x3.6.1">
     <!--l. 1275--><p class="noindent" >: use a clustering image which matches a predicate whose comparison operator is &#8217;=&#8217;. The expected cost,
     <span 
class="cmmi-10">C </span>is
<div class="math-display" >
<img 
src="summary72x.png" alt="    --R--
C = T &#x00D7; I,
" class="math-display" ></div>
     <!--l. 1280--><p class="noindent" >that is: from <span 
class="cmmi-10">I </span>values, we want one, so we need to retrieve <img 
src="summary73x.png" alt="RI"  class="frac" align="middle"> tuples on average. These fit in <img 
src="summary74x.png" alt="TR&#x00D7;I"  class="frac" align="middle"> pages.
     </li>
<li 
  class="enumerate" id="x1-29002x3.6.1">
     <!--l. 1282--><p class="noindent" >: use a clustering image which matches a predicate whose comparison operator is not &#8217;=&#8217;. Assuming half
     the tuples satisfy the predicate, we have
<div class="math-display" >
<img 
src="summary75x.png" alt="      R
C = T-&#x00D7;-2.
" class="math-display" ></div>
     <!--l. 1288--><p class="noindent" >The idea is the same as before, but now we are assuming to retrieve <img 
src="summary76x.png" alt="R-
2"  class="frac" align="middle"> tuples on average.
     </li>
<li 
  class="enumerate" id="x1-29003x3.6.1">
                                                                                            
                                                                                            
     <!--l. 1290--><p class="noindent" >: use a non-clustering image which matches a predicate whose comparison operator is &#8217;=&#8217;. In this case, we
     have
<div class="math-display" >
<img 
src="summary77x.png" alt="C = R-,
    I
" class="math-display" ></div>
     <!--l. 1295--><p class="noindent" >because now we might find only one correct tuple per page.
     </li>
<li 
  class="enumerate" id="x1-29004x3.6.1">
     <!--l. 1296--><p class="noindent" >: use a non-clustering image which matches a predicate whose comparison operator is not &#8217;=&#8217;. It is
<div class="math-display" >
<img 
src="summary78x.png" alt="    R-
C = 2 .
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-29005x3.6.1">
     <!--l. 1301--><p class="noindent" >: use a clustering image which does not match any predicate. We would scan the image and test each tuple
     against all predicates. The expected cost is
<div class="math-display" >
<img 
src="summary79x.png" alt="C = R-+ H &#x00D7; R &#x00D7; N,
    T
" class="math-display" ></div>
     <!--l. 1307--><p class="noindent" >where <span 
class="cmmi-10">N </span>is the number of predicates. So, we recover <span 
class="cmmi-10">R </span>tuples, distributed in <img 
src="summary80x.png" alt="R-
T"  class="frac" align="middle"> pages. In addition to this,
     we need to perform <span 
class="cmmi-10">R</span><span 
class="cmsy-10">&#x00D7;</span><span 
class="cmmi-10">N </span>comparisons (<span 
class="cmmi-10">N </span>predicates per tuple), which are weighted by the coefficient of
     CPU, <span 
class="cmmi-10">H</span>.
                                                                                            
                                                                                            
     </li>
<li 
  class="enumerate" id="x1-29006x3.6.1">
     <!--l. 1311--><p class="noindent" >: use a non-clustering image which does not match any predicate:
<div class="math-display" >
<img 
src="summary81x.png" alt="C = R + H &#x00D7; R &#x00D7; N.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-29007x3.6.1">
     <!--l. 1315--><p class="noindent" >: use a relation scan, where this relation is the only one in its segment and test each tupple agains all
     predicates:
<div class="math-display" >
<img 
src="summary82x.png" alt="    R
C = T-+ H &#x00D7; R &#x00D7; N.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-29008x3.6.1">
     <!--l. 1320--><p class="noindent" >: use a relation scan, where there are other relations sharing the segment. The cost is unknown, but is
     greater than <img 
src="summary83x.png" alt="RT-"  class="frac" align="middle"> <span 
class="cmr-10">+ </span><span 
class="cmmi-10">H </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmmi-10">R </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmmi-10">N</span>.</li></ol>
<!--l. 1323--><p class="noindent" >The optimizer then chooses a method from this set, according to the following rules:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-29010x1">
     <!--l. 1326--><p class="noindent" >If <span 
class="ecbx-1000">Method 1 </span>is available, it is chose.
     </li>
<li 
  class="enumerate" id="x1-29012x2">
     <!--l. 1327--><p class="noindent" >If exactly one among <span 
class="ecbx-1000">Methods 2,3,5 and 7 </span>are available, it is chosen. If more than one method is
     available in this class, the expected cost formulas for these methods are evaluated and the method of
     minimum cost is chosen.
                                                                                            
                                                                                            
     </li>
<li 
  class="enumerate" id="x1-29014x3">
     <!--l. 1331--><p class="noindent" >If none of the above methods are available, the optimizer chooses <span 
class="ecbx-1000">Method 4</span>, if available.
     </li>
<li 
  class="enumerate" id="x1-29016x4">
     <!--l. 1333--><p class="noindent" >Else, <span 
class="ecbx-1000">Method 6</span>, if available.
     </li>
<li 
  class="enumerate" id="x1-29018x5">
     <!--l. 1334--><p class="noindent" >Else, <span 
class="ecbx-1000">Method 8</span>.</li></ol>
<!--l. 1337--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.6.2   </span> <a 
 id="x1-300003.6.2"></a>Join query optimization</h5>
<!--l. 1339--><p class="noindent" >In the release paper, only 4 methods are explained, although they say the system takes more methods into
account.
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-30001x3.6.2">
     <!--l. 1342--><p class="noindent" >: use images on join fields. A simultaneous scan of the image on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A </span>and the image of <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A</span>. The idea
     is having two pointers, and advance them coordinately, using the fact that images are ordered to find
     matches.
     </li>
<li 
  class="enumerate" id="x1-30002x3.6.2">
     <!--l. 1346--><p class="noindent" >: sort both relations. <span 
class="cmmi-10">R</span><span 
class="cmr-10">1 </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2 </span>are ordered using their cluster images and two files, <span 
class="cmmi-10">F</span><span 
class="cmr-10">1 </span>and <span 
class="cmmi-10">F</span><span 
class="cmr-10">2 </span>are
     created. <span 
class="cmmi-10">F</span><span 
class="cmr-10">1 </span>and <span 
class="cmmi-10">F</span><span 
class="cmr-10">2 </span>are sorted on field <span 
class="cmmi-10">A</span>. The resulting sorted files are scanned simultaneously and the
     join is performed.
     </li>
<li 
  class="enumerate" id="x1-30003x3.6.2">
     <!--l. 1350--><p class="noindent" >: multiple passes. <span 
class="cmmi-10">R</span><span 
class="cmr-10">1 </span>is scanned, storing the pertinent fields into a main memory data structure, <span 
class="cmmi-10">W</span>. If
     space in main memory is available to insert a subtuple, <span 
class="cmmi-10">S</span>, it is inserted. If there is no space and <span 
class="cmmi-10">S.A </span>is less
     than the current highest value of <span 
class="cmmi-10">A </span>in <span 
class="cmmi-10">W</span>, <span 
class="cmmi-10">S </span>is discarded. After completing the scan of <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span>, <span 
class="cmmi-10">R</span><span 
class="cmr-10">2 </span>is scanned
     using its clustering image and a tuple <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032; </span>of <span 
class="cmmi-10">R</span><span 
class="cmr-10">2 </span>is obtained. Then, <span 
class="cmmi-10">W </span>is checked for the presence of <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032;</span><span 
class="cmmi-10">.A</span>.
     If present, <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032; </span>is joined to the appropriate subtuple in <span 
class="cmmi-10">W</span>. This process continues until all tuples of <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span>
     have been examined. If any <span 
class="cmmi-10">R</span><span 
class="cmr-10">1 </span>subtuples were discarded, another scan of <span 
class="cmmi-10">R</span><span 
class="cmr-10">1 </span>is made to form a new <span 
class="cmmi-10">W</span>
     consisting of subtuples with <span 
class="cmmi-10">A </span>value greater than the current highest. <span 
class="cmmi-10">R</span><span 
class="cmr-10">2 </span>is scanned again and the process
     is repeated.
     </li>
<li 
  class="enumerate" id="x1-30004x3.6.2">
     <!--l. 1362--><p class="noindent" >: the TID algorithm. Basically, it works as follows:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-30006x1">
         <!--l. 1364--><p class="noindent" >Obtain the TIDs of tuples from <span 
class="cmmi-10">R</span><span 
class="cmr-10">1 </span>which satisfy additional restrictions to the join. Sort them and
         store the TIDs in a file <span 
class="cmmi-10">F</span><span 
class="cmr-10">1</span>. Do the same with <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span>, storing the TIDs in <span 
class="cmmi-10">F</span><span 
class="cmr-10">2</span>.
                                                                                            
                                                                                            
         </li>
<li 
  class="enumerate" id="x1-30008x2">
         <!--l. 1367--><p class="noindent" >Perform a simultaneous scan over the images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A</span>, finding the TID pairs of tuples
         whose values for <span 
class="cmmi-10">A </span>match.
         </li>
<li 
  class="enumerate" id="x1-30010x3">
         <!--l. 1369--><p class="noindent" >Check each pair <img 
src="summary84x.png" alt="(TID1, TID2 )"  class="left" align="middle"> to see if <span 
class="cmmi-10">TID</span><span 
class="cmr-10">1 </span>is present in <span 
class="cmmi-10">W</span><span 
class="cmr-10">1 </span>and <span 
class="cmmi-10">TID</span><span 
class="cmr-10">2 </span>is present in <span 
class="cmmi-10">W</span><span 
class="cmr-10">2</span>. If they
         are, the tuples are fetched and joined.</li></ol>
     </li></ol>
<!--l. 1374--><p class="noindent" >A method cannot be applied unless the appropriate access paths are available. The <span 
class="ecbx-1000">performance of a method </span>depends
strongly on the clustering of the relations with respect to the access paths. In the paper, four situation are presented in
which the optimizer would decide between the four methods, but they claim to detail the cost formulas on a later
paper:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-30011x3.6.2">
     <!--l. 1381--><p class="noindent" >: there are clustering images on both <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A</span>, but not no images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.B </span>or <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.C</span>, which are
     additional conditions. <span 
class="ecbx-1000">Method 1 </span>is always chosen.
     </li>
<li 
  class="enumerate" id="x1-30012x3.6.2">
     <!--l. 1384--><p class="noindent" >: there are non-clustering images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A</span>, but no images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.B </span>or <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.C</span>. <span 
class="ecbx-1000">Method 3 </span>is
     chosen if <span 
class="cmmi-10">W </span>fits into the main memory buffer at once. Otherwise, <span 
class="ecbx-1000">Method 2 </span>is chosen.
     </li>
<li 
  class="enumerate" id="x1-30013x3.6.2">
     <!--l. 1388--><p class="noindent" >: there are clustering images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A </span>and non-clustering images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.B </span>or <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.C</span>. <span 
class="ecbx-1000">Method 4</span>
     is always chosen.
     </li>
<li 
  class="enumerate" id="x1-30014x3.6.2">
     <!--l. 1390--><p class="noindent" >: there are non-clustering images on <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.A,R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.A,R</span><span 
class="cmr-10">1</span><span 
class="cmmi-10">.B </span>and <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span><span 
class="cmmi-10">.C</span>. <span 
class="ecbx-1000">Method 3 </span>is chosen if <span 
class="cmmi-10">W </span>fits into the
     main memory buffer. Otherwise, <span 
class="ecbx-1000">Method 2 </span>is chosen if more than one tuple per disk page is expected to
     satisfy the restriction predicates. In other cases, <span 
class="ecbx-1000">Method 4 </span>is chosen.</li></ol>
<!--l. 1397--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">3.6.3   </span> <a 
 id="x1-310003.6.3"></a>Optimized Packages</h5>
<!--l. 1399--><p class="noindent" >After analyzing a SQL statement, the optimizer produces an <span 
class="ecbx-1000">Optimized Package (OP) </span>containing the parse tree and
a plan for executing the statement.
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1403--><p class="noindent" >If the statement is a query, the OP is used to materialize tuples as they are called for by the FECTH
     command.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 1405--><p class="noindent" >If the statement is a view definition, the OP is stored in the form of a <span 
class="ecbx-1000">Pre-Optimized Package (POP)</span>,
     which can be fetched and utilized whenever an access is made via the specified view. If any change is made
     to the structure of a base relation or to the access paths maintained on it, the POPs of all views defined
     on that relation are invalidated, and each view must be reoptimized to form a new POP.
     </li>
     <li class="itemize">
     <!--l. 1411--><p class="noindent" >When a view is accessed via the RDI operators OPEN and FETCH, the POP for the view can be used
     directly to materialize the tuples of the view.</li></ul>
<!--l. 1416--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.7   </span> <a 
 id="x1-320003.7"></a>PostgreSQL in relation to System R</h4>
<!--l. 1418--><p class="noindent" >Here, we are going to examine how PostgreSQL is similar or different to the characteristics of System
R:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1421--><p class="noindent" ><span 
class="ecbx-1000">Catalog</span>: PostgreSQL also maintains a catalog, with similar information about the relations, indexes,
     views,... of the system.
     </li>
     <li class="itemize">
     <!--l. 1423--><p class="noindent" ><span 
class="ecbx-1000">Tuple Identifier (TID)</span>: PostgreSQL also has the concept of TID, being it a pair <img 
src="summary85x.png" alt="(b,e)"  class="left" align="middle">, where <span 
class="cmmi-10">b </span>indicates
     the disk block in which the tuple is stored, and <span 
class="cmmi-10">e </span>is the position where the tuple starts.
     </li>
     <li class="itemize">
     <!--l. 1427--><p class="noindent" ><span 
class="ecbx-1000">Image / Clustering image</span>: the concept of image is called just index in PostgreSQL, but they are
     extended. PostgreSQL defines several types of indexes, and not all of them are ordered. For instance, a Hash
     Index is an unordered index, but a BTree index is an ordered index, which would be the most similar one to
     the concept of image in System R. PostgreSQL also allows to cluster, but the clustering is made at one point
     in time, using a particular index: this means that subsequent insertions will not be done to maintain the
     clustering property<span class="footnote-mark"><a 
href="summary6.html#fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-32001f4"></a> .
     </li>
     <li class="itemize">
     <!--l. 1436--><p class="noindent" ><span 
class="ecbx-1000">View</span>: views in PostgreSQL are very similar to views in System R. They can be thought as a stored query, very
     similar to what happens in System R. Views are automatically updated when the underlying tables are updated.
     The difference comes when one tries to directly modify a view. PostgreSQL has the concept of <span 
class="ecbx-1000">Updatable view</span>,
     which are views that can be modified with INSERT, UPDATE or DELETE. This views are views that meet the
     conditions:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 1444--><p class="noindent" >The defining query of the view must have exactly one entry in the FROM clause, which can be a
         table or another updatable view.
         </li>
         <li class="itemize">
         <!--l. 1446--><p class="noindent" >The defining query must not contain one of the following clauses at the top level: GROUP BY,
         HAVING, LIMIT, OFFSET, DISTINCT, WITH, UNION, INTERSECT, and EXCEPT.
                                                                                            
                                                                                            
         </li>
         <li class="itemize">
         <!--l. 1449--><p class="noindent" >The selection list must not contain any window function , any set-returning function, or any aggregate
         function such as SUM, COUNT, AVG, MIN, and MAX.</li></ul>
     <!--l. 1453--><p class="noindent" >If one tries to modify a updatable view, the system will automatically generate the query that performs the
     appropriate modification in the base table. Note that there are some columns that are not modifiable: if one tried
     to modify one of these columns, an error would be raised.
     </li>
     <li class="itemize">
     <!--l. 1457--><p class="noindent" ><span 
class="ecbx-1000">Cost-based query optimization</span>: PostgreSQL also has an optimizer that select the best execution plan among
     several equivalent plans with the objective of minimizing the expected cost.
     </li>
     <li class="itemize">
     <!--l. 1460--><p class="noindent" ><span 
class="ecbx-1000">Access path</span>: access path specify the path chosen by the system to retrieve the requested tuples from a relation.
     As we have seen so far, System R has basically five types of access paths: sequential scan, images, binary paths,
     order-and-scan and TID-scan. PostgreSQL defines a wider variety of access path: sequential scan, order-and-scan,
     TID-scan, hash indexes, BTree indexes, BitMap indexes,...</li></ul>
<!--l. 1468--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-330004"></a>Query Optimization</h3>
<!--l. 1470--><p class="noindent" >As we have seen until now, there are alternative ways to evaluate a given query: there are equivalent RA
expression for the same query, and also there are different methods that can physically execute a given
query.
<!--l. 1475--><p class="indent" >   An <span 
class="ecbx-1000">evaluation plan </span>defines exactly what algorithm is ued for each operation and how the execution of the
operations is coordinated.
<!--l. 1478--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-340004.1"></a>Cost-based query optimization</h4>
<!--l. 1480--><p class="noindent" >Cost difference between evaluation plans for a query can be enormous. The general steps in cost-based query
optimization are as in System R:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-34002x1">
     <!--l. 1484--><p class="noindent" >Generate logically equivalent expressions using equivalence rules.
     </li>
<li 
  class="enumerate" id="x1-34004x2">
     <!--l. 1485--><p class="noindent" >Annotate resultant expressions to get alternative query plans.
     </li>
<li 
  class="enumerate" id="x1-34006x3">
     <!--l. 1486--><p class="noindent" >Choose the cheapest plan based on the estimated cost.</li></ol>
<!--l. 1488--><p class="noindent" >The <span 
class="ecbx-1000">estimation of the cost </span>is based on:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1490--><p class="noindent" >Statistical information about relations.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 1491--><p class="noindent" >Statistics estimation for intermediate result.
     </li>
     <li class="itemize">
     <!--l. 1492--><p class="noindent" >Cost formulae for algorithms, computed using statistics.</li></ul>
<!--l. 1495--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-350004.2"></a>Viewing query evaluation plans</h4>
<!--l. 1497--><p class="noindent" >Most database support the <span 
class="ecbx-1000">EXPLAIN &#x003C;QUERY&#x003E; </span>statement, which displays the plan chosen by the optimizer,
along with the cost estimates that it uses for decision.
<!--l. 1501--><p class="indent" >   Some databases also support <span 
class="ecbx-1000">EXPLAIN ANALYSE &#x003C;QUERY&#x003E;</span>, which shows actual runtime statistics found
by running the query, in addition to showing the plan.
<!--l. 1505--><p class="indent" >   Some databases show the cost as
   <div class="math-display" >
<img 
src="summary86x.png" alt="f..l
" class="math-display" ></div>
<!--l. 1509--><p class="indent" >   where <span 
class="cmmi-10">f </span>is the cost of delivering the first tuple and <span 
class="cmmi-10">l </span>is the cost of delivering all results.
<!--l. 1512--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.3   </span> <a 
 id="x1-360004.3"></a>Generating equivalent expressions</h4>
   <div class="tcolorbox tcolorbox" id="tcolobox-3">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 1515--><p class="noindent" ><span class="head">
<a 
 id="x1-36001r1"></a>
<span 
class="ecbx-1000">Definition 4.1.</span>   </span>Two relational algebra expressions are <span 
class="ecbx-1000">equivalent </span>if the two expressions generate the
same set/bag of tuples on every legal database instance.
<!--l. 1520--><p class="noindent" >An <span 
class="ecbx-1000">equivalence rule </span>between two expressions ensure that both expressions are equivalent.
</div>
<!--l. 1522--><p class="noindent" >
 
</div> 
</div>
<!--l. 1525--><p class="noindent" >Now, we are going to list some equivalence rules:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-36003x1">
     <!--l. 1527--><p class="noindent" >Conjunctive selection can be deconstructed into a sequence of individual selections:
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary87x.png" alt="&#x03C3;P1&#x2227;P2 (E) &#x2261; &#x03C3;P1 (&#x03C3;P2 (E)).
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36005x2">
     <!--l. 1532--><p class="noindent" >Selection is commutative:
<div class="math-display" >
<img 
src="summary88x.png" alt="&#x03C3;P1 (&#x03C3;P2 (E )) &#x2261; &#x03C3;P2 (&#x03C3;P1 (E)).
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36007x3">
     <!--l. 1536--><p class="noindent" >In a sequence of projections, where <span 
class="cmmi-10">L</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2282; </span><span 
class="cmmi-10">L</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmsy-10">&#x2282; </span><span 
class="cmmi-10">... </span><span 
class="cmsy-10">&#x2282; </span><span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">n</span></sub>, only the outermost one is needed:
<div class="math-display" >
<img 
src="summary89x.png" alt="&#x03A0;L1 (&#x03C0;L2 (...(&#x03C0;Ln (E )))) &#x2261; &#x03A0;L1 (E).
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36009x4">
     <!--l. 1541--><p class="noindent" >Selections can be combined with cartesian products and theta joins:
<div class="math-display" >
<img 
src="summary90x.png" alt="&#x03C3; (E  &#x00D7; E ) &#x2261; E &#x22B3;&#x22B2; E  ,
 P  1    2     1  P  2
" class="math-display" ></div>
                                                                                            
                                                                                            
     <!--l. 1545--><p class="noindent" >
<div class="math-display" >
<img 
src="summary91x.png" alt="&#x03C3;P1 (E1 &#x22B3;&#x22B2;P2 E2 ) &#x2261; E1 &#x22B3;&#x22B2;P1&#x2227;P2 E2.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36011x5">
     <!--l. 1548--><p class="noindent" >Theta join operations are commutative
<div class="math-display" >
<img 
src="summary92x.png" alt="E  &#x22B3;&#x22B2; E &#x2261; E  &#x22B3;&#x22B2; E .
  1   2    2    1
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36013x6">
     <!--l. 1552--><p class="noindent" >And they are associative, in a soft manner:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-36015x1">
         <!--l. 1554--><p class="noindent" >The natural join is associative:
<div class="math-display" >
<img 
src="summary93x.png" alt="(E1 &#x22B3;&#x22B2; E2 ) &#x22B3;&#x22B2; E3 &#x2261; E1 &#x22B3;&#x22B2; (E2 &#x22B3;&#x22B2; E3 ).
" class="math-display" ></div>
         </li>
<li 
  class="enumerate" id="x1-36017x2">
         <!--l. 1558--><p class="noindent" >The thetha join is associative in a soft sense:
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary94x.png" alt="(E1 &#x22B3;&#x22B2;P1 E2) &#x22B3;&#x22B2;P2&#x2227;P3 E3 &#x2261; E1 &#x22B3;&#x22B2;P1&#x2227;P3 (E2 &#x22B3;&#x22B2;P2 E3),
" class="math-display" ></div>
         <!--l. 1562--><p class="noindent" >where <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">3</span></sub> involves attributes that are present in the three relations.</li></ol>
     <!--l. 1565--><p class="noindent" >When we can decide the order of the joins, we would choose the smaller join to be performed before, so that we
     compute and store a smaller temporary relation.
     </li>
<li 
  class="enumerate" id="x1-36019x7">
     <!--l. 1568--><p class="noindent" >The selection operation distributes over the theta join operation in the following two situations:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-36021x1">
         <!--l. 1571--><p class="noindent" >When all the attributes in <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> involve only the attributes of one of the expressions being joined:
<div class="math-display" >
<img 
src="summary95x.png" alt="&#x03C3;P0 (E1 &#x22B3;&#x22B2;P E2 ) &#x2261; &#x03C3;P0 (E1) &#x22B3;&#x22B2;P E2.
" class="math-display" ></div>
         </li>
<li 
  class="enumerate" id="x1-36023x2">
         <!--l. 1576--><p class="noindent" >When <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">1</span></sub> involves only the attributes of <span 
class="cmmi-10">E</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> involves only the attributes of <span 
class="cmmi-10">E</span><sub><span 
class="cmr-7">2</span></sub>:
<div class="math-display" >
<img 
src="summary96x.png" alt="&#x03C3;P1&#x2227;P2 (E1 &#x22B3;&#x22B2;P E2) &#x2261; &#x03C3;P1 (E1) &#x22B3;&#x22B2;P &#x03C3;P2 (E2).
" class="math-display" ></div>
         </li></ol>
     </li>
<li 
  class="enumerate" id="x1-36025x8">
     <!--l. 1582--><p class="noindent" >The projection operation distributes over the theta join operation as follows: If <span 
class="cmmi-10">P </span>involves only attributes from
     <span 
class="cmmi-10">L</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x222A; </span><span 
class="cmmi-10">L</span><sub><span 
class="cmr-7">2</span></sub>:
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary97x.png" alt="&#x03A0;L1&#x222A;L2 (E1 &#x22B3;&#x22B2;P E2) &#x2261; &#x03A0;L1 (E1) &#x22B3;&#x22B2;P &#x03A0;L2 (E2) .
" class="math-display" ></div>
     <!--l. 1587--><p class="noindent" >Similar equivalences hold for outerjoin operations.
     </li>
<li 
  class="enumerate" id="x1-36027x9">
     <!--l. 1588--><p class="noindent" >Union and intersection are commutative:
<div class="math-display" >
<img 
src="summary98x.png" alt="E1 &#x222A; E2 &#x2261; E2 &#x222A;E1,
" class="math-display" ></div>
     <!--l. 1592--><p class="noindent" >
<div class="math-display" >
<img 
src="summary99x.png" alt="E1 &#x2229; E2 &#x2261; E2 &#x2229;E1.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36029x10">
     <!--l. 1595--><p class="noindent" >Union and intersection are associative:
<div class="math-display" >
<img 
src="summary100x.png" alt="(E1 &#x222A; E2)&#x222A; E3 &#x2261; E1 &#x222A; (E2 &#x222A; E3) ,
" class="math-display" ></div>
     <!--l. 1599--><p class="noindent" >
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary101x.png" alt="(E1 &#x2229; E2)&#x2229; E3 &#x2261; E1 &#x2229; (E2 &#x2229; E3) .
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36031x11">
     <!--l. 1602--><p class="noindent" >The selection operation distributes over <span 
class="cmsy-10">&#x222A;</span><span 
class="cmmi-10">,</span><span 
class="cmsy-10">&#x2229; </span>and <span 
class="cmsy-10">-</span>:
<div class="math-display" >
<img 
src="summary102x.png" alt="&#x03C3;P (E1 &#x222A; E2) &#x2261; &#x03C3;P (E1)&#x222A; &#x03C3;P (E2),
" class="math-display" ></div>
     <!--l. 1606--><p class="noindent" >
<div class="math-display" >
<img 
src="summary103x.png" alt="&#x03C3;P (E1 &#x2229; E2) &#x2261; &#x03C3;P (E1)&#x2229; &#x03C3;P (E2),
" class="math-display" ></div>
     <!--l. 1609--><p class="noindent" >
<div class="math-display" >
<img 
src="summary104x.png" alt="&#x03C3;P (E1 - E2) &#x2261; &#x03C3;P (E1)- &#x03C3;P (E2),
" class="math-display" ></div>
     <!--l. 1612--><p class="noindent" >
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary105x.png" alt="&#x03C3;P (E1 &#x2229;E2 ) &#x2261; &#x03C3;P (E1 )&#x2229;E2,
" class="math-display" ></div>
     <!--l. 1615--><p class="noindent" >
<div class="math-display" >
<img 
src="summary106x.png" alt="&#x03C3;P (E1 - E2 ) &#x2261; &#x03C3;P (E1 )- E2.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-36033x12">
     <!--l. 1618--><p class="noindent" >The projection operation distributes over union:
<div class="math-display" >
<img 
src="summary107x.png" alt="&#x03A0;L (E1 &#x222A; E2) &#x2261; &#x03A0;L(E1) &#x222A;&#x03A0;L (E2).
" class="math-display" ></div>
     </li></ol>
<div class="newtheorem">
<!--l. 1624--><p class="noindent" ><span class="head">
<a 
 id="x1-36034r1"></a>
<span 
class="ecbx-1000">Example 4.1.</span>  </span>Pushing selections.
<!--l. 1627--><p class="indent" >   Query: find the names of all instructors in the Music department, along with the title of the courses that
they teach.
<!--l. 1630--><p class="indent" >   A first RA expression could be the following:
   <div class="math-display" >
<img 
src="summary108x.png" alt="&#x03A0;name,title(&#x03C3;dpt-name= &#x2032;Music&#x2032;(Instructor &#x22B3;&#x22B2; (Teaches &#x22B3;&#x22B2; &#x03A0;course id,title(Course)))).
" class="math-display" ></div>
<!--l. 1634--><p class="indent" >   It can be transformed using rule 7a:
   <div class="math-display" >
<img 
src="summary109x.png" alt="&#x03A0;name,title((&#x03C3;dpt-name= &#x2032;Music&#x2032;(Instructor)) &#x22B3;&#x22B2; (T eaches) &#x22B3;&#x22B2; &#x03A0;course id,title(Course)).
" class="math-display" ></div>
<!--l. 1638--><p class="indent" >   The advantage of doing this is taht by performing the selection as early as possible we are reducing the size
of the relation to be joined.
</div>
<!--l. 1640--><p class="indent" >
<div class="newtheorem">
<!--l. 1642--><p class="noindent" ><span class="head">
<a 
 id="x1-36035r2"></a>
<span 
class="ecbx-1000">Example 4.2.</span>  </span>Pushing projections.
<!--l. 1645--><p class="indent" >   We start with the RA expression:
   <div class="math-display" >
<img 
src="summary110x.png" alt="&#x03A0;name,title((&#x03C3;dpt name=&#x2032;Music&#x2032; (Instructor) &#x22B3;&#x22B2; T eaches) &#x22B3;&#x22B2; &#x03A0;course id,title (Course)).
" class="math-display" ></div>
<!--l. 1649--><p class="indent" >   When we compute
   <div class="math-display" >
<img 
src="summary111x.png" alt="&#x03C3;dpt name=&#x2032;Music&#x2032; (Instructor) &#x22B3;&#x22B2; Teaches,
" class="math-display" ></div>
<!--l. 1653--><p class="indent" >   we   obtain   a   relation   with   schema   <img 
src="summary112x.png" alt="(ID, name,dpt-name,salary,course-id,sec id,semester,year)"  class="left" align="middle">.
Equivalence rule 8 allows to push projections, eeliminating unneeded attributes from intermediate results to
get:
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary113x.png" alt="&#x03A0;name,title((&#x03A0;name,course id(&#x03C3;dpt-name= &#x2032;Music&#x2032; (Instructor) &#x22B3;&#x22B2; Teaches)) &#x22B3;&#x22B2; &#x03A0;course id,title (Course )).
" class="math-display" ></div>
<!--l. 1659--><p class="indent" >   This is useful because performing the projection as early as possible reduces the size of the relation to be
joined. Note that <span 
class="cmmi-10">course</span>_<span 
class="cmmi-10">id </span>needs to be projected because it is needed for the join.
</div>
<!--l. 1662--><p class="indent" >
<div class="newtheorem">
<!--l. 1664--><p class="noindent" ><span class="head">
<a 
 id="x1-36036r3"></a>
<span 
class="ecbx-1000">Example 4.3.</span>  </span>Join ordering.
<!--l. 1667--><p class="indent" >   Consider the expression
   <div class="math-display" >
<img 
src="summary114x.png" alt="&#x03A0;name,title((&#x03C3;dpt name=&#x2032;Music&#x2032; (Instructor) &#x22B3;&#x22B2; T eaches) &#x22B3;&#x22B2; &#x03A0;course id,title (Course)).
" class="math-display" ></div>
<!--l. 1671--><p class="indent" >   In this case, we could compute
   <div class="math-display" >
<img 
src="summary115x.png" alt="T eaches &#x22B3;&#x22B2; &#x03A0;course-id,title(Course )
" class="math-display" ></div>
<!--l. 1675--><p class="indent" >   first, and then join the result with the left relation. The problem with this approach is that doing this join
first seems more likely to be large, as only a small fraction of the university&#8217;s instructor are going to be from
the Music department. So it is better to leave the query as is.
</div>
<!--l. 1680--><p class="indent" >
                                                                                            
                                                                                            
<!--l. 1682--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.4   </span> <a 
 id="x1-370004.4"></a>Enumeration of equivalent expressions</h4>
<!--l. 1684--><p class="noindent" >Query optimizers use equivalence rules to systematically generate expressions equivalent to the given expression, which
is a first translation of the query.
<!--l. 1688--><p class="indent" >   All the equivalent expressions can be generated with the following approach:
   <!--l. 1691-->
   <div class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-37001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">REPEAT</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-37002r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">APPLY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">all</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">applicable</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">equivalence</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">rules</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-37003r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">ON</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">every</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">subexpression</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">of</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">every</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">equivalent</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">expression</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">found</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">so</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">far</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-37004r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">ADD</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">newly</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">generated</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">expressions</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-37005r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">TO</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">the</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">set</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">of</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">equivalent</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">expressions</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-37006r6"></a></span><span style="color:#000000"><span 
class="ectt-1000">UNTIL</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">no</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">new</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">equivalent</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">expressions</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">are</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">generated</span></span></div>
   
<!--l. 1702--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.5   </span> <a 
 id="x1-380004.5"></a>Cost estimation</h4>
<!--l. 1704--><p class="noindent" >The optimizer takes into account the cost of each operator and the statistics of the input relations, such as the number
of tuples and the sizes of the tuples. Also, inputs can be results of sub-expressions, so we need to estimate estatistics of
these results. For this purpose, more statistics, such as the number of distinct values for an attribute, are
used.
<!--l. 1711--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.6   </span> <a 
 id="x1-390004.6"></a>Choice of execution plan</h4>
<!--l. 1713--><p class="noindent" >Once we have generated different equivalent expressions, we need to decide which one to use to execute the query and
get the results. For this, we must consider the interaction of evaluation techniques, because choosing the cheapest
algorithm for each operation disregarding the others may not yield best overall algorithm. For example, a merge-join
may be costlier than a hash-join, but may provide a sorted output which could reduce the cost for an outer level
aggregation.
<!--l. 1721--><p class="indent" >   Practical query optimizers incorporate elements of two broad approaches:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-39002x1">
     <!--l. 1723--><p class="noindent" >Search all the plans and choose the best plan in a cost-based fashion.
     </li>
<li 
  class="enumerate" id="x1-39004x2">
     <!--l. 1724--><p class="noindent" >Uses heuristics to choose a plan.</li></ol>
<!--l. 1727--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">4.6.1   </span> <a 
 id="x1-400004.6.1"></a>Best join-order problem</h5>
<!--l. 1729--><p class="noindent" ><span 
class="ecbx-1000">Problem: </span>find the best join-order for
   <div class="math-display" >
<img 
src="summary116x.png" alt="R  &#x22B3;&#x22B2; R &#x22B3;&#x22B2; ...&#x22B3;&#x22B2; R .
  1    2        n
" class="math-display" ></div>
<!--l. 1734--><p class="indent" >   A first idea could be to check all possibilities and choose the cheapest one. But...
   <div class="newtheorem">
                                                                                            
                                                                                            
<!--l. 1736--><p class="noindent" ><span class="head">
<a 
 id="x1-40001r1"></a>
<span 
class="ecbx-1000">Proposition 4.1.</span>  </span><span 
class="ecti-1000">For the best join-order problem, with </span><span 
class="cmmi-10">n </span><span 
class="ecti-1000">relations involved, there are</span>
   <div class="math-display" >
<img 
src="summary117x.png" alt="(2(n---1))!
   n- 1
" class="math-display" ></div>
<!--l. 1742--><p class="indent" >   <span 
class="ecti-1000">different possible join orders.</span>
   </div>
<!--l. 1743--><p class="indent" >
   <div class="proof">
<!--l. 1745--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>First, we need to count all possible orderings, i.e. the number of permutations, which is known to be <span 
class="cmmi-10">n</span><span 
class="cmr-10">!</span>.
Now, we have to count all possible ways to assign the <span 
class="cmmi-10">n</span><span 
class="cmsy-10">-</span><span 
class="cmr-10">1 </span>needed parenthesis. This is known to be the Catalan
number<span class="footnote-mark"><a 
href="summary7.html#fn5x0"><sup class="textsuperscript">5</sup></a></span><a 
 id="x1-40002f5"></a> 
   <div class="math-display" >
<img 
src="summary118x.png" alt="                (2-(n---1))!-
# ()n-1 = Cn-1 = n!(n- 1)! .
" class="math-display" ></div>
<!--l. 1753--><p class="indent" >   Thus, the total amount is
   <div class="math-display" >
<img 
src="summary119x.png" alt="n!&#x22C5;Cn-1 = n!&#x00D7; (2(n--1))!= (2(n--1))!.
              n!(n - 1)!   (n - 1)!
" class="math-display" ></div>
                                                                                           __
                                                                                            
                                                                                            
   </div>
<!--l. 1758--><p class="indent" >   This number is huge, and it is unfeasable to check the whole search space. Thus, a different approach is
needed.
<!--l. 1761--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-410004.6.1"></a>Dynamic programming approach</h5>
<!--l. 1763--><p class="noindent" >Using dynamic programming, the least-cost join for any subset of <img 
src="summary120x.png" alt="{R1,...,Rn }"  class="left" align="middle"> is computed only once and stored for
future use. The algorithm works as follows:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1767--><p class="noindent" >Consider all possible plans of the form
<div class="math-display" >
<img 
src="summary121x.png" alt="S &#x22B3;&#x22B2; (S - S ),
 1        1
" class="math-display" ></div>
     <!--l. 1771--><p class="noindent" >where <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> is any non-empty subset of <span 
class="cmmi-10">S</span>.
     </li>
     <li class="itemize">
     <!--l. 1772--><p class="noindent" >Recursively compute costs for joinin subsets of <span 
class="cmmi-10">S </span>to find the cost of each plan. Choose the cheapest of the
     <span 
class="cmr-10">2</span><sup><span 
class="cmmi-7">n</span></sup> <span 
class="cmsy-10">- </span><span 
class="cmr-10">2 </span>alternatives.
     </li>
     <li class="itemize">
     <!--l. 1774--><p class="noindent" ><span 
class="ecbx-1000">Base case</span>: single relation access plan.
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 1776--><p class="noindent" >Apply all selections on <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub> using best choice of indices on <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub>.</li></ul>
     </li>
     <li class="itemize">
     <!--l. 1778--><p class="noindent" >When the plan for any subset is computed, we store it and reuse it when it is required again, instead of
     recomputing it.</li></ul>
<!--l. 1781--><p class="noindent" >The pseudocode is shown in Algorithm <a 
href="#x1-41017r1">1<!--tex4ht:ref: alg:procedure-findbestplan(S) --></a>.
                                                                                            
                                                                                            
<!--l. 1784--><p class="indent" >   <a 
 id="x1-41017r1"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 1784-->
<div class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-41001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">!=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">infty</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41002r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">return</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">]</span></span><span style="color:#000000"><span 
class="ectt-1000">¯</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">//</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">else</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">it</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">has</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">not</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">been</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">computed</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">yet</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41004r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">contains</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">only</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">relation</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41005r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">set</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">plan</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">and</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41006r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">based</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">on</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">the</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">best</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">way</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">to</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">access</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41007r7"></a></span><span style="color:#000000"><span 
class="ectt-1000">else</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">non</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">empty</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">proper</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">subset</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">of</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41008r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">P1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">findbestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S1</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41009r9"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">P2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">findbestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">-</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S1</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41010r10"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">best</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">algorithm</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">joining</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">P1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">and</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">P2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41011r11"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">P1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">P2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41012r12"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41013r13"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41014r14"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">cost</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41015r15"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">plan</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">plan</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-41016r16"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">return</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">bestplan</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">]</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 1: </span><span  
class="content"><span 
class="ecbx-1000">procedure </span>findbestplan(S)</span></div><!--tex4ht:label?: x1-41017r1 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
<!--l. 1807--><p class="indent" >   The time complexity of this algorithm is <span 
class="cmmi-10">O</span><img 
src="summary122x.png" alt="(3n)"  class="left" align="middle"> and the space complexity is <span 
class="cmmi-10">O</span><img 
src="summary123x.png" alt="(2n)"  class="left" align="middle">. This is a huge gain with respect
to checking the whole search space, but it is still a very high cost.
   <h5 class="likesubsubsectionHead"><a 
 id="x1-420004.6.1"></a>Left-deep join trees</h5>
<!--l. 1814--><p class="noindent" >In left-deep join trees, the right-hand-side input for each join is a relation, not the result of an intermediate join. In
Figure <a 
href="#x1-42001r3">3<!--tex4ht:ref: fig:A-left-deep-join --></a> we can see an example of what is a left-deep join tree, and what is not.
<!--l. 1819--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                                            
                                                                                            
<a 
 id="x1-42001r3"></a>
                                                                                            
                                                                                            
<!--l. 1820--><p class="noindent" >
<div class="math-display" >
<img 
src="summary124x.png" alt="                                &#x22B3;&#x22B2;


                        &#x22B3;&#x22B2;              R
                                         5


                &#x22B3;&#x22B2;              R4


        &#x22B3;&#x22B2;             R3


R1             R2
" class="math-display" ></div>
<!--l. 1829--><p class="noindent" >
<div class="math-display" >
<img 
src="summary125x.png" alt="                        &#x22B3;&#x22B2;

                &#x22B3;&#x22B2;               &#x22B3;&#x22B2;
                                |
                                |
        &#x22B3;&#x22B2;             R       R       R
                         3       4       5


R1             R2
" class="math-display" ></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3: </span><span  
class="content">A left-deep join tree (top) and not a left-deep join tree (bottom).</span></div><!--tex4ht:label?: x1-42001r3 -->
                                                                                            
                                                                                            
<!--l. 1839--><p class="indent" >   </div><hr class="endfigure">
<!--l. 1841--><p class="indent" >   With this structure, we can reduce the cost of the optimization problem.
<!--l. 1843--><p class="indent" >   For a set of <span 
class="cmmi-10">n </span>relations, we can consider <span 
class="cmmi-10">n </span>alternatives with one relation as right-hand-side input and the other
relations as left-hand-side input.
<!--l. 1847--><p class="indent" >   The time complexity of finding the best join order is in this case <span 
class="cmmi-10">O</span><img 
src="summary126x.png" alt="(n2n)"  class="left" align="middle"> and the space complexity remains the
same.
<!--l. 1850--><p class="indent" >   At this points, one might think that it is of no use bothering with optimizing the order of queries, if it so costful,
but, in reality, typical queries have a small <span 
class="cmmi-10">n</span>, usually less than 10, and a good ordering can change a query from being
unfeasable to being executed in an acceptable time.
   <h5 class="likesubsubsectionHead"><a 
 id="x1-430004.6.1"></a>Heuristic optimization</h5>
<!--l. 1858--><p class="noindent" >As we have seen, cost-based optimization is expensive, even using dynamic programming.
<!--l. 1861--><p class="indent" >   <span 
class="ecbx-1000">Heuristic optimization </span>transforms the query-tree by using a set of rules that typically improve execution
performance. These rules can include:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1865--><p class="noindent" >Perform selection early.
     </li>
     <li class="itemize">
     <!--l. 1866--><p class="noindent" >Perform projection early.
     </li>
     <li class="itemize">
     <!--l. 1867--><p class="noindent" >Peform most restrictive selection and join operations before other similar operations.</li></ul>
<!--l. 1870--><p class="noindent" >Some systems use only heuristics, while others combine the two approaches. A frequently used approach is the
following:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-43002x1">
     <!--l. 1873--><p class="noindent" >Heuristic rewriting of nested block structure and aggregation.
     </li>
<li 
  class="enumerate" id="x1-43004x2">
     <!--l. 1874--><p class="noindent" >A cost-based join-order optimization for each block.</li></ol>
<!--l. 1876--><p class="noindent" >There is usually an <span 
class="ecbx-1000">optimization cost budget </span>to stop optimization early if the cost of the plan is less than the cost of
the optimizations to be made.
<!--l. 1880--><p class="indent" >   Also, it can be useful to implement <span 
class="ecbx-1000">plan caching </span>to reuse previouly computed plans if queries are
resubmitted.
<!--l. 1883--><p class="indent" >   It is worth to note that even with the use of heuristics, cost-based query optimization imposes a substantial
overhead in the computations, but it is worthy for expensive queries. For this reason, optimizers often
use simple heristics for cheap queries, and perform a more exhaustive enumeration for more expensive
queries.
<!--l. 1889--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-440005"></a>Statistics for cost estimation</h3>
<!--l. 1891--><p class="noindent" >Statistics of relations are of great importance for improving the performance of the system, because they allow to
estimate the cost more accurately.
<!--l. 1895--><p class="indent" >   Some statistical information that is used:
                                                                                            
                                                                                            
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1897--><p class="noindent" ><span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">r</span></sub> the number of tuples in relation <span 
class="cmmi-10">r</span>,
     </li>
     <li class="itemize">
     <!--l. 1898--><p class="noindent" ><span 
class="cmmi-10">b</span><sub><span 
class="cmmi-7">r</span></sub> the number of blocks containing tuples of <span 
class="cmmi-10">r</span>,
     </li>
     <li class="itemize">
     <!--l. 1899--><p class="noindent" ><span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">r</span></sub> the size of a tuple of <span 
class="cmmi-10">r</span>,
     </li>
     <li class="itemize">
     <!--l. 1900--><p class="noindent" ><span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">r</span></sub> the blocking factor, or the number of tuples that fit into one block. If the tuples of <span 
class="cmmi-10">r </span>are stored together
     physically in a file, then it is
<div class="math-display" >
<img 
src="summary127x.png" alt="    &#x2308; nr&#x2309;
br =  f- .
       r
" class="math-display" ></div>
     </li>
     <li class="itemize">
     <!--l. 1906--><p class="noindent" ><span 
class="cmmi-10">V </span><img 
src="summary128x.png" alt="(A,r)"  class="left" align="middle"> the number of distinct values that appear in <span 
class="cmmi-10">r </span>for attribute <span 
class="cmmi-10">A</span>.</li></ul>
<!--l. 1910--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-450005.1"></a>Histograms</h4>
<!--l. 1912--><p class="noindent" >Histograms are useful for cost estimation. Histogram can be of two types:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1915--><p class="noindent" ><span 
class="ecbx-1000">Equi-width</span>: the space is divided into <span 
class="cmmi-10">M </span>buckets of the same size.
     </li>
     <li class="itemize">
     <!--l. 1917--><p class="noindent" ><span 
class="ecbx-1000">Equi-depth</span>: the space is divided into <span 
class="cmmi-10">M </span>buckets, in such a way that all buckets have the same number
     of tuples inside.</li></ul>
<!--l. 1920--><p class="noindent" >Many databases store the <span 
class="cmmi-10">n </span>most frequent values and their counts, and they construct histogram for the remaining values.
Usually, they are computed not on all the actual values, but on a sample of them.
<!--l. 1924--><p class="indent" >   This sampling approach make it possible for the statistics to be outdated, so they need to be recomputed:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1927--><p class="noindent" >Some databases require a ANALYZE (VACUUM) command to be explicitly executed to update statistics.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 1929--><p class="noindent" >Others automatically perform the recomputation.</li></ul>
<!--l. 1932--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-460005.2"></a>Estimation of selection size</h4>
<!--l. 1934--><p class="noindent" >We want to estimate the size of a selection, but this depends on the conditions to fullfil:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1937--><p class="noindent" ><span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmmi-7">A</span><span 
class="cmr-7">=</span><span 
class="cmmi-7">v</span></sub><img 
src="summary129x.png" alt="(r)"  class="left" align="middle">: a simple equality condition size is estimated as the size of the relation, divided by the number
     of distinct values for attribute <span 
class="cmmi-10">A</span>:
<div class="math-display" >
<img 
src="summary130x.png" alt="       nr
C = V-(A,r).
" class="math-display" ></div>
     <!--l. 1943--><p class="noindent" >Nonetheless:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 1945--><p class="noindent" >If the attribute is a key attribute: the estimation is 1.
         </li>
         <li class="itemize">
         <!--l. 1946--><p class="noindent" >If the value <span 
class="cmmi-10">v </span>is among the most frequent values of attribute <span 
class="cmmi-10">A</span>, we can give more accurate estimations.</li></ul>
     </li>
     <li class="itemize">
     <!--l. 1949--><p class="noindent" ><span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmmi-7">A</span><span 
class="cmsy-7">&#x2264;</span><span 
class="cmmi-7">v</span></sub><img 
src="summary131x.png" alt="(r)"  class="left" align="middle">: a simple inequality condition is more complex than before. Let <span 
class="cmmi-10">c </span>denote the estimated number of
     tuples satisfying the condition. If <span 
class="cmmi-10">m </span><span 
class="cmr-10">=</span> <span 
class="cmr-10">min</span><img 
src="summary132x.png" alt="(A, r)"  class="left" align="middle"> and <span 
class="cmmi-10">M </span><span 
class="cmr-10">=</span> <span 
class="cmr-10">max</span><img 
src="summary133x.png" alt="(A,r)"  class="left" align="middle"> are available in the catalog
     then:
<div class="math-display" >
<img 
src="summary134x.png" alt="    {
c =  0, v-m   if v &#x003C; m &#x2228; v &#x003E; M
     nr M-m-, otherwise
" class="math-display" ></div>
     <!--l. 1959--><p class="noindent" >So, we approximate by a linear interpolation over the total number of records. Note that if histograms are
     available, this estimation can be refined by summing all buckets below <span 
class="cmmi-10">v </span>and interpolating only in the bucket in
     which <span 
class="cmmi-10">v </span>lies.
     <!--l. 1964--><p class="noindent" >When there is a lack of statistical information, <span 
class="cmmi-10">c </span>is assumed to be <img 
src="summary135x.png" alt="nr
2"  class="frac" align="middle">.</li></ul>
                                                                                            
                                                                                            
<!--l. 1967--><p class="noindent" >For more complex conditions, we need a new definition:
   <div class="tcolorbox tcolorbox" id="tcolobox-4">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 1970--><p class="noindent" ><span class="head">
<a 
 id="x1-46001r1"></a>
<span 
class="ecbx-1000">Definition 5.1.</span>   </span>The <span 
class="ecbx-1000">selectivity </span>of a condition <span 
class="cmmi-10">P </span>is the probability that a tuple in the relation <span 
class="cmmi-10">r </span>satisfies
<span 
class="cmmi-10">P</span>. If <span 
class="cmmi-10">s</span><sub><span 
class="cmmi-7">P</span></sub> is the number of tuples satisfying the condition, then the selectivity is given by
<div class="math-display" >
<img 
src="summary136x.png" alt="     s
SP = -P.
     nr
" class="math-display" ></div>
</div>
<!--l. 1978--><p class="noindent" >
 
</div> 
</div>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1982--><p class="noindent" ><span 
class="ecbx-1000">Conjunction</span>, <span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmmi-7">P</span><sub><span 
class="cmr-5">1</span></sub><span 
class="cmsy-7">&#x2227;</span><span 
class="cmmi-7">...</span><span 
class="cmsy-7">&#x2227;</span><span 
class="cmmi-7">P</span><sub><span 
class="cmmi-5">k</span></sub></sub><img 
src="summary137x.png" alt="(r)"  class="left" align="middle">: assuming independence, we have
<div class="math-display" >
<img 
src="summary138x.png" alt="c = nr &#x00D7; SP1 &#x00D7; ...&#x00D7; SPk = nrsP1 &#x22C5;...n&#x22C5;sPk.
                             nr
" class="math-display" ></div>
     </li>
     <li class="itemize">
     <!--l. 1987--><p class="noindent" ><span 
class="ecbx-1000">Disjunction</span>, <span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmmi-7">P</span><sub><span 
class="cmr-5">1</span></sub><span 
class="cmsy-7">&#x2228;</span><span 
class="cmmi-7">...</span><span 
class="cmsy-7">&#x2228;</span><span 
class="cmmi-7">P</span><sub><span 
class="cmmi-5">k</span></sub></sub><img 
src="summary139x.png" alt="(r)"  class="left" align="middle">: we do the following
<div class="math-display" >
<img 
src="summary140x.png" alt="                        (----------)       ( ----------)          (---     ---)
P rob(A1 &#x2228; ...&#x2228; Ak) = P rob A1 &#x2228; ...&#x2228; Ak = Prob A1 &#x2227; ...&#x2227; Ak = 1- Prob A1 &#x2227; ...&#x2227;Ak  ,
                                                                                            
                                                                                            
" class="math-display" ></div>
     <!--l. 1992--><p class="noindent" >which, assuming independence is equal to
<div class="math-display" >
<img 
src="summary141x.png" alt="        (--)         (--)
1- P rob A1 &#x22C5;...&#x22C5;P rob Ak  = 1 - (1 - P rob(A1))&#x22C5;...&#x22C5;(1- Prob(Ak)).
" class="math-display" ></div>
     <!--l. 1996--><p class="noindent" >So, it is
<div class="math-display" >
<img 
src="summary142x.png" alt="        [   (       )     (       )]
c = n &#x00D7;  1 -  1- sP1  &#x22C5;...&#x22C5; 1 - sPk   .
     r            nr           nr
" class="math-display" ></div>
     </li>
     <li class="itemize">
     <!--l. 2000--><p class="noindent" ><span 
class="ecbx-1000">Negation</span>, <span 
class="cmmi-10">&#x03C3;</span><sub><span 
class="cmsy-7">¬</span><span 
class="cmmi-7">P</span></sub><img 
src="summary143x.png" alt="(R )"  class="left" align="middle">: this is just
<div class="math-display" >
<img 
src="summary144x.png" alt="c = nr &#x22C5;(1 - SP ) = nr - nrSP = nr - sp.
" class="math-display" ></div>
     </li></ul>
<!--l. 2006--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3   </span> <a 
 id="x1-470005.3"></a>Estimation of the size of joins</h4>
<!--l. 2008--><p class="noindent" >The <span 
class="ecbx-1000">cartesian product </span>of two relations <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> contains exactly <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">1</span></sub></sub> <span 
class="cmsy-10">&#x00D7;</span><span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">2</span></sub></sub> tuples, and each tuple occupies <span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">1</span></sub></sub> <span 
class="cmr-10">+ </span><span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">2</span></sub></sub>
bytes.
<!--l. 2012--><p class="indent" >   About the join:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2014--><p class="noindent" >If <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2229; </span><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmr-10">= </span><span 
class="cmsy-10">&#x2205;</span>, then <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary145x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> is the same as <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x00D7; </span><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub>.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 2016--><p class="noindent" >If <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2229; </span><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> is a key for <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub>, then a tuple of <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> will join with at most one tuple from <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub>, so the number of
     tuples in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary146x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> is, at most, the number of tuples in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub>.
     </li>
     <li class="itemize">
     <!--l. 2019--><p class="noindent" >If <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2229; </span><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> is a foreign key in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> referencing <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub>, then the number of tuples in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary147x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> is exactly the same as
     the number of tuples in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub>.
     </li>
     <li class="itemize">
     <!--l. 2022--><p class="noindent" >If <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2229;</span><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmr-10">= </span><img 
src="summary148x.png" alt="{A }"  class="left" align="middle"> is not a key for <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> nor <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub>: let assume that every tuple <span 
class="cmmi-10">t </span>in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub> produces tuples in the join,
     then the number of tuples in the join is estimated to be
<div class="math-display" >
<img 
src="summary149x.png" alt="    nr1 &#x22C5;nr2
c = V (A,r2),
" class="math-display" ></div>
     <!--l. 2029--><p class="noindent" >i.e., the number of tuples in the cartesian product, divided by the number of different values for the
     attribute <span 
class="cmmi-10">A </span>in the second relation. This is because each value in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub>  will join with more or less <img 
src="summary150x.png" alt="-nr2--
V(A,r2)"  class="frac" align="middle">
     values.
     <!--l. 2034--><p class="noindent" >If we assume the reverse, i.e., every tuple in <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub> produces tuples, then we get
<div class="math-display" >
<img 
src="summary151x.png" alt="    n  &#x22C5;n
c = -r1--r2,
    V (A,r1)
" class="math-display" ></div>
     <!--l. 2039--><p class="noindent" >for the same reason.
     <!--l. 2041--><p class="noindent" >The lower of these two estimates is probably the most accurate one, so both are computed and the best
     one is chosen.
     <!--l. 2044--><p class="noindent" >This estimates can be improved using histograms, by using the same formula but on each bucket, and
     summing them up.
     </li></ul>
<div class="newtheorem">
<!--l. 2048--><p class="noindent" ><span class="head">
<a 
 id="x1-47001r1"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 5.1.</span>  </span>Estimating the size of a join.
<!--l. 2051--><p class="indent" >   Let perform
   <div class="math-display" >
<img 
src="summary152x.png" alt="student &#x22B3;&#x22B2; takes
" class="math-display" ></div>
<!--l. 2055--><p class="indent" >   with the following information:
</div>
<!--l. 2056--><p class="indent" >
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2058--><p class="noindent" ><span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">student</span></sub> <span 
class="cmr-10">= 5000</span><span 
class="cmmi-10">,f</span><sub><span 
class="cmmi-7">student</span></sub> <span 
class="cmr-10">= 50 </span>so <span 
class="cmmi-10">b</span><sub><span 
class="cmmi-7">student</span></sub> <span 
class="cmr-10">=</span> <img 
src="summary153x.png" alt="505000"  class="frac" align="middle"> <span 
class="cmr-10">= 100</span>.
     </li>
     <li class="itemize">
     <!--l. 2059--><p class="noindent" ><span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">takes</span></sub> <span 
class="cmr-10">= 10000</span><span 
class="cmmi-10">,f</span><sub><span 
class="cmmi-7">takes</span></sub> <span 
class="cmr-10">= 25 </span>so <span 
class="cmmi-10">b</span><sub><span 
class="cmmi-7">takes</span></sub> <span 
class="cmr-10">=</span> <img 
src="summary154x.png" alt="1002050"  class="frac" align="middle"> <span 
class="cmr-10">= 400</span>.
     </li>
     <li class="itemize">
     <!--l. 2060--><p class="noindent" ><span 
class="cmmi-10">V </span><img 
src="summary155x.png" alt="(ID,takes)"  class="left" align="middle"> <span 
class="cmr-10">= 2500</span>, so, on average, each student that has taken a course, has taken 4 courses.
     </li>
     <li class="itemize">
     <!--l. 2062--><p class="noindent" >The  attribute  <span 
class="cmmi-10">ID  </span>in  takes  is  a  foreign  key  referencing  <span 
class="cmmi-10">student</span>,  in  which  it  is  a  primary  key:
     <span 
class="cmmi-10">V </span><img 
src="summary156x.png" alt="(ID,student)"  class="left" align="middle"> <span 
class="cmr-10">= 5000</span>.</li></ul>
<!--l. 2065--><p class="noindent" >The most accurate estimation in this case is the one using the fact that <span 
class="cmmi-10">ID </span>is a foreign key, which implies that the number
of tuples is the same as the number of the referencing relation, <span 
class="cmmi-10">takes</span>, so
   <div class="math-display" >
<img 
src="summary157x.png" alt="c = ntakes = 10000.
" class="math-display" ></div>
<!--l. 2071--><p class="indent" >   Let&#8217;s nonetheless compute an estimate disregarding this:
   <div class="math-display" >
                                                                                            
                                                                                            
<img 
src="summary158x.png" alt="c1 = 5000&#x22C5;10000 = 20000,
       2500
" class="math-display" ></div>
<!--l. 2075--><p class="indent" >
   <div class="math-display" >
<img 
src="summary159x.png" alt="c = 5000&#x22C5;10000 = 10000.
2      5000
" class="math-display" ></div>
<!--l. 2078--><p class="indent" >   We choose the lower estimate, <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">2</span></sub>, which in this case is the same as the one we chose before! But this is
no surprise, this will always happen with foreign keys, because <span 
class="cmmi-10">V </span><img 
src="summary160x.png" alt="(A,r1)"  class="left" align="middle"> <span 
class="cmr-10">= </span><span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">1</span></sub></sub> if <span 
class="cmmi-10">A </span>is key, so we would
have
   <div class="math-display" >
<img 
src="summary161x.png" alt="     nr1 &#x22C5;nr2
c2 =   nr1  = nr2,
" class="math-display" ></div>
<!--l. 2085--><p class="indent" >   which is the same value that we get using the other estimation. Also, <span 
class="cmmi-10">V </span><img 
src="summary162x.png" alt="(A,r2)"  class="left" align="middle"> will be at most <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">r</span><sub><span 
class="cmr-5">1</span></sub></sub>, because it is a
foreign key, so it cannot have more values than the referenced attribute!
<!--l. 2090--><p class="indent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;III<br /></span><a 
 id="x1-48000III"></a>Indexing</h1>
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-490006"></a>Conventional indexes</h3>
   <div class="tcolorbox tcolorbox" id="tcolobox-5">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 2097--><p class="noindent" ><span class="head">
<a 
 id="x1-49001r1"></a>
<span 
class="ecbx-1000">Definition 6.1.</span>   </span>An <span 
class="ecbx-1000">index </span>is a data structure that facilitates the recovering of data. The idea is to
maintain pointers to the specific directions where some data is stored.
</div>
<!--l. 2101--><p class="noindent" >
 
</div> 
</div>
<!--l. 2104--><p class="noindent" >As we know, the disk can be logically seen as a sequence of pages of a certain size. Every file that we store in a
computer must be stored in one or more pages. Now, imagine we want to retrieve a file&#8217;s content. For this, we need to
fetch the data from where it is stored. If we don&#8217;t use indexes, we would need to sequentially traverse the disk until we
find the desired file.
   <div class="newtheorem">
<!--l. 2110--><p class="noindent" ><span class="head">
<a 
 id="x1-49002r1"></a>
<span 
class="ecbx-1000">Example 6.1.</span>  </span>Imagine a simplified setup with a disk of <span 
class="cmmi-10">N </span>pages and with files that occupy one page. If we
need to recover a specific file that is stored in memory, without further information, it would take an average
of <img 
src="summary163x.png" alt="N-
2"  class="frac" align="middle"> pages to be fetched.
   </div>
<!--l. 2115--><p class="indent" >
An index can be used to mitigate this impact. There are multiple types of indexes, but the simplest form of an index is
just a map in which each file identifier is associated to the direction of its first byte in memory. This way, only knowing
which file we want to recover, we can access it directly using the index.
   <div class="newtheorem">
<!--l. 2121--><p class="noindent" ><span class="head">
<a 
 id="x1-49003r2"></a>
<span 
class="ecbx-1000">Example 6.2.</span>  </span>In the previous setup, imagine we store an index in the first page. In this scenario, to recover a
specific file we need to fetch the first page, look the index to get the direction of our file, and directly fetch the
correct page. In total, we would fetch 2 pages.
   </div>
<!--l. 2126--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-6">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 2128--><p class="noindent" ><span class="head">
<a 
 id="x1-49004r2"></a>
<span 
class="ecbx-1000">Definition 6.2.</span>   </span>A <span 
class="ecbx-1000">dense index </span>is an index that maintains one pointer per key.
</div>
<!--l. 2131--><p class="noindent" >
 
</div> 
</div>
                                                                                            
                                                                                            
<!--l. 2134--><p class="indent" >   Properties of dense indexes:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2136--><p class="noindent" >If a key is not listed, the key does not exist.
     </li>
     <li class="itemize">
     <!--l. 2137--><p class="noindent" >They can be used in sequential and non-sequential files.
     </li>
     <li class="itemize">
     <!--l. 2138--><p class="noindent" >Querying a dense index is more efficient than querying a sequential file because we will likely retrieve less
     pages from disk to memory.
     </li>
     <li class="itemize">
     <!--l. 2140--><p class="noindent" >They are usually ordered, so searchs can be done using the binary search algorithm.</li></ul>
<div class="newtheorem">
<!--l. 2143--><p class="noindent" ><span class="head">
<a 
 id="x1-49005r3"></a>
<span 
class="ecbx-1000">Example 6.3.</span>  </span>A dense index.
<!--l. 2146--><p class="indent" >   A dense index on a sequential file looks like this:
<!--l. 2148--><p class="indent" >   <img 
src="2_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___hitecture_LectureNotes_source_dense_idx_seq.png" alt="PIC"  
width="43" height="43" >
<!--l. 2150--><p class="indent" >   And on a non-sequential file like this:
<!--l. 2152--><p class="indent" >   <img 
src="3_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___ecture_LectureNotes_source_dense_idx_nonseq.png" alt="PIC"  
width="43" height="43" >
<!--l. 2154--><p class="indent" >   If we want to retrieve the segment with key=30, we would do binary search in the index and then we would
get the disk direction of this segment.
<!--l. 2158--><p class="indent" >   If we are asked to retrieve a segment with a key that is not in the index, we would directly return an error
after searching for it and not finding it, because we are sure there is no segment with that key in the disk. For
example, there is no segment with key 25, and so there is no entry in the index with key 25.
</div>
<!--l. 2163--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-7">    
<div class="tcolorbox-title">
</div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 2165--><p class="noindent" ><span class="head">
<a 
 id="x1-49006r3"></a>
<span 
class="ecbx-1000">Definition 6.3.</span>  </span>A <span 
class="ecbx-1000">sparse index </span>maintains a pointer per page/block. This means that only the first
key on the each block.
</div>
<!--l. 2168--><p class="noindent" >
 
</div> 
</div>
<!--l. 2171--><p class="noindent" >Properties of sparse index:
     <ul class="itemize1">
     <li class="itemize">
                                                                                            
                                                                                            
     <!--l. 2173--><p class="noindent" >They are also sorted, so binary search can be conducted to find the requested key. In this case, we are
     looking for the biggest key that is less than the requested key. We then would go to the page where this
     key is and scan sequentially until we reach the requested key or a key bigger than it, in which case we
     would return an error.
     </li>
     <li class="itemize">
     <!--l. 2178--><p class="noindent" >They need less space than dense indexes.
     </li>
     <li class="itemize">
     <!--l. 2179--><p class="noindent" >Can only be used in sequential files, because the basic idea for sparse indexes to work is that data is sorted
     in the same way as the index.</li></ul>
<div class="newtheorem">
<!--l. 2182--><p class="noindent" ><span class="head">
<a 
 id="x1-49007r4"></a>
<span 
class="ecbx-1000">Example 6.4.</span>  </span>Sparse index.
<!--l. 2185--><p class="indent" >   A sparse index looks like this:
<!--l. 2187--><p class="indent" >   <img 
src="4_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___itecture_LectureNotes_source_sparse_idx_seq.png" alt="PIC"  
width="43" height="43" >
<!--l. 2189--><p class="indent" >   If we want to retrieve the segment with key=30, the procedure is exactly as with a dense index.
<!--l. 2192--><p class="indent" >   If we want to retrieve the segment with key=40, then we would search for 30 (the biggest key smaller than
40), we would go to where it is. Then, we would advance until we found the segment with key=40.
<!--l. 2196--><p class="indent" >   If we want to retrieve the segment with key=25, we would search for 10, we would go to where it is. Then,
we would advance until we reached the end of the page, and we would return an error, because now we are sure
there is no segment with key=25.
</div>
<!--l. 2200--><p class="indent" >
<!--l. 2202--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-500006.1"></a>Sparse second level index</h4>
<!--l. 2204--><p class="noindent" >When an index becomes very big, the searchs start to slow down, because the binary search needs to be done over a
bigger index, which can even occupy several pages, which would need to be fetched.
<!--l. 2208--><p class="indent" >   When this happen, a possible way to speed up the search is to add a sparse index that points to the already defined
index.
   <div class="newtheorem">
<!--l. 2210--><p class="noindent" ><span class="head">
<a 
 id="x1-50001r5"></a>
<span 
class="ecbx-1000">Example 6.5.</span>  </span>A second level sparse index.
<!--l. 2213--><p class="indent" >   In this diagram we can see a second level sparse index on a sparse index:
<!--l. 2216--><p class="indent" >   <img 
src="5_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___ture_LectureNotes_source_sparse_idx_2nd_lvl.png" alt="PIC"  
width="36" height="36" >
<!--l. 2218--><p class="indent" >   If we wanted to retrieve the segment with key=30, we would check the 2nd level sparse index, we would get
the page where the index should have this key stored. We would go to this page, and we would find the key=30
already in the index, so we would go to the indicated direction.
   </div>
<!--l. 2222--><p class="indent" >
<span 
class="ecbx-1000">Question: </span>does it make sense to use a second level dense index?
<!--l. 2226--><p class="indent" >   No, it would be a copy of the first level index, so we would not gain anything. Second level indexes are sparse. Note,
nonetheless, that the first level index can indeed be of any kind.
<!--l. 2230--><p class="indent" >   <span 
class="ecbx-1000">Question: </span>what is the tradeoff between sparse and dense indexes?
                                                                                            
                                                                                            
<!--l. 2232--><p class="indent" >   Sparse indexes needs less space to be stored and this also allows to have a bigger part of the index in memory
when we need it. On the other hand, dense indexes can tell if any record exists without accessing the
files.
<!--l. 2237--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-510006.2"></a>How to deal with duplicate keys.</h4>
<!--l. 2239--><p class="noindent" >Imagine we have a disk with the following data:
<div class="center" 
>
<!--l. 2240--><p class="noindent" >
<!--l. 2241--><p class="noindent" ><img 
src="6_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___hitecture_LectureNotes_source_dup_keys_disk.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2244--><p class="indent" >   A naïve solution would be to just use a dense index, where all the keys are listed repeatedly:
<div class="center" 
>
<!--l. 2246--><p class="noindent" >
<!--l. 2247--><p class="noindent" ><img 
src="7_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___ture_LectureNotes_source_dup_keys_dense_idx.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2250--><p class="indent" >   In this case, we are solving the problem of duplicate keys... but we are probably using more space that we wanted. It
would be better to have unique keys in the indexes. Thus, a second approach could be to only store the first appearance
of each key, and use it to fetch the data, scanning sequentially until all records with the same key have been retrieved.
This is illustrated below:
<div class="center" 
>
<!--l. 2256--><p class="noindent" >
<!--l. 2257--><p class="noindent" ><img 
src="8_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___tecture_LectureNotes_source_dup_keys_2ndway.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2260--><p class="indent" >   See, nonetheless, that this solution requires that the file is sequentially stored in memory, because when we recover
the second segment with key=10, in order to recover the third one, the only possible way is to continue a sequential
scan.
<!--l. 2265--><p class="indent" >   Now, a third approach is an intermediate approach: we can use a sparse index with duplicate keys, meaning we
index the first key in each page:
<div class="center" 
>
<!--l. 2268--><p class="noindent" >
<!--l. 2269--><p class="noindent" ><img 
src="9_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___tecture_LectureNotes_source_dup_keys_sparse.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2272--><p class="indent" >   In this case, when we want to search for a key, we always need to go to the biggest key that is smaller than the
requested one, even if the requested one is in the index keyset. For example, if in the example above we used the
indexed direction for key=20, we would miss the first record of this key.
<!--l. 2278--><p class="indent" >   An improved version of this solution is to index only the first new key in each page:
<div class="center" 
>
<!--l. 2280--><p class="noindent" >
<!--l. 2281--><p class="noindent" ><img 
src="10_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ture_LectureNotes_source_dup_keys_sparse_v2.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2284--><p class="indent" >   Note that in this case, all keys will be listed once, so we don&#8217;t need to retrieve the file for inexistent keys, but
sequentially ios required.
                                                                                            
                                                                                            
<!--l. 2288--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.3   </span> <a 
 id="x1-520006.3"></a>How to delete records</h4>
<!--l. 2290--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">6.3.1   </span> <a 
 id="x1-530006.3.1"></a>Deletion from sparse index with no duplicates</h5>
<!--l. 2292--><p class="noindent" >If we want to delete a record, we need to make sure that the index is updated if needed. The steps to delete a record are
the following:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-53002x1">
     <!--l. 2295--><p class="noindent" >To delete key <span 
class="cmmi-10">K</span>, do a binary search in the index.
     </li>
<li 
  class="enumerate" id="x1-53004x2">
     <!--l. 2296--><p class="noindent" >Depending if <span 
class="cmmi-10">K </span>is in the index or not:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-53006x1">
         <!--l. 2298--><p class="noindent" >If <span 
class="cmmi-10">K </span>is not in the index we visit the direction of the biggest key that is smaller than the requested
         one. We advance until we find the record with key <span 
class="cmmi-10">K </span>and we delete it.
         </li>
<li 
  class="enumerate" id="x1-53008x2">
         <!--l. 2301--><p class="noindent" >If <span 
class="cmmi-10">K </span>is in the index, we visit its direction and we delete it. Now, two possibilities arise:
             <ol  class="enumerate3" >
<li 
  class="enumerate" id="x1-53010x1">
             <!--l. 2304--><p class="noindent" >If there are more records in the same page, we shift them up, and we update the key.
             </li>
<li 
  class="enumerate" id="x1-53012x2">
             <!--l. 2306--><p class="noindent" >If there no more records in the same page, we delete the key from the index and we shift the rest
             of the keys up.</li></ol>
         </li></ol>
     </li></ol>
<div class="newtheorem">
<!--l. 2311--><p class="noindent" ><span class="head">
<a 
 id="x1-53013r6"></a>
<span 
class="ecbx-1000">Example 6.6.</span>  </span>Case 2.(a): DELETE 40
   <div class="tabular"> <table id="TBL-4" class="tabular" 
 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-1"  
class="td11"> Initial state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-2"  
class="td11"> Final state  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-1"  
class="td11"> <img 
src="4_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___itecture_LectureNotes_source_sparse_idx_seq.png" alt="PIC"  
width="28" height="28" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-2"  
class="td11"> <img 
src="11_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_sparse_idx_delete40.png" alt="PIC"  
width="28" height="28" ></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-4-3-1"  
class="td11">          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Legend</div>                
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-1"  
class="td11">     Red       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-2"  
class="td11">   Delete     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-1"  
class="td11"> </td> </tr></table>
</div>
</div>
<!--l. 2328--><p class="indent" >
<div class="newtheorem">
<!--l. 2330--><p class="noindent" ><span class="head">
<a 
 id="x1-53014r7"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 6.7.</span>  </span>Case 2.(b).i.: DELETE 30
   <div class="tabular"> <table id="TBL-5" class="tabular" 
 
><colgroup id="TBL-5-1g"><col 
id="TBL-5-1"></colgroup><colgroup id="TBL-5-2g"><col 
id="TBL-5-2"></colgroup><colgroup id="TBL-5-3g"><col 
id="TBL-5-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-1-1"  
class="td11"> Initial state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-1-2"  
class="td11"> Second state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-1-3"  
class="td11"> Final state  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-1"  
class="td11"> <img 
src="4_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___itecture_LectureNotes_source_sparse_idx_seq.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-2"  
class="td11"> <img 
src="12_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___e_LectureNotes_source_sparse_idx_delete30_1.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-3"  
class="td11"> <img 
src="13_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___e_LectureNotes_source_sparse_idx_delete30_2.png" alt="PIC"  
width="18" height="18" ></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-3-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-5-3-1"  
class="td11">                 <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Legend</div>                           
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-4-1"  
class="td11">     Red       </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-5-4-2"  
class="td11">          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Delete</div>                </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-5-1"  
class="td11"> Yellow </td> <td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-5-5-2"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Update</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-6-1"  
class="td11">             </td> </tr></table></div>
</div>
<!--l. 2352--><p class="indent" >
<div class="newtheorem">
<!--l. 2354--><p class="noindent" ><span class="head">
<a 
 id="x1-53015r8"></a>
<span 
class="ecbx-1000">Example 6.8.</span>  </span>Case 2.(b).ii.: DELETE 30 and 40
   <div class="tabular"> <table id="TBL-6" class="tabular" 
 
><colgroup id="TBL-6-1g"><col 
id="TBL-6-1"></colgroup><colgroup id="TBL-6-2g"><col 
id="TBL-6-2"></colgroup><colgroup id="TBL-6-3g"><col 
id="TBL-6-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-1-1"  
class="td11"> Initial state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-1-2"  
class="td11"> Second state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-1-3"  
class="td11"> Final state  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-1"  
class="td11"> <img 
src="4_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___itecture_LectureNotes_source_sparse_idx_seq.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-2"  
class="td11"> <img 
src="14_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___LectureNotes_source_sparse_idx_delete3040_1.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-3"  
class="td11"> <img 
src="15_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___LectureNotes_source_sparse_idx_delete3040_2.png" alt="PIC"  
width="18" height="18" ></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-3-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-6-3-1"  
class="td11">                 <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Legend</div>                           
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-4-1"  
class="td11">     Red       </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-6-4-2"  
class="td11">          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Delete</div>                </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-5-1"  
class="td11"> Yellow </td> <td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-6-5-2"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Update</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-6-1"  
class="td11">             </td> </tr></table></div>
</div>
<!--l. 2376--><p class="indent" >
<!--l. 2379--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">6.3.2   </span> <a 
 id="x1-540006.3.2"></a>Deletion from dense index</h5>
<!--l. 2381--><p class="noindent" >In this case, we will always find the keys to delete in the index, so the steps are easier:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-54002x1">
     <!--l. 2384--><p class="noindent" >To delete key <span 
class="cmmi-10">K</span>, do a binary search on the index.
     </li>
<li 
  class="enumerate" id="x1-54004x2">
     <!--l. 2385--><p class="noindent" >Delete records in the corresponding page, shifting up the rest of the records to not leave holes.
     </li>
<li 
  class="enumerate" id="x1-54006x3">
     <!--l. 2387--><p class="noindent" >Update all shifted records.</li></ol>
<div class="newtheorem">
<!--l. 2389--><p class="noindent" ><span class="head">
<a 
 id="x1-54007r9"></a>
<span 
class="ecbx-1000">Example 6.9.</span>  </span>Deletion from dense index: DELETE 30
   <div class="tabular"> <table id="TBL-7" class="tabular" 
 
><colgroup id="TBL-7-1g"><col 
id="TBL-7-1"></colgroup><colgroup id="TBL-7-2g"><col 
id="TBL-7-2"></colgroup><colgroup id="TBL-7-3g"><col 
id="TBL-7-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-1-1"  
class="td11"> Initial state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-1-2"  
class="td11"> Second state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-1-3"  
class="td11"> Final state  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-1"  
class="td11"> <img 
src="2_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_DB___hitecture_LectureNotes_source_dense_idx_seq.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-2"  
class="td11"> <img 
src="16_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___re_LectureNotes_source_dense_idx_delete30_1.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-3"  
class="td11"> <img 
src="17_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___re_LectureNotes_source_dense_idx_delete30_2.png" alt="PIC"  
width="18" height="18" ></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-3-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-7-3-1"  
class="td11">                 <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Legend</div>                           
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-1"  
class="td11">     Red       </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-7-4-2"  
class="td11">          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Delete</div>                </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-1"  
class="td11"> Yellow </td> <td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-7-5-2"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Update</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-1"  
class="td11">             </td> </tr></table></div>
</div>
<!--l. 2411--><p class="indent" >
                                                                                            
                                                                                            
<!--l. 2413--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.4   </span> <a 
 id="x1-550006.4"></a>How to insert records</h4>
<!--l. 2415--><p class="noindent" >We need to follow the next steps<span class="footnote-mark"><a 
href="summary8.html#fn6x0"><sup class="textsuperscript">6</sup></a></span><a 
 id="x1-55001f6"></a> :
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-55003x1">
     <!--l. 2417--><p class="noindent" >We want to insert record with key <span 
class="cmmi-10">K</span>. First, we do a binary search to see where it should be located.
     </li>
<li 
  class="enumerate" id="x1-55005x2">
     <!--l. 2419--><p class="noindent" >Now, in the first page that it can be located according to the index, two things can happen:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-55007x1">
         <!--l. 2422--><p class="noindent" >If there is space for the record: we insert it.
         </li>
<li 
  class="enumerate" id="x1-55009x2">
         <!--l. 2423--><p class="noindent" >If there is not space for the record: we need to shift the following records down, updating the necessary
         index entries.</li></ol>
     </li></ol>
<div class="newtheorem">
<!--l. 2427--><p class="noindent" ><span class="head">
<a 
 id="x1-55010r10"></a>
<span 
class="ecbx-1000">Example 6.10.</span>  </span>INSERT 15
   <div class="tabular"> <table id="TBL-8" class="tabular" 
 
><colgroup id="TBL-8-1g"><col 
id="TBL-8-1"></colgroup><colgroup id="TBL-8-2g"><col 
id="TBL-8-2"></colgroup><colgroup id="TBL-8-3g"><col 
id="TBL-8-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-1-1"  
class="td11"> Initial state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-1-2"  
class="td11"> Second state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-1-3"  
class="td11"> Final state  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-2-1"  
class="td11"> <img 
src="18_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_sparse_idx_insert_0.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-8-2-2"  
class="td11"> <img 
src="19_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_sparse_idx_insert_1.png" alt="PIC"  
width="18" height="18" > </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-8-2-3"  
class="td11"> <img 
src="20_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_sparse_idx_insert_2.png" alt="PIC"  
width="18" height="18" ></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-3-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-8-3-1"  
class="td11">                 <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Legend</div>                           
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-4-1"  
class="td11">     Red       </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-8-4-2"  
class="td11">          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Delete</div>                </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-5-1"  
class="td11"> Yellow </td> <td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-8-5-2"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Update</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-6-1"  
class="td11">    Green      </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-8-6-2"  
class="td11">           <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Insert</div>                 </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-8-7-1"  
class="td11"> </td> </tr></table>
</div>
</div>
<!--l. 2452--><p class="indent" >
   <h4 class="subsectionHead"><span class="titlemark">6.5   </span> <a 
 id="x1-560006.5"></a>Secondary indexes</h4>
<!--l. 2456--><p class="noindent" >Imagine we have an unordered file in memory, which we would like to be able to traverse in order without implying
great costs. If we try to do this by sequentially scanning the disk, we would need to fetch several times each page and it
would be highly inneficient, so we could think on using indexes to solve this problem.
<!--l. 2462--><p class="indent" >   As we have seen, sparse indexes cannot be used with unordered files (some records would be lost), so our only option
here is to use an ordered dense index that enables us to recover each record in the desired order. Now, as we are
indexing the whole file with an dense index, it is likely that the index is huge, so it seems convenient to add a second
level sparse index to speed things up even more.
<!--l. 2469--><p class="indent" >   This is a secondary index:
   <div class="tcolorbox tcolorbox" id="tcolobox-8">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 2472--><p class="noindent" ><span class="head">
<a 
 id="x1-56001r4"></a>
<span 
class="ecbx-1000">Definition 6.4.</span>   </span>A <span 
class="ecbx-1000">secondary index </span>is a <span 
class="cmmi-10">N</span>-level index structure, composed by a first-level dense index
and the rest of the levels are sparse. All this indexes are ordered to make use of binary search, in order
to be capable of recovering unsequentially stored records from disk efficiently.
</div>
<!--l. 2478--><p class="noindent" >
 
</div> 
</div>
<!--l. 2482--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">6.5.1   </span> <a 
 id="x1-570006.5.1"></a>Duplicate values and secondary indexes</h5>
<!--l. 2484--><p class="noindent" >Again, duplicate keys pose a problem to secondary indexes. Think in the following setup:
<div class="center" 
>
<!--l. 2486--><p class="noindent" >
<!--l. 2487--><p class="noindent" ><img 
src="21_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___cture_LectureNotes_source_second_index_disk.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2490--><p class="indent" >   Here, the solutions that we proposed before don&#8217;t work, because for them we needed sequentially stored files. In this
case, again, the naïve solution is a dense index:
<div class="center" 
>
<!--l. 2493--><p class="noindent" >
<!--l. 2494--><p class="noindent" ><img 
src="22_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___itecture_LectureNotes_source_second_index_0.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2497--><p class="indent" >   The problem with this solution is that this cause an excessive overhead, both in disk space (we are storing
repeatedly the same keys) and in search time (because the index keyset needs to be accessed several times per key). An
alternative is to store only once each key, and associate a list of pointers:
<div class="center" 
>
<!--l. 2502--><p class="noindent" >
<!--l. 2503--><p class="noindent" ><img 
src="23_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___itecture_LectureNotes_source_second_index_1.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2506--><p class="indent" >   But this has the problem that the index entries can have different sizes, which difficult the search.
<!--l. 2509--><p class="indent" >   Another idea is to use buckets of pointers:
<div class="center" 
>
<!--l. 2510--><p class="noindent" >
<!--l. 2511--><p class="noindent" ><img 
src="24_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___itecture_LectureNotes_source_second_index_2.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 2514--><p class="indent" >   This structure is very helpful in some situations, for example when we want to get data with some conditions that
involves different fields indexed.
   <div class="newtheorem">
<!--l. 2517--><p class="noindent" ><span class="head">
<a 
 id="x1-57001r11"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 6.11.</span>  </span>Imagine the relation EMP(name,dept,floor), with a primary index on name and two secondary
indexes with bucket structure in dept and floor.
<!--l. 2521--><p class="indent" >   Now, let&#8217;s say we want to retrieve all employees in the department &#8217;Toy&#8217; and in floor 2. Our structure make
this query very easy:
<!--l. 2524--><p class="indent" >   <img 
src="25_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_bucket_intersection.png" alt="PIC"  
width="25" height="25" >
<!--l. 2526--><p class="indent" >   As we can see, it is possible to use both indexes and then fetch only those records that are return by the
two of them!
   </div>
<!--l. 2528--><p class="indent" >
<!--l. 2530--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-580007"></a>B-Trees</h3>
<!--l. 2532--><p class="noindent" >This section is adapted from <span class="cite">[<a 
href="#Xgarcia2002">2</a>]</span>.
<!--l. 2534--><p class="indent" >   B-trees automatically maintain as many levels of index as is appropriate for the size of the file being indexed
and manage the space on the blocks they use so that every block is between half used and completely
full.
<!--l. 2539--><p class="indent" >   A B-tree organizes its blocks into a tree that is balanced, meaning that all paths from the root to a leaf have the
same length. A BTree can be visualized in Figure <a 
href="#x1-58001r4">4<!--tex4ht:ref: fig:A-BTree.-Source: --></a>.
<!--l. 2543--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                                            
                                                                                            
<a 
 id="x1-58001r4"></a>
                                                                                            
                                                                                            
<!--l. 2545--><p class="noindent" ><img 
src="26_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___em_Architecture_LectureNotes_source_pegado1.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;4: </span><span  
class="content">A BTree. Source: <span class="cite">[<a 
href="#Xgarcia2002">2</a>]</span>.</span></div><!--tex4ht:label?: x1-58001r4 -->
                                                                                            
                                                                                            
<!--l. 2548--><p class="indent" >   </div><hr class="endfigure">
<!--l. 2550--><p class="indent" >   There is a parameter <span 
class="cmmi-10">n </span>associated with each B-tree index, and this parameter determines the layout of all blocks of
the B-tree. Each block will have space for <span 
class="cmmi-10">n </span>search-key values and <span 
class="cmmi-10">n </span><span 
class="cmr-10">+ 1 </span>pointers.
<!--l. 2554--><p class="indent" >   We pick <span 
class="cmmi-10">n </span>to be as large as will allow <span 
class="cmmi-10">n </span><span 
class="cmr-10">+ 1 </span>pointers and <span 
class="cmmi-10">n </span>keys to fit in one block.
   <div class="newtheorem">
<!--l. 2556--><p class="noindent" ><span class="head">
<a 
 id="x1-58002r1"></a>
<span 
class="ecbx-1000">Example 7.1.</span>  </span>Suppose our blocks are 4096 bytes. Also let keys be integers of 4 bytes and let pointers be 8
bytes. If there is no header information kept on the blocks, then we want to find the largest integer value of <span 
class="cmmi-10">n</span>
such that <span 
class="cmr-10">4</span><span 
class="cmmi-10">n </span><span 
class="cmr-10">+ 8(</span><span 
class="cmmi-10">n </span><span 
class="cmr-10">+ 1) </span><span 
class="cmmi-10">&#x003C; </span><span 
class="cmr-10">4096</span>. That value is <span 
class="cmmi-10">n </span><span 
class="cmr-10">= 340</span>.
   </div>
<!--l. 2561--><p class="indent" >
There are several important rules about what can appear in the blocks of a B-tree:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2565--><p class="noindent" >The keys in leaf nodes are copies of keys from the data file. These keys are distributed among the leaves
     in sorted order, from left to right.
     </li>
     <li class="itemize">
     <!--l. 2568--><p class="noindent" >At the root, there are at least two used pointers. All pointers point to B-tree blocks at the level below.
     </li>
     <li class="itemize">
     <!--l. 2570--><p class="noindent" >At a leaf, the last pointer points to the next leaf block to the right, i.e., to the block with the next higher
     keys. Among the other <span 
class="cmmi-10">n </span>pointers in a leaf block, at least <img 
src="summary164x.png" alt="&#x230A;n+1&#x230B;
  2"  class="left" align="middle"> of these pointers are used and point to
     data records; unused pointers are null and do not point anywhere. The <span 
class="cmmi-10">i</span><sup><span 
class="cmmi-7">th</span></sup> pointer, if it is used, points to
     a record with the <span 
class="cmmi-10">i</span><sup><span 
class="cmmi-7">th</span></sup> key.
     </li>
     <li class="itemize">
     <!--l. 2576--><p class="noindent" >At an interior node, all <span 
class="cmmi-10">n</span><span 
class="cmr-10">+1 </span>pointers can be used to point to B-tree blocks at the next lower level. At least
     <img 
src="summary165x.png" alt="&#x2308;n+1 &#x2309;
   2"  class="left" align="middle"> of them are actually used (but if the node is the root, then we require only that at least 2 be used,
     regardless of how large <span 
class="cmmi-10">n </span>is). If <span 
class="cmmi-10">j </span>pointers are used, then there will be <span 
class="cmmi-10">j</span>&#8212;<span 
class="cmr-10">1 </span>keys, say <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,K</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,...,K</span><sub><span 
class="cmmi-7">j</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub>.
     The first pointer points to a part of the B-tree where some of the records with keys less than <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub>  will
     be found. The second pointer goes to that part of the tree where all records with keys that are at least
     <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub>, but less than <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">2</span></sub> will be found, and so on. Finally, the <span 
class="cmmi-10">j</span><sup><span 
class="cmmi-7">th</span></sup> pointer gets us to the part of the B-tree
     where some of the records with keys greater than or equal to <span 
class="cmmi-10">K</span><sub><span 
class="cmmi-7">j</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub> are found. Note that some records
     with keys far below <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub> or far above <span 
class="cmmi-10">K</span><sub><span 
class="cmmi-7">j</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub> may not be reachable from this block at all, but will be reached
     via another block at the same level.
     </li>
     <li class="itemize">
     <!--l. 2591--><p class="noindent" >All used pointers and their keys appear at the beginning of the block, with the exception of the <img 
src="summary166x.png" alt="(n + 1)"  class="left" align="middle"><sup><span 
class="cmmi-7">th</span></sup>
     pointer in a leaf, which points to the next leaf.</li></ul>
<!--l. 2595--><p class="noindent" >In Figure <a 
href="#x1-58001r4">4<!--tex4ht:ref: fig:A-BTree.-Source: --></a>, the chosen <span 
class="cmmi-10">n </span>is 3.
   <h4 class="subsectionHead"><span class="titlemark">7.1   </span> <a 
 id="x1-590007.1"></a>Lookup in BTree</h4>
<!--l. 2599--><p class="noindent" >Suppose we want to find a record with key <span 
class="cmmi-10">K</span>. The procedure is:
                                                                                            
                                                                                            
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2601--><p class="noindent" ><span 
class="ecbx-1000">Base case</span>: if we are at a leaf node, look among the keys. If the <span 
class="cmmi-10">i</span><sup><span 
class="cmmi-7">th</span></sup> key is <span 
class="cmmi-10">K</span>, then the <span 
class="cmmi-10">i</span><sup><span 
class="cmmi-7">th</span></sup> pointer is the
     one that we were looking for.
     </li>
     <li class="itemize">
     <!--l. 2604--><p class="noindent" ><span 
class="ecbx-1000">Inductive case</span>: if we are at an interior node with keys <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,...,K</span><sub><span 
class="cmmi-7">n</span></sub> we find <span 
class="cmmi-10">i </span>such that <span 
class="cmmi-10">K</span><sub><span 
class="cmmi-7">i</span><span 
class="cmsy-7">-</span><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">&#x2264; </span><span 
class="cmmi-10">K &#x003C; K</span><sub><span 
class="cmmi-7">n</span></sub>,
     or 1 if <span 
class="cmmi-10">K &#x003C; K</span><sub><span 
class="cmr-7">1</span></sub>. We choose the <span 
class="cmmi-10">i</span><sup><span 
class="cmmi-7">th</span></sup> pointer to continue the search.</li></ul>
<div class="newtheorem">
<!--l. 2608--><p class="noindent" ><span class="head">
<a 
 id="x1-59001r2"></a>
<span 
class="ecbx-1000">Example 7.2.</span>  </span>Search <span 
class="cmmi-10">K </span><span 
class="cmr-10">= 29</span>.
<!--l. 2611--><p class="indent" >   <img 
src="27_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___chitecture_LectureNotes_source_btree_drawio.png" alt="PIC"  
width="36" height="36" >
<!--l. 2613--><p class="indent" >   The path to be followed is colored green:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-59003x1">
     <!--l. 2615--><p class="noindent" >In the root node, <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmmi-10">&#x003C; K </span>and and there are no more keys, so choose <span 
class="cmmi-10">i </span><span 
class="cmr-10">= 2</span>.
     </li>
<li 
  class="enumerate" id="x1-59005x2">
     <!--l. 2617--><p class="noindent" >In the next node, we find <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmmi-10">&#x003C; K &#x003C; K</span><sub><span 
class="cmr-7">2</span></sub>, so choose <span 
class="cmmi-10">i </span><span 
class="cmr-10">= 2</span>.
     </li>
<li 
  class="enumerate" id="x1-59007x3">
     <!--l. 2618--><p class="noindent" >In the leave node, we find <span 
class="cmmi-10">K</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmr-10">= </span><span 
class="cmmi-10">K</span>, so choose <span 
class="cmmi-10">i </span><span 
class="cmr-10">= 2</span>.</li></ol>
</div>
<!--l. 2620--><p class="indent" >
<!--l. 2622--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.2   </span> <a 
 id="x1-600007.2"></a>Range queries</h4>
<!--l. 2624--><p class="noindent" >BTrees allow for a very efficient way to process range queries, that is, recover all records with keys lying in a given
range <img 
src="summary167x.png" alt="[Kmin, Kmax]"  class="left" align="middle">. The procedure is:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-60002x1">
     <!--l. 2628--><p class="noindent" >Perform a lookup for <span 
class="cmmi-10">K</span><sub><span 
class="cmmi-7">min</span></sub>, whether it is found or not, we will reach the correct leaf node.
     </li>
<li 
  class="enumerate" id="x1-60004x2">
     <!--l. 2630--><p class="noindent" >We traverse all leaf nodes until we find a key bigger than <span 
class="cmmi-10">K</span><sub><span 
class="cmmi-7">max</span></sub>.</li></ol>
<div class="newtheorem">
<!--l. 2632--><p class="noindent" ><span class="head">
<a 
 id="x1-60005r3"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 7.3.</span>  </span>Search for range <img 
src="summary168x.png" alt="[12,40]"  class="left" align="middle">.
<!--l. 2635--><p class="indent" >   <img 
src="28_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___rchitecture_LectureNotes_source_btree_range.png" alt="PIC"  
width="36" height="36" >
<!--l. 2637--><p class="indent" >   It is colored in green all the nodes that would be accepted into the range query. The order is up-down and
left-right in the leaf level.
</div>
<!--l. 2639--><p class="indent" >
<!--l. 2641--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.3   </span> <a 
 id="x1-610007.3"></a>Insertion into a BTree</h4>
<!--l. 2643--><p class="noindent" >The insertion is, in principle, recursive:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2645--><p class="noindent" >We try to find a place for the new key in the appropriate leaf, and we put it there if there is room.
     </li>
     <li class="itemize">
     <!--l. 2647--><p class="noindent" >If there is no room in the proper leaf, we split the leaf into two and divide the keys between the two new
     nodes, so each is half full or just over half full.
     </li>
     <li class="itemize">
     <!--l. 2650--><p class="noindent" >The splitting of nodes at one level appears to the level above as if a new key-pointer pair needs to be
     inserted at that higher level. We may thus recursively apply this strategy to insert at the next level: if
     there is room, insert it; if not, split the parent node and continue up the tree.
     </li>
     <li class="itemize">
     <!--l. 2655--><p class="noindent" >As an exception, if we try to insert into the root, and there is no room, then we split the root into two
     nodes and create a new root at the next higher level; the new root has the two nodes resulting from the
     split as its children. Recall that no matter how large <span 
class="cmmi-10">n </span>(the number of slots for keys at a node) is, it is
     always permissible for the root to have only one key and two children.</li></ul>
<div class="newtheorem">
<!--l. 2662--><p class="noindent" ><span class="head">
<a 
 id="x1-61001r4"></a>
<span 
class="ecbx-1000">Example 7.4.</span>  </span>Insert <span 
class="cmmi-10">K </span><span 
class="cmr-10">= 40</span>.
<!--l. 2665--><p class="indent" >   First, we lookup for the place where the record should be inserted.
<!--l. 2667--><p class="indent" >   <img 
src="29_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ecture_LectureNotes_source_btree_insert40_0.png" alt="PIC"  
width="36" height="36" >
<!--l. 2669--><p class="indent" >   As there is not enough place, we need to split the node.
<!--l. 2671--><p class="indent" >   <img 
src="30_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ecture_LectureNotes_source_btree_insert40_1.png" alt="PIC"  
width="36" height="36" >
<!--l. 2673--><p class="indent" >   Now, the key of the new node needs to be inserted into the parent node. But it is also full, so it needs to be
splitted, too.
<!--l. 2676--><p class="indent" >   <img 
src="31_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ecture_LectureNotes_source_btree_insert40_2.png" alt="PIC"  
width="36" height="36" >ç
<!--l. 2678--><p class="indent" >   In the root node, the smaller key reachable from that node needs to bu inserted. In this case, the newly
inserted one.
</div>
<!--l. 2680--><p class="indent" >
                                                                                            
                                                                                            
<!--l. 2682--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.4   </span> <a 
 id="x1-620007.4"></a>Deletion from a BTree</h4>
<!--l. 2684--><p class="noindent" >The steps to delete record with key <span 
class="cmmi-10">K </span>are:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-62002x1">
     <!--l. 2686--><p class="noindent" >Lookup for the record.
     </li>
<li 
  class="enumerate" id="x1-62004x2">
     <!--l. 2687--><p class="noindent" >Delete the record from the data.
     </li>
<li 
  class="enumerate" id="x1-62006x3">
     <!--l. 2688--><p class="noindent" >Delete the key-pointer pair from the BTree.
     </li>
<li 
  class="enumerate" id="x1-62008x4">
     <!--l. 2689--><p class="noindent" >If the node from which we deleted still has the minimum number of pointers, that&#8217;s it. But it is possible that
     the node is less occupy than the minimum required after the deletion. We need to do one of two
     things:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-62010x1">
         <!--l. 2694--><p class="noindent" >If one of the adjacent siblings of node <span 
class="cmmi-10">N </span>has more than the minimum number of keys and pointers,
         then one key-pointer pair can be moved to <span 
class="cmmi-10">N</span>, keeping the order of keys intact. Possibly, the keys at
         the parent of <span 
class="cmmi-10">N </span>must be adjusted to reflect the new situation.
         </li>
<li 
  class="enumerate" id="x1-62012x2">
         <!--l. 2698--><p class="noindent" >The hard case is when neither adjacent sibling can be used to provide an extra key for <span 
class="cmmi-10">N</span>. However,
         in that case, we have two adjacent nodes, <span 
class="cmmi-10">N </span>and a sibling <span 
class="cmmi-10">M</span>; the latter has the minimum number
         of keys and the former has fewer than the minimum. Therefore, together they have no more keys
         and pointers than are allowed in a single node. We merge these two nodes, effectively deleting one
         of them. We need to adjust the keys at the parent, and then delete a key and pointer at the parent.
         If the parent is still full enough, then we are done. If not, then we recursively apply the deletion
         algorithm at the parent. This process is called <span 
class="ecbx-1000">coalesce siblings</span>.</li></ol>
     </li></ol>
<div class="newtheorem">
<!--l. 2710--><p class="noindent" ><span class="head">
<a 
 id="x1-62013r5"></a>
<span 
class="ecbx-1000">Example 7.5.</span>  </span>Delete <span 
class="cmmi-10">K </span><span 
class="cmr-10">= 7</span>.
<!--l. 2713--><p class="indent" >   <img 
src="32_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___tecture_LectureNotes_source_btree_delete7_0.png" alt="PIC"  
width="36" height="36" >
<!--l. 2715--><p class="indent" >   First, we find the correct node and delete the record.
<!--l. 2717--><p class="indent" >   Now, the node left only has one pointer, so we need to fix this. As its left sibling node has 3 pointers, we
can transfer the biggest one.
<!--l. 2721--><p class="indent" >   <img 
src="33_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___tecture_LectureNotes_source_btree_delete7_1.png" alt="PIC"  
width="36" height="36" >
<!--l. 2723--><p class="indent" >   Also, we need to update the parent node.
                                                                                            
                                                                                            
</div>
<!--l. 2724--><p class="indent" >
<div class="newtheorem">
<!--l. 2726--><p class="noindent" ><span class="head">
<a 
 id="x1-62014r6"></a>
<span 
class="ecbx-1000">Example 7.6.</span>  </span>Now, delete <span 
class="cmmi-10">K </span><span 
class="cmr-10">= 11</span>.
<!--l. 2729--><p class="indent" >   <img 
src="34_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ecture_LectureNotes_source_btree_delete11_0.png" alt="PIC"  
width="36" height="36" >
<!--l. 2731--><p class="indent" >   First, we locate the correct node and delete the record. Again, the node ends up with less pointers than it
should, but now the left sibling does not have more than the minimum amount of pointers (it has the minimum)
and the node does not have right siblings (the node to the right is from another parent), so we need to merge
the two siblings.
<!--l. 2737--><p class="indent" >   <img 
src="35_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ecture_LectureNotes_source_btree_delete11_1.png" alt="PIC"  
width="36" height="36" >
</div>
<!--l. 2738--><p class="indent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;IV<br /></span><a 
 id="x1-63000IV"></a>Physical Query Plans</h1>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-640008"></a>Physical Query Plans</h3>
<!--l. 2745--><p class="noindent" >We saw the steps to process a query: first, the query needs to be translated into and RA expression, which can then be
modified using equivalence rules to get different expressions that lead to the same result. Then, it is needed to estimate
the cost of each expression and to take the one that gives the minimum expected cost. For this, we need also to decide
between several ways to access the data, e.g., whether to use an index or not, to order the data or not,... This is called
<span 
class="ecbx-1000">physical query planning</span>.
<!--l. 2754--><p class="indent" >   There are several ways to measure cost, but we are going to be using the number of disk blocks that must be read or
written to execute a query plan.
<!--l. 2758--><p class="indent" >   We will also use different parameters:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2760--><p class="noindent" ><span 
class="cmmi-10">B</span><img 
src="summary169x.png" alt="(R)"  class="left" align="middle">: number of blocks containing the tuples of relation <span 
class="cmmi-10">R</span>.
     </li>
     <li class="itemize">
     <!--l. 2762--><p class="noindent" ><span 
class="cmmi-10">f</span><img 
src="summary170x.png" alt="(R )"  class="left" align="middle">: maximum number of tuples of <span 
class="cmmi-10">R </span>per block.
     </li>
     <li class="itemize">
     <!--l. 2763--><p class="noindent" ><span 
class="cmmi-10">S</span><img 
src="summary171x.png" alt="(R )"  class="left" align="middle">: size of tuples of <span 
class="cmmi-10">R</span>.
     </li>
     <li class="itemize">
     <!--l. 2764--><p class="noindent" ><span 
class="cmmi-10">M</span>: memory blocks available.
     </li>
     <li class="itemize">
     <!--l. 2765--><p class="noindent" ><span 
class="cmmi-10">HT</span><img 
src="summary172x.png" alt="(i)"  class="left" align="middle">: amount of levels in index <span 
class="cmmi-10">i</span>.
     </li>
     <li class="itemize">
     <!--l. 2766--><p class="noindent" ><span 
class="cmmi-10">LB</span><img 
src="summary173x.png" alt="(i)"  class="left" align="middle">: amount of leaf nodes in index <span 
class="cmmi-10">i</span>.</li></ul>
<!--l. 2769--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-650008.1"></a>Computing joins</h4>
<!--l. 2771--><p class="noindent" >A join operation can be computed in several ways, depending on the options available.
<!--l. 2774--><p class="indent" >   The simplest and most costly option is an <span 
class="ecbx-1000">iteration join</span>, which just performs a double loop over the two relations.
The pseudocode can be read in Algorithm <a 
href="#x1-65005r2">2<!--tex4ht:ref: alg:Iteration-Join --></a>.
                                                                                            
                                                                                            
<!--l. 2778--><p class="indent" >   <a 
 id="x1-65005r2"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 2779-->
<div class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-65001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65002r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">s</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65003r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">s</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65004r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">output</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">s</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 2: </span><span  
class="content">Iteration Join</span></div><!--tex4ht:label?: x1-65005r2 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
<!--l. 2790--><p class="indent" >   The <span 
class="ecbx-1000">merge join </span>consists in first sorting the relations if they are not sorted, and then scanning them making use
of the fact that they are ordered using the same attribute. The pseudocode can be read in Algorithm
<a 
href="#x1-65023r3">3<!--tex4ht:ref: alg:merge-join --></a>.
                                                                                            
                                                                                            
<!--l. 2795--><p class="indent" >   <a 
 id="x1-65023r3"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 2796-->
<div class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-65006r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">not</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">sorted</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">on</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">attribute</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65007r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">sort</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65008r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">r2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">not</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">sorted</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">on</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">attribute</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65009r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">sort</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65010r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65011r6"></a></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">=1,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">=1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65012r7"></a></span><span style="color:#000000"><span 
class="ectt-1000">while</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;=</span></span><span style="color:#000000"><span 
class="ectt-1000">T</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">and</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;=</span></span><span style="color:#000000"><span 
class="ectt-1000">T</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65013r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65014r9"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">k</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65015r10"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">while</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">k</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65016r11"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">output</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">],</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">k</span></span><span style="color:#000000"><span 
class="ectt-1000">])</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65017r12"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">k</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65018r13"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65019r14"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">else</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65020r15"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65021r16"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">else</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">j</span></span><span style="color:#000000"><span 
class="ectt-1000">].</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65022r17"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">+=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 3: </span><span  
class="content">Merge Join</span></div><!--tex4ht:label?: x1-65023r3 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
<!--l. 2820--><p class="indent" >   The <span 
class="ecbx-1000">index join </span>uses an index defined on the joining attribute on one of the relations. The pseudocode can be read
in Algorithm <a 
href="#x1-65028r4">4<!--tex4ht:ref: alg:index-join-1 --></a>.
                                                                                            
                                                                                            
<!--l. 2823--><p class="indent" >   <a 
 id="x1-65028r4"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 2824-->
<div class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-65024r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65025r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;-</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">index</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">A</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">#</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">search</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">in</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">index</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">on</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">R2</span></span><span style="color:#000000"><span 
class="ecit-1000">.</span></span><span style="color:#000000"><span 
class="ecit-1000">A</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">tuples</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">with</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">value</span></span><span style="color:#000000"><span 
class="ecit-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ecit-1000">r</span></span><span style="color:#000000"><span 
class="ecit-1000">.</span></span><span style="color:#000000"><span 
class="ecit-1000">A</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65026r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">s</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65027r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">output</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">r</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">s</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 4: </span><span  
class="content">Index Join</span></div><!--tex4ht:label?: x1-65028r4 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
<!--l. 2835--><p class="indent" >   The <span 
class="ecbx-1000">hash join </span>uses a hash function on the joinin attribute. The pseudocode can be read in Algorithm
                                                                                            
                                                                                            
<!--l. 2838--><p class="indent" >   <a 
 id="x1-65034r5"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 2839-->
<div class="lstlisting" id="listing-28"><span class="label"><a 
 id="x1-65029r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">hash</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R1</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">tuples</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">into</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">G</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">buckets</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65030r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">hash</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">R2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">tuples</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">into</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">H</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">buckets</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65031r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65032r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">=0</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">to</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">k</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-65033r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">match</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">tuples</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">that</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">lie</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">G</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">]</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">and</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">H</span></span><span style="color:#000000"><span 
class="ectt-1000">[</span></span><span style="color:#000000"><span 
class="ectt-1000">i</span></span><span style="color:#000000"><span 
class="ectt-1000">]</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 5: </span><span  
class="content">Hash Join (k buckets G1...Gk, H1...Hk)</span></div><!--tex4ht:label?: x1-65034r5 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-660008.2"></a>Factors that affect performance</h4>
<!--l. 2854--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-670008.2"></a>Are the tuples of the relation stored physically together?</h5>
<!--l. 2856--><p class="noindent" >The more compactly stored in memory the relations are, the less number of pages needs to be fetched and so the
performance will increase.
<!--l. 2859--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-680008.2"></a>Are relations sorted by join attribute?</h5>
<!--l. 2861--><p class="noindent" >If the relations are already sorted by the join attribute, the merge join is a great option, because the
costly part is the sorting (<span 
class="cmmi-10">O</span><img 
src="summary174x.png" alt="(nlogn)"  class="left" align="middle">), while the joinin itself is <span 
class="cmmi-10">O</span><img 
src="summary175x.png" alt="(n+ m )"  class="left" align="middle"> where <span 
class="cmmi-10">n,m </span>are the sizes of both
relations.
<!--l. 2866--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-690008.2"></a>Indexes exist?</h5>
<!--l. 2868--><p class="noindent" >If there are no indexes, the index join is not even an option. And when there are indexes, they are not always the best
option, because if the attribute has low selectivity, the indexes will be returning single values often, and thus we will be
only introducing overhead in the operation.
   <div class="newtheorem">
<!--l. 2873--><p class="noindent" ><span class="head">
<a 
 id="x1-69001r1"></a>
<span 
class="ecbx-1000">Example 8.1.</span>  </span><span 
class="ecbx-1000">Iteration          join          </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary176x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>            where          <span 
class="ecbx-1000">relations          are          not</span>
<span 
class="ecbx-1000">contiguous</span>, <span 
class="cmmi-10">T</span><img 
src="summary177x.png" alt="(R1)"  class="left" align="middle"> <span 
class="cmr-10">= 10000</span><span 
class="cmmi-10">&#x00A0;tuples,T</span><img 
src="summary178x.png" alt="(R2)"  class="left" align="middle"> <span 
class="cmr-10">= 5000</span><span 
class="cmmi-10">&#x00A0;tuples,S</span><img 
src="summary179x.png" alt="(R1)"  class="left" align="middle"> <span 
class="cmr-10">= </span><span 
class="cmmi-10">S</span><img 
src="summary180x.png" alt="(R2 )"  class="left" align="middle"> <span 
class="cmr-10">=</span> <img 
src="summary181x.png" alt=" 1
10"  class="frac" align="middle"><span 
class="cmmi-10">&#x00A0;block </span>and <span 
class="cmmi-10">M </span><span 
class="cmr-10">= 101 </span>blocks
(so we can work with at most 1010 tuples in memory at once). In this case, <span 
class="cmmi-10">B</span><img 
src="summary182x.png" alt="(R1 )"  class="left" align="middle"> <span 
class="cmr-10">= 10000 </span>and <span 
class="cmmi-10">B</span><img 
src="summary183x.png" alt="(R2 )"  class="left" align="middle"> <span 
class="cmr-10">= 5000</span>.
<!--l. 2879--><p class="indent" >   For each tuple in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>, we need to:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2881--><p class="noindent" >Read the tuple: 1 IO
     </li>
     <li class="itemize">
     <!--l. 2882--><p class="noindent" >Read all tuples in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>: 5000 IOs (This is because the relations are not contiguously stored, so we need to
     assume that we read a new block for each new tuple)</li></ul>
<!--l. 2886--><p class="noindent" >So, the total cost is
   <div class="math-display" >
<img 
src="summary184x.png" alt="C = 10000(1+ 5000) = 50 010 000 IOs.
" class="math-display" ></div>
<!--l. 2891--><p class="indent" >   Can this be improved? Yes!
                                                                                            
                                                                                            
<!--l. 2893--><p class="indent" >   If we do it reading 1000 tuples of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and doing the process in each of this chunks, we would need to, for each chunk
in <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span>:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2896--><p class="noindent" >Read all tuples in the chunk: 1000 IOs
     </li>
     <li class="itemize">
     <!--l. 2897--><p class="noindent" >Read all tuples in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>: 5000 IOs</li></ul>
<!--l. 2899--><p class="noindent" >So
   <div class="math-display" >
<img 
src="summary185x.png" alt="C = 10(1000+ 5000) = 60 000 IOs.
" class="math-display" ></div>
<!--l. 2904--><p class="indent" >   Can this be improved? Yes!
<!--l. 2906--><p class="indent" >   If we reverse the order of the join: <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary186x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>, then, for each chunk in <span 
class="cmmi-10">R</span><span 
class="cmr-10">2</span>:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2909--><p class="noindent" >Read all tuples in the chunk: 1000 IOs
     </li>
     <li class="itemize">
     <!--l. 2910--><p class="noindent" >Read all tuples in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>:10000 IOs</li></ul>
<!--l. 2912--><p class="noindent" >So
   <div class="math-display" >
<img 
src="summary187x.png" alt="C = 5(1000+ 10000) = 55 000 IOs.
" class="math-display" ></div>
   </div>
<!--l. 2917--><p class="indent" >
In fact, the bigger <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> is compared to <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> the greater gain obtained when changing the order.
   <div class="newtheorem">
<!--l. 2920--><p class="noindent" ><span class="head">
<a 
 id="x1-69002r2"></a>
<span 
class="ecbx-1000">Example 8.2.</span>  </span><span 
class="ecbx-1000">Iteration join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary188x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>  where <span 
class="ecbx-1000">relations are contiguous </span>(same parameters). In this case,
<span 
class="cmmi-10">B</span><img 
src="summary189x.png" alt="(R1)"  class="left" align="middle"> <span 
class="cmr-10">= 1000 </span>and <span 
class="cmmi-10">B</span><img 
src="summary190x.png" alt="(R2)"  class="left" align="middle"> <span 
class="cmr-10">= 500</span>.
<!--l. 2925--><p class="indent" >   For each chunk in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>:
                                                                                            
                                                                                            
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2927--><p class="noindent" >Read the chunk: 100 IOs (now it is only 100 IOs because <span 
class="cmmi-10">S</span><img 
src="summary191x.png" alt="(R2)"  class="left" align="middle"> <span 
class="cmr-10">=</span> <img 
src="summary192x.png" alt="110-"  class="frac" align="middle"> block, so to read 1000 tuples we
     need to read 100 blocks)
     </li>
     <li class="itemize">
     <!--l. 2929--><p class="noindent" >Read <span 
class="cmmi-10">R</span><span 
class="cmr-10">1</span>: 1000 IOs</li></ul>
<!--l. 2931--><p class="noindent" >Thus,
   <div class="math-display" >
<img 
src="summary193x.png" alt="C = 5(100 +1000) = 5 500 IOs.
" class="math-display" ></div>
   </div>
<!--l. 2935--><p class="indent" >
We can see how the contigous storage greatly increase performance of the joins.
   <div class="tcolorbox tcolorbox" id="tcolobox-9">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 2940--><p class="noindent" ><span class="head">
<a 
 id="x1-69003r1"></a>
<span 
class="ecbx-1000">Theorem 8.1.</span>   </span><span 
class="ecti-1000">In general, for an iteration join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary194x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="ecti-1000">with sizes (in blocks) </span><span 
class="cmmi-10">B</span><img 
src="summary195x.png" alt="(R1)"  class="left" align="middle"> <span 
class="ecti-1000">and </span><span 
class="cmmi-10">B</span><img 
src="summary196x.png" alt="(R2)"  class="left" align="middle"><span 
class="ecti-1000">, and</span>
<span 
class="ecti-1000">a memory capacity of </span><span 
class="cmmi-10">M </span><span 
class="ecti-1000">blocks, the formula for the cost is</span>
<div class="math-display" >
<img 
src="summary197x.png" alt="    B (R1)
C = M----1 (M - 1 + B(R2)).
" class="math-display" ></div>
</div>
<!--l. 2947--><p class="noindent" >
 
</div> 
</div>
   <div class="proof">
<!--l. 2951--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>We want to first take as many blocks from the first relation as we can, but we need to leave space for
joining the second relation, so we will use <span 
class="cmmi-10">M </span><span 
class="cmsy-10">- </span><span 
class="cmr-10">1 </span>blocks for storing the tuples for the first relation. This will
need to be done <img 
src="summary198x.png" alt="B-(R1)
 M- 1"  class="frac" align="middle"> times. Now, for each of this iterations, we need to actually read the <span 
class="cmmi-10">M </span><span 
class="cmsy-10">- </span><span 
class="cmr-10">1 </span>blocks from
<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and to read all blocks from <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>. So the formula arises.                                                                    __
                                                                                            
                                                                                            
   </div>
   <div class="newtheorem">
<!--l. 2959--><p class="noindent" ><span class="head">
<a 
 id="x1-69004r3"></a>
<span 
class="ecbx-1000">Example 8.3.</span>  </span><span 
class="ecbx-1000">Merge join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary199x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>  where both relations are <span 
class="ecbx-1000">already ordered </span>by the joinin attribute and
relations are <span 
class="ecbx-1000">contiguous</span>. In this case, we will need to read all blocks containing <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and all block containing
<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>, once. So
   <div class="math-display" >
<img 
src="summary200x.png" alt="C = 1000 + 500 = 1 500 IOs.
" class="math-display" ></div>
   </div>
<!--l. 2968--><p class="indent" >
So we can see how good a merge join where the relations are already ordered is. Let&#8217;s see how the other case
performs:
   <div class="newtheorem">
<!--l. 2971--><p class="noindent" ><span class="head">
<a 
 id="x1-69005r4"></a>
<span 
class="ecbx-1000">Example 8.4.</span>  </span><span 
class="ecbx-1000">Merge join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary201x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> where <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">2</span></sub> are <span 
class="ecbx-1000">not ordered</span>, but are <span 
class="ecbx-1000">contiguous</span>.
<!--l. 2975--><p class="indent" >   In this case, first we need to sort the relations and there are different ways to do this, we are going to explain one,
the <span 
class="ecbx-1000">merge join</span>:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 2978--><p class="noindent" >Merge sort: For each 100 tuples chunk of <span 
class="cmmi-10">R</span>:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 2980--><p class="noindent" >Read the chunk
         </li>
         <li class="itemize">
         <!--l. 2981--><p class="noindent" >Sort in memory
         </li>
         <li class="itemize">
         <!--l. 2982--><p class="noindent" >Write to disk the ordered chunks
         </li>
         <li class="itemize">
         <!--l. 2983--><p class="noindent" >Read the ordered chunks and merge them
         </li>
         <li class="itemize">
         <!--l. 2984--><p class="noindent" >Write to disk the ordered relation</li></ul>
                                                                                            
                                                                                            
     <!--l. 2986--><p class="noindent" >Cost (in terms of IO): each chunk is read, written, read, written, so <span 
class="cmr-10">4 </span><span 
class="cmsy-10">&#x00D7;</span><img 
src="summary202x.png" alt="TS(R(R))-"  class="frac" align="middle"> <span 
class="cmr-10">= 4</span><span 
class="cmmi-10">B</span><img 
src="summary203x.png" alt="(R )"  class="left" align="middle">.
     <!--l. 2989--><p class="noindent" >In our case
<div class="math-display" >
<img 
src="summary204x.png" alt="sortC (R1 ) = 4000, sortC (R2 ) = 2000.
" class="math-display" ></div>
     </li></ul>
<!--l. 2995--><p class="noindent" >Now, the cost a merge join in which the relations are not ordered is the cost of the ordering plus the cost of the join,
so
   <div class="math-display" >
<img 
src="summary205x.png" alt="C = 4000 + 2000 + 1500 = 7500 IOs.
" class="math-display" ></div>
<!--l. 3001--><p class="indent" >   Remember that the iteration cost was 5500 IOs, so in this case the merge join is not the best option.
   </div>
<!--l. 3003--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-10">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 3005--><p class="noindent" ><span class="head">
<a 
 id="x1-69006r2"></a>
<span 
class="ecbx-1000">Theorem 8.2.</span>   </span><span 
class="ecti-1000">In general, for a merge join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary206x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="ecti-1000">with sizes (in blocks) </span><span 
class="cmmi-10">B</span><img 
src="summary207x.png" alt="(R1)"  class="left" align="middle"> <span 
class="ecti-1000">and </span><span 
class="cmmi-10">B</span><img 
src="summary208x.png" alt="(R2)"  class="left" align="middle"> <span 
class="ecti-1000">where the</span>
<span 
class="ecti-1000">relations are contiguously stored, and a memory capacity of </span><span 
class="cmmi-10">M </span><span 
class="ecti-1000">blocks, the formula for the cost is</span>
<div class="math-display" >
<img 
src="summary209x.png" alt="C = 5(B (R1)+ B (R2)).
" class="math-display" ></div>
</div>
<!--l. 3013--><p class="noindent" >
 
</div> 
</div>
                                                                                            
                                                                                            
   <div class="proof">
<!--l. 3017--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>The cost is
   <div class="math-display" >
<img 
src="summary210x.png" alt="C = C    (R )+ C     (R )+ C   .
     order  1     order  2    join
" class="math-display" ></div>
<!--l. 3021--><p class="indent" >   We have seen that <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">order</span></sub><img 
src="summary211x.png" alt="(R)"  class="left" align="middle"> <span 
class="cmr-10">= 4</span><span 
class="cmmi-10">B</span><img 
src="summary212x.png" alt="(R )"  class="left" align="middle"> and <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">join</span></sub><img 
src="summary213x.png" alt="(R1,R2 )"  class="left" align="middle"> <span 
class="cmr-10">= </span><span 
class="cmmi-10">B</span><img 
src="summary214x.png" alt="(R1 )"  class="left" align="middle"><span 
class="cmr-10">+</span><span 
class="cmmi-10">B</span><img 
src="summary215x.png" alt="(R2)"  class="left" align="middle">, and so the formula arises.   __
   </div>
   <div class="newtheorem">
<!--l. 3025--><p class="noindent" ><span class="head">
<a 
 id="x1-69007r5"></a>
<span 
class="ecbx-1000">Example 8.5.</span>  </span>Let in this case <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">2</span></sub> be contiguously stored, but unordered, with <span 
class="cmmi-10">B</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmr-10">) = 10000</span><span 
class="cmmi-10">&#x00A0;tuples </span>and
<span 
class="cmmi-10">B</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmr-10">) = 5000</span><span 
class="cmmi-10">&#x00A0;tuples</span>. In this case, the iteration join has a cost of
   <div class="math-display" >
<img 
src="summary216x.png" alt="      5000
CIJ = ---- (100 + 10000) = 505 000 IOs.
       100
" class="math-display" ></div>
<!--l. 3033--><p class="indent" >   And the merge join
   <div class="math-display" >
<img 
src="summary217x.png" alt="CMJ  = 5(10000+ 5000) = 75 000 IOs.
" class="math-display" ></div>
<!--l. 3038--><p class="indent" >   So, in this case the merge sort is better, even without the relations being previously ordered.
   </div>
<!--l. 3040--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-11">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 3042--><p class="noindent" ><span class="head">
<a 
 id="x1-69008r3"></a>
<span 
class="ecbx-1000">Theorem 8.3.</span>   </span><span 
class="ecti-1000">For a join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary218x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="ecti-1000">where the relations are contiguously stored and unordered, with sizes</span>
<span 
class="ecti-1000">(in blocks) </span><span 
class="cmmi-10">B</span><img 
src="summary219x.png" alt="(R1)"  class="left" align="middle"> <span 
class="ecti-1000">and </span><span 
class="cmmi-10">B</span><img 
src="summary220x.png" alt="(R2)"  class="left" align="middle"><span 
class="ecti-1000">, a memory capacity of </span><span 
class="cmmi-10">M </span><span 
class="ecti-1000">blocks, and assuming that</span> <img 
src="summary221x.png" alt="B(MR-21)"  class="frac" align="middle"> <span 
class="cmmi-10">&#x003E; </span><span 
class="cmr-10">4</span><span 
class="ecti-1000">, a merge</span>
<span 
class="ecti-1000">join is preferred to an iteration join if, and only if,</span>
<div class="math-display" >
<img 
src="summary222x.png" alt="B (R ) &#x003E; 5B-(R2)-.
    1    BM(R-21)- 4
" class="math-display" ></div>
</div>
<!--l. 3051--><p class="noindent" >
 
</div> 
</div>
   <div class="proof">
<!--l. 3055--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>The merge join is preferred to the iteration join if, and only if
   <div class="math-display" >
<img 
src="summary223x.png" alt="                   B-(R1)                          B-(R1-)B-(R2-)
5(B (R1)+ B (R2)) &#x003C; M - 1 (M - 1 + B (R2 )) = B(R1 )+   M - 1     &#x21D0;&#x21D2;
" class="math-display" ></div>
<!--l. 3059--><p class="indent" >
   <div class="math-display" >
<img 
src="summary224x.png" alt="4B (R1)+ 5B (R2) &#x003C; B(R1)B-(R2)-&#x21D0; &#x21D2;
                      M - 1
" class="math-display" ></div>
<!--l. 3062--><p class="indent" >
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary225x.png" alt="      [    B-(R2-)]
B (R1) 4 - M - 1  &#x003C; - 5B (R2 ) &#x21D0; &#x21D2;
" class="math-display" ></div>
<!--l. 3065--><p class="indent" >
   <div class="math-display" >
<img 
src="summary226x.png" alt="      [         ]
B (R ) B-(R2) - 4 &#x003E; 5B (R ) &#x21D0;&#x21D2;
    1  M  - 1            2
" class="math-display" ></div>
<!--l. 3068--><p class="indent" >
   <div class="math-display" >
<img 
src="summary227x.png" alt="         5B (R )
B (R1) &#x003E; B(R2)2--.
         M--1-- 4
" class="math-display" ></div>
                                                                                           __
   </div>
   <div class="newtheorem">
<!--l. 3072--><p class="noindent" ><span class="head">
<a 
 id="x1-69009r6"></a>
<span 
class="ecbx-1000">Example 8.6.</span>  </span>Let&#8217;s apply the theorem to our two previous examples:
   </div>
<!--l. 3074--><p class="indent" >
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-69011x1">
     <!--l. 3076--><p class="noindent" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary228x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,B</span><img 
src="summary229x.png" alt="(R1 )"  class="left" align="middle"> <span 
class="cmr-10">= 1000</span><span 
class="cmmi-10">,</span><span 
class="cmmi-10">&#x00A0;B</span><img 
src="summary230x.png" alt="(R2)"  class="left" align="middle"> <span 
class="cmr-10">= 500</span><span 
class="cmmi-10">,</span><span 
class="cmmi-10">&#x00A0;M </span><span 
class="cmr-10">= 101</span>, then
                                                                                            
                                                                                            
<div class="math-display" >
<img 
src="summary231x.png" alt=" 5B(R )     5000     5000
B(R1)-1--= 1000----=  ----&#x003E; 833 &#x003E; 500,
M--1-- 4    100 - 4    6
" class="math-display" ></div>
     <!--l. 3081--><p class="noindent" >so in this case the iteration join is preferred.
     </li>
<li 
  class="enumerate" id="x1-69013x2">
     <!--l. 3082--><p class="noindent" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary232x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,B</span><img 
src="summary233x.png" alt="(R1 )"  class="left" align="middle"> <span 
class="cmr-10">= 10000</span><span 
class="cmmi-10">,B</span><img 
src="summary234x.png" alt="(R2)"  class="left" align="middle"> <span 
class="cmr-10">= 5000</span><span 
class="cmmi-10">,M </span><span 
class="cmr-10">= 101</span>, then
<div class="math-display" >
<img 
src="summary235x.png" alt="5B-(R1)--  -50000--  50000
B(R1)-- 4 = 10000- 4 =   96   &#x003C; 521 &#x003C; 5000,
M -1        100
" class="math-display" ></div>
     <!--l. 3087--><p class="noindent" >so in this case the merge join is preferred.</li></ol>
<!--l. 3090--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-700008.2"></a>How much memory do we need for merge sort?</h5>
<!--l. 3092--><p class="noindent" >Until now, we have disregarded the memory needed to perform the merge sort, but this is a crucial aspect of it. If the
relation does not fit entirely in memory, it is not straightforward to merge all the ordered chunks to obtain a fully
ordered relation.
<!--l. 3097--><p class="indent" >   In general, if we have <span 
class="cmmi-10">M </span>blocks in memory, and <span 
class="cmmi-10">B </span>blocks to sort, then we will take chunks of size <span 
class="cmmi-10">k</span>, so we will have
<img 
src="summary236x.png" alt="x
k"  class="frac" align="middle"> chunks. Now, this number needs to be smaller than the memory size:
   <div class="math-display" >
<img 
src="summary237x.png" alt=" B
M--&#x2264; M,
" class="math-display" ></div>
<!--l. 3103--><p class="indent" >   or, equivalently
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary238x.png" alt="M 2 &#x2265; B or M &#x2265; &#x221A;B.
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 3108--><p class="noindent" ><span class="head">
<a 
 id="x1-70001r7"></a>
<span 
class="ecbx-1000">Example 8.7.</span>  </span>Following our examples: <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> is 1000 blocks, so <span 
class="cmmi-10">M </span><span 
class="cmsy-10">&#x2265; </span><span 
class="cmr-10">31</span><span 
class="cmmi-10">.</span><span 
class="cmr-10">62 </span>and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> is 500 blocks so <span 
class="cmmi-10">M </span><span 
class="cmsy-10">&#x2265; </span><span 
class="cmr-10">22</span><span 
class="cmmi-10">.</span><span 
class="cmr-10">36</span>.
In this case, we need <span 
class="cmmi-10">M </span><span 
class="cmsy-10">&#x2265; </span><span 
class="cmr-10">32 </span>blocks, so it could be done because the memory was <span 
class="cmmi-10">M </span><span 
class="cmr-10">= 101 </span>blocks.
   </div>
<!--l. 3113--><p class="indent" >
<!--l. 3115--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-710008.2"></a>Can the merge join be improved?</h5>
<!--l. 3117--><p class="noindent" >Yes, we are imposing that the whole relation needs to be sorted, but maybe we can join the sorted chunks without
merging them.
<!--l. 3120--><p class="indent" >   If we did this, we would need to:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3122--><p class="noindent" >Read <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and write <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> sorted chunks
     </li>
     <li class="itemize">
     <!--l. 3123--><p class="noindent" >Read <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> and write <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> sorted chunks
     </li>
     <li class="itemize">
     <!--l. 3124--><p class="noindent" >Join</li></ul>
<!--l. 3126--><p class="noindent" >So the total cost would be
   <div class="math-display" >
<img 
src="summary239x.png" alt="C = 2B (R1)+ 2B (R2 )+ [B (R1)+ B (R2)] = 3[B (R1 )+ B (R2 )].
" class="math-display" ></div>
   <div class="newtheorem">
<!--l. 3131--><p class="noindent" ><span class="head">
<a 
 id="x1-71001r8"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 8.8.</span>  </span><span 
class="ecbx-1000">Index  join  </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary240x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>  with  an  <span 
class="ecbx-1000">index </span>on  <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">.A </span>of  two  levels,  <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>  <span 
class="ecbx-1000">contiguously </span>stored  and
<span 
class="ecbx-1000">unordered </span>and assuming the <span 
class="ecbx-1000">index fits in memory</span>. Then, the cost is:
   </div>
<!--l. 3136--><p class="indent" >
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3138--><p class="noindent" >Read <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>: 500 IOs
     </li>
     <li class="itemize">
     <!--l. 3139--><p class="noindent" >For each tuple in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>, check the index and only read a tuple in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> if there is a match.</li></ul>
<!--l. 3142--><p class="noindent" >So
   <div class="math-display" >
<img 
src="summary241x.png" alt="C = 500 + matches.
" class="math-display" ></div>
<!--l. 3146--><p class="indent" >   Thus, we need to estimate how many matches there will be. We can treat several cases:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-71003x1">
     <!--l. 3149--><p class="noindent" >If <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">.A </span>is a key attribute and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">.A </span>is a foreign key:
<div class="math-display" >
<img 
src="summary242x.png" alt="matches (R2, R1) = T (R2).
" class="math-display" ></div>
     <!--l. 3153--><p class="noindent" >In this case the cost is
<div class="math-display" >
<img 
src="summary243x.png" alt="C = 500+ 5000 = 5500 IOs.
" class="math-display" ></div>
                                                                                            
                                                                                            
     </li>
<li 
  class="enumerate" id="x1-71005x2">
     <!--l. 3157--><p class="noindent" >If we know <span 
class="cmmi-10">V </span><img 
src="summary244x.png" alt="(R1,A)"  class="left" align="middle"> (number of distinct values of attribute <span 
class="cmmi-10">A </span>in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>) and <span 
class="cmmi-10">T</span><img 
src="summary245x.png" alt="(R1 )"  class="left" align="middle">, we can assume uniformity
     and thus obtain
<div class="math-display" >
<img 
src="summary246x.png" alt="                 V (R1,A)
matches(R2,R1) = -T-(R1)- &#x00D7;T (R2).
" class="math-display" ></div>
     <!--l. 3163--><p class="noindent" >In this case the cost is, assuming <span 
class="cmmi-10">V </span><img 
src="summary247x.png" alt="(R ,A)
  1"  class="left" align="middle"> <span 
class="cmr-10">= 5000</span>,
<div class="math-display" >
<img 
src="summary248x.png" alt="         10000
C = 500+ -5000 5000 = 10500 IOs.
" class="math-display" ></div>
     </li>
<li 
  class="enumerate" id="x1-71007x3">
     <!--l. 3167--><p class="noindent" >If we know <span 
class="cmmi-10">size</span><img 
src="summary249x.png" alt="(Dom  (R1, A))"  class="left" align="middle"> (number of distinct values that attribute <span 
class="cmmi-10">A </span>can take) and <span 
class="cmmi-10">T</span><img 
src="summary250x.png" alt="(R1 )"  class="left" align="middle">, we can
     assume uniformity and thus obtain
<div class="math-display" >
<img 
src="summary251x.png" alt="matches (R2,R1 ) =-----T-(R1)-----T (R2).
                 size(Dom (R1,A ))
" class="math-display" ></div>
     <!--l. 3173--><p class="noindent" >In this case the cost is, assumiing <span 
class="cmmi-10">size</span><img 
src="summary252x.png" alt="(Dom  (R1,A ))"  class="left" align="middle"> <span 
class="cmr-10">= 1</span><span 
class="cmmi-10">&#x00A0;</span><span 
class="cmr-10">000</span><span 
class="cmmi-10">&#x00A0;</span><span 
class="cmr-10">000</span>,
<div class="math-display" >
                                                                                            
                                                                                            
<img 
src="summary253x.png" alt="C = 500+ -10000-5000 = 550 IOs.
         1000000
" class="math-display" ></div>
     </li></ol>
<div class="newtheorem">
<!--l. 3179--><p class="noindent" ><span class="head">
<a 
 id="x1-71008r9"></a>
<span 
class="ecbx-1000">Example 8.9.</span>  </span>Let&#8217;s see what happens if the index does not fit in memory.
<!--l. 3182--><p class="indent" >   Let the <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">.A </span>index occupy 201 blocks (1 root and 200 leaves), so it cannot be fully fitted in memory
<img 
src="summary254x.png" alt="(M  = 101)"  class="left" align="middle">. We can store the root node and 99 leaf nodes in memory. Then for each value to check, there is a
<img 
src="summary255x.png" alt="-99
200"  class="frac" align="middle"> chance that we can find the value in memory, and <img 
src="summary256x.png" alt="101
200"  class="frac" align="middle"> that we don&#8217;t. Then, the cost of checking the value
in the index is
   <div class="math-display" >
<img 
src="summary257x.png" alt="C     = 0 &#x00D7; 99-+ 1 &#x00D7; 101&#x2248; 0.5.
  index      200      200
" class="math-display" ></div>
<!--l. 3191--><p class="indent" >   Thus, the total cost is
   <div class="math-display" >
<img 
src="summary258x.png" alt="C = 500+ 5000[0.5 +2] = 13000 IOs.
" class="math-display" ></div>
<!--l. 3195--><p class="indent" >   In this case, we have assumed the case 2. The detailed explanation is:
</div>
<!--l. 3197--><p class="indent" >
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3199--><p class="noindent" >Read <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>: 500 IOs
     </li>
     <li class="itemize">
     <!--l. 3200--><p class="noindent" >For each tuple in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <img 
src="summary259x.png" alt="(5000&#x00D7;)"  class="left" align="middle">:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 3202--><p class="noindent" >We need to check the value in the index: <span 
class="cmr-10">0</span><span 
class="cmmi-10">.</span><span 
class="cmr-10">5 </span>IOs
                                                                                            
                                                                                            
         </li>
         <li class="itemize">
         <!--l. 3203--><p class="noindent" >And we need to recover the matches: assuming case 2 is <span 
class="cmr-10">2 </span>IOs, assuming case 3 is 0.1 IOs</li></ul>
     </li></ul>
<div class="tcolorbox tcolorbox" id="tcolobox-12">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 3208--><p class="noindent" ><span class="head">
<a 
 id="x1-71009r4"></a>
<span 
class="ecbx-1000">Theorem 8.4.</span>   </span><span 
class="ecti-1000">In general, for an index join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary260x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><sub><span 
class="cmmi-7">A</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="ecti-1000">with sizes (in blocks) </span><span 
class="cmmi-10">B</span><img 
src="summary261x.png" alt="(R1)"  class="left" align="middle"> <span 
class="ecti-1000">and </span><span 
class="cmmi-10">B</span><img 
src="summary262x.png" alt="(R2)"  class="left" align="middle"> <span 
class="ecti-1000">and sizes (in</span>
<span 
class="ecti-1000">tuples) </span><span 
class="cmmi-10">T</span><img 
src="summary263x.png" alt="(R1)"  class="left" align="middle"> <span 
class="ecti-1000">and </span><span 
class="cmmi-10">T</span><img 
src="summary264x.png" alt="(R2)"  class="left" align="middle"><span 
class="ecti-1000">, where:</span>
       <ul class="itemize1">
       <li class="itemize">
       <!--l. 3214--><p class="noindent" ><span 
class="ecti-1000">There is an index for </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">.A </span><span 
class="ecti-1000">of size </span><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="ecti-1000">.</span>
       </li>
       <li class="itemize">
       <!--l. 3215--><p class="noindent" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="ecti-1000">is contiguously stored in memory.</span>
       </li>
       <li class="itemize">
       <!--l. 3216--><p class="noindent" ><span 
class="ecti-1000">There is a memory capacity of </span><span 
class="cmmi-10">M</span><span 
class="ecti-1000">.</span></li></ul>
<!--l. 3218--><p class="noindent" ><span 
class="ecti-1000">If the index does not fit in memory, the estimated cost is</span>
<div class="math-display" >
<img 
src="summary265x.png" alt="                  [(         )          ]
C = B (R2 )+ T (R2 ) 1- M----2  + matched ,
                         Si
" class="math-display" ></div>
<!--l. 3222--><p class="noindent" ><span 
class="ecti-1000">where </span><span 
class="cmmi-10">matched </span><span 
class="ecti-1000">depends on the assumtions about how the values of the index are distributed.</span>
<!--l. 3225--><p class="noindent" ><span 
class="ecti-1000">If the index fits in memory, the estimated cost is</span>
<div class="math-display" >
<img 
src="summary266x.png" alt="C = B (R2)+ T (R2 )&#x00D7; matched.
" class="math-display" ></div>
</div>
<!--l. 3229--><p class="noindent" >
 
</div> 
</div>
                                                                                            
                                                                                            
   <div class="proof">
<!--l. 3233--><p class="indent" >   <span class="head">
<span 
class="ecti-1000">Proof.</span> </span>We will need to read all blocks of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>, which sums up to <span 
class="cmmi-10">B</span><img 
src="summary267x.png" alt="(R )
   2"  class="left" align="middle">.
<!--l. 3235--><p class="indent" >   Then, for each tuple in <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>, we need to check the index and recover all matches. Thus, if the index fits in
memory, the result is obvious.
<!--l. 3238--><p class="indent" >   If the index does not fit in memory, we will store the root and <span 
class="cmmi-10">M </span><span 
class="cmsy-10">- </span><span 
class="cmr-10">2 </span>leave nodes. Thus
   <div class="math-display" >
<img 
src="summary268x.png" alt="                        M---2-
P rob (value in memory ) =  Si  ,
" class="math-display" ></div>
<!--l. 3243--><p class="indent" >   so
   <div class="math-display" >
<img 
src="summary269x.png" alt="Prob(value not in memory ) = 1- P rob(value in memory ) = 1- M-- 2-.
                                                          Si
" class="math-display" ></div>
<!--l. 3247--><p class="indent" >   And so, we obtain the desired formula.                                                                                       __
   </div>
<!--l. 3249--><p class="indent" >   Let&#8217;s now continue with the hash join:
   <div class="newtheorem">
<!--l. 3250--><p class="noindent" ><span class="head">
<a 
 id="x1-71010r10"></a>
<span 
class="ecbx-1000">Example 8.10.</span>  </span><span 
class="ecbx-1000">Hash join </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary270x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> where <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">2</span></sub> are <span 
class="ecbx-1000">contiguously stored </span>and <span 
class="ecbx-1000">unordered</span>. According to
<span class="cite">[<a 
href="#Xgarcia2002">2</a>]</span>, we may hash each relation to 100 buckets, so the average size of a bucket is 10 blocks for <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and 5 blocks
for <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>. Since the smaller number, 5, is much less than the number of available buffers, we expect to have no
trouble performing a one-pass join on each pair of buckets. The number of disk IOs is 1500 to read each of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>
and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub> while hashing into buckets, another 1500 to write all the buckets to disk, and a third 1500 to read each
pair of buckets into main memory again while taking the one-pass join of corresponding buckets. Thus, the total
cost is
<!--l. 3263--><p class="indent" >
   <div class="math-display" >
                                                                                            
                                                                                            
<img 
src="summary271x.png" alt="C = 3 (B (R1)+ B (R2)) = 4500 IOs.
" class="math-display" ></div>
   </div>
<!--l. 3267--><p class="indent" >
About the memory requirements, we need the buckets to fit into memory. We are taking <span 
class="cmmi-10">M </span><span 
class="cmsy-10">- </span><span 
class="cmr-10">1 </span>buckets, so the size of
the buckets are <img 
src="summary272x.png" alt="B(R1)-
M -1"  class="frac" align="middle"> blocks and <img 
src="summary273x.png" alt="B-(R2)
 M- 1"  class="frac" align="middle"> blocks for buckets of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and buckets of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">2</span></sub>, respectively. It is enough to fit the
smaller one, say <img 
src="summary274x.png" alt="--B-
M -1"  class="frac" align="middle"> blocks. Then, we need to ensure that
   <div class="math-display" >
<img 
src="summary275x.png" alt="  B
M---1-&#x003C; M  - 1,
" class="math-display" ></div>
<!--l. 3277--><p class="indent" >   so we need to fulfill
   <div class="math-display" >
<img 
src="summary276x.png" alt="B &#x003C; (M - 1)2
" class="math-display" ></div>
<!--l. 3281--><p class="indent" >   or
   <div class="math-display" >
<img 
src="summary277x.png" alt="&#x221A; --
  B &#x003C; M - 1.
" class="math-display" ></div>
<!--l. 3286--><p class="indent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;V<br /></span><a 
 id="x1-72000V"></a>Extensibility</h1>
   <h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-730009"></a>Extensible databases: PostgreSQL</h3>
<!--l. 3292--><p class="noindent" >This section is adapted from the course slides and <a 
href="https://www.postgresql.org/docs/current/extend.html" >PostgreSQL: Extensibility</a>.
<!--l. 3294--><p class="indent" >   PostgreSQL is extensible because its operation is catalog-driven. Relational DB systems store information about
databases, tables, columns, etc., in what are commonly known as system catalogs.
<!--l. 3298--><p class="indent" >   The catalogs appear to the user as tables like any other, but the DBMS stores its internal bookkeeping in them. One
key difference between PostgreSQL and standard relational database systems is that PostgreSQL stores much more
information in its catalogs: not only information about tables and columns, but also information about data types,
functions, access methods, and so on. These tables can be modified by the user, and since PostgreSQL bases its
operation on these tables, this means that PostgreSQL can be extended by users. By comparison, conventional database
systems can only be extended by changing hardcoded procedures in the source code or by loading modules specially
written by the DBMS vendor.
<!--l. 3310--><p class="indent" >   The PostgreSQL server can moreover incorporate user-written code into itself through dynamic loading. That is, the
user can specify an object code file (e.g., a shared library) that implements a new type or function, and PostgreSQL will
load it as required. Code written in SQL is even more trivial to add to the server. This ability to modify its operation
&#8220;on the fly&#8221; makes PostgreSQL uniquely suited for rapid prototyping of new applications and storage
structures.
<!--l. 3319--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.1   </span> <a 
 id="x1-740009.1"></a>Types</h4>
<!--l. 3321--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.1.1   </span> <a 
 id="x1-750009.1.1"></a>Base types</h5>
<!--l. 3323--><p class="noindent" >Base types are those, like integer, that are implemented below the level of the SQL language. PostgreSQL can only
operate on such types through functions provided by the user and only understands the behavior of such types to the
extent that the user describes them.
<!--l. 3328--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.1.2   </span> <a 
 id="x1-760009.1.2"></a>Container types</h5>
<!--l. 3330--><p class="noindent" >Container types can be arrays, composites and ranges:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3332--><p class="noindent" ><span 
class="ecbx-1000">Arrays </span>can hold multiple values that are all of the same type. An array type is automatically created for
     each base type, composite type, range type, and domain type. But there are no arrays of arrays.
     </li>
     <li class="itemize">
     <!--l. 3335--><p class="noindent" ><span 
class="ecbx-1000">Composite </span>types, or row types, are created whenever the user creates a table. It is also possible to use
     CREATE TYPE to define a &#8220;stand-alone&#8221; composite type with no associated table. A composite type is
     simply a list of types with associated field names. A value of a composite type is a row or record of field
     values.
     </li>
     <li class="itemize">
     <!--l. 3341--><p class="noindent" >A <span 
class="ecbx-1000">range </span>type can hold two values of the same type, which are the lower and upper bounds of the range.
     Range types are user-created, although a few built-in ones exist.</li></ul>
                                                                                            
                                                                                            
<!--l. 3346--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.1.3   </span> <a 
 id="x1-770009.1.3"></a>Domains</h5>
<!--l. 3348--><p class="noindent" >A domain is based on a particular underlying type and for many purposes is interchangeable with its underlying type.
However, a domain can have constraints that restrict its valid values to a subset of what the underlying type would
allow. Domains are created using the SQL command CREATE DOMAIN.
<!--l. 3354--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.1.4   </span> <a 
 id="x1-780009.1.4"></a>Pseudo-types</h5>
<!--l. 3356--><p class="noindent" >There are a few &#8220;pseudo-types&#8221; for special purposes. Pseudo-types cannot appear as columns of tables or components of
container types, but they can be used to declare the argument and result types of functions. This provides a mechanism
within the type system to identify special classes of functions.
<!--l. 3362--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.1.5   </span> <a 
 id="x1-790009.1.5"></a>Polymorphic types</h5>
<!--l. 3364--><p class="noindent" >Some pseudo-types of special interest are the polymorphic types, which are used to declare polymorphic
functions. This powerful feature allows a single function definition to operate on many different data types,
with the specific data type(s) being determined by the data types actually passed to it in a particular
call.
<!--l. 3370--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.2   </span> <a 
 id="x1-800009.2"></a>Functions</h4>
<!--l. 3372--><p class="noindent" >PostgreSQL provides four kinds of functions:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3374--><p class="noindent" >query language functions (functions written in SQL)
     </li>
     <li class="itemize">
     <!--l. 3375--><p class="noindent" >procedural language functions (functions written in, for example, PL/pgSQL or PL/Tcl)
     </li>
     <li class="itemize">
     <!--l. 3377--><p class="noindent" >internal functions
     </li>
     <li class="itemize">
     <!--l. 3378--><p class="noindent" >C-language functions</li></ul>
<!--l. 3380--><p class="noindent" >Every kind of function can take base types, composite types, or combinations of these as arguments (parameters). In
addition, every kind of function can return a base type or a composite type. Functions can also be defined to return sets
of base or composite values.
<!--l. 3385--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.2.1   </span> <a 
 id="x1-810009.2.1"></a>SQL functions</h5>
<!--l. 3387--><p class="noindent" >SQL functions execute an arbitrary list of SQL statements, returning the result of the last query in the list. In the
simple (non-set) case, the first row of the last query&#8217;s result will be returned. (Bear in mind that &#8220;the first row&#8221; of a
multirow result is not well-defined unless you use ORDER BY). If the last query happens to return no rows at all, the
null value will be returned.
<!--l. 3395--><p class="indent" >   Alternatively, an SQL function can be declared to return a set (that is, multiple rows) by specifying the function&#8217;s
return type as SETOF sometype, or equivalently by declaring it as RETURNS TABLE(columns). In this case all rows
of the last query&#8217;s result are returned.
                                                                                            
                                                                                            
<!--l. 3400--><p class="indent" >   Any collection of commands in the SQL language can be packaged together and defined as a function. However, the
final command must be a SELECT or have a RETURNING clause that returns whatever is specified as the function&#8217;s
return type. Alternatively, if you want to define an SQL function that performs actions but has no useful value to
return, you can define it as returning void.
   <div class="newtheorem">
<!--l. 3406--><p class="noindent" ><span class="head">
<a 
 id="x1-81001r1"></a>
<span 
class="ecbx-1000">Example 9.1.</span>  </span>A SQL function defined by the user.
   <!--l. 3409-->
   <div class="lstlisting" id="listing-29"><span class="label"><a 
 id="x1-81002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">CREATE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FUNCTION</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">clean_emp</span></span><span style="color:#000000"><span 
class="ectt-1000">()</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">RETURNS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">void</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-81003r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">DELETE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">emp</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-81004r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">salary</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">0;</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-81005r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">LANGUAGE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">SQL</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
   </div>
<!--l. 3415--><p class="indent" >
   <div class="newtheorem">
<!--l. 3416--><p class="noindent" ><span class="head">
<a 
 id="x1-81006r1"></a>
<span 
class="ecti-1000">Remark </span>9.1<span 
class="ecti-1000">.</span>  </span>The entire body of an SQL function is parsed before any of it is executed. While an SQL function
can contain commands that alter the system catalogs (e.g., CREATE TABLE), the effects of such commands
will not be visible during parse analysis of later commands in the function. Thus, for example, CREATE TABLE
foo (...); INSERT INTO foo VALUES(...); will not work as desired if packaged up into a single SQL function,
since foo won&#8217;t exist yet when the INSERT command is parsed. It&#8217;s recommended to use PL/pgSQL instead of
an SQL function in this type of situation.
   </div>
<!--l. 3425--><p class="indent" >
   <div class="newtheorem">
<!--l. 3427--><p class="noindent" ><span class="head">
<a 
 id="x1-81007r2"></a>
<span 
class="ecti-1000">Remark </span>9.2<span 
class="ecti-1000">.</span>  </span>More than one function can be defined with the same SQL name, so long as the arguments they
take are different. In other words, function names can be overloaded. This is called <span 
class="ecbx-1000">function overloading</span>.
   </div>
<!--l. 3431--><p class="indent" >
<!--l. 3433--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.2.2   </span> <a 
 id="x1-820009.2.2"></a>Procedural functions</h5>
<!--l. 3435--><p class="noindent" >PostgreSQL allows user-defined functions to be written in other languages besides SQL and C. These other languages
are generically called procedural languages (PLs). Procedural languages aren&#8217;t built into the PostgreSQL server; they
are offered by loadable modules.
<!--l. 3440--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.2.3   </span> <a 
 id="x1-830009.2.3"></a>Internal functions</h5>
<!--l. 3442--><p class="noindent" >Internal functions are functions written in C that have been statically linked into the PostgreSQL server. The &#8220;body&#8221; of
the function definition specifies the C-language name of the function, which need not be the same as the name being
declared for SQL use.
                                                                                            
                                                                                            
<!--l. 3447--><p class="indent" >   Normally, all internal functions present in the server are declared during the initialization of the database cluster,
but a user could use CREATE FUNCTION to create additional alias names for an internal function. Internal functions
are declared in CREATE FUNCTION with language name internal.
   <div class="newtheorem">
<!--l. 3452--><p class="noindent" ><span class="head">
<a 
 id="x1-83001r2"></a>
<span 
class="ecbx-1000">Example 9.2.</span>  </span>An internal function.
   <!--l. 3455-->
   <div class="lstlisting" id="listing-30"><span class="label"><a 
 id="x1-83002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">CREATE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FUNCTION</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">square_root</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">double</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">precision</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">RETURNS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">double</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">precision</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-83003r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">AS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span style="color:#000000"><span 
class="ectt-1000">dsqrt</span></span><span style="color:#000000"><span 
class="ectt-1000">&#8217;</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-83004r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">LANGUAGE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">internal</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-83005r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">STRICT</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
   </div>
<!--l. 3461--><p class="indent" >
<!--l. 3463--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.2.4   </span> <a 
 id="x1-840009.2.4"></a>C-Language functions</h5>
<!--l. 3465--><p class="noindent" >User-defined functions can be written in C (or a language that can be made compatible with C, such as C++). Such
functions are compiled into dynamically loadable objects (also called shared libraries) and are loaded by the server on
demand. The dynamic loading feature is what distinguishes &#8220;C language&#8221; functions from &#8220;internal&#8221; functions &#8212; the
actual coding conventions are essentially the same for both. (Hence, the standard internal function library is a rich
source of coding examples for user-defined C functions.)
<!--l. 3475--><p class="indent" >   Currently only one calling convention is used for C functions (&#8220;version 1&#8221;). Support for that calling convention is
indicated by writing a PG_FUNCTION_INFO_V1() macro call for the function.
<!--l. 3479--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">9.2.5   </span> <a 
 id="x1-850009.2.5"></a>Function volatility categories</h5>
<!--l. 3481--><p class="noindent" >Every function has a volatility classification, with the possibilities being VOLATILE, STABLE, or IMMUTABLE.
VOLATILE is the default if the CREATE FUNCTION command does not specify a category. The volatility category is
a promise to the optimizer about the behavior of the function:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3486--><p class="noindent" >A <span 
class="ecbx-1000">VOLATILE </span>function can do anything, including modifying the database. It can return different results
     on successive calls with the same arguments. The optimizer makes no assumptions about the behavior of
     such functions. A query using a volatile function will re-evaluate the function at every row where its value
     is needed.
     </li>
     <li class="itemize">
     <!--l. 3491--><p class="noindent" >A <span 
class="ecbx-1000">STABLE </span>function cannot modify the database and is guaranteed to return the same results given the
     same arguments for all rows within a single statement. This category allows the optimizer to optimize
     multiple calls of the function to a single call. In particular, it is safe to use an expression containing such
     a function in an index scan condition. (Since an index scan will evaluate the comparison value only once,
     not once at each row, it is not valid to use a VOLATILE function in an index scan condition.)
     </li>
     <li class="itemize">
     <!--l. 3499--><p class="noindent" >An <span 
class="ecbx-1000">IMMUTABLE </span>function cannot modify the database and is guaranteed to return the same results
     given the same arguments forever. This category allows the optimizer to pre-evaluate the function when a
     query calls it with constant arguments. For example, a query like SELECT ... WHERE x = 2 + 2 can be
     simplified on sight to SELECT ... WHERE x = 4, because the function underlying the integer addition
     operator is marked IMMUTABLE.</li></ul>
                                                                                            
                                                                                            
<!--l. 3507--><p class="noindent" >For best optimization results, you should label your functions with the strictest volatility category that is valid for
them.
<!--l. 3510--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.3   </span> <a 
 id="x1-860009.3"></a>Procedures</h4>
<!--l. 3512--><p class="noindent" >A procedure is a database object similar to a function. The key differences are:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3515--><p class="noindent" >Procedures are defined with the CREATE PROCEDURE command, not CREATE FUNCTION.
     </li>
     <li class="itemize">
     <!--l. 3517--><p class="noindent" >Procedures do not return a function value; hence CREATE PROCEDURE lacks a RETURNS clause.
     However, procedures can instead return data to their callers via output parameters
     </li>
     <li class="itemize">
     <!--l. 3520--><p class="noindent" >While a function is called as part of a query or DML (data manipulation language) command, a procedure
     is called in isolation using the CALL command.
     </li>
     <li class="itemize">
     <!--l. 3523--><p class="noindent" >A procedure can commit or roll back transactions during its execution (then automatically beginning a
     new transaction), so long as the invoking CALL command is not part of an explicit transaction block. A
     function cannot do that.
     </li>
     <li class="itemize">
     <!--l. 3527--><p class="noindent" >Certain function attributes, such as strictness, don&#8217;t apply to procedures. Those attributes control how
     the function is used in a query, which isn&#8217;t relevant to procedures.</li></ul>
<!--l. 3531--><p class="noindent" >Collectively, functions and procedures are also known as <span 
class="ecbx-1000">routines</span>. There are commands such as ALTER ROUTINE and
DROP ROUTINE that can operate on functions and procedures without having to know which kind it is. Note,
however, that there is no CREATE ROUTINE command.
<!--l. 3536--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.4   </span> <a 
 id="x1-870009.4"></a>Interfacing extensions to indexes</h4>
<!--l. 3538--><p class="noindent" >The procedures described thus far let you define new types, new functions, and new operators. However, we
cannot yet define an index on a column of a new data type. To do this, we must define an <span 
class="ecbx-1000">operator class</span>
for the new data type.Operator classes can be grouped into operator families to show the relationships
between semantically compatible classes. When only a single data type is involved, an operator class is
sufficient.
<!--l. 3546--><p class="indent" >   The operators associated with an operator class are identified by &#8220;strategy numbers&#8221;, which serve to identify the
semantics of each operator within the context of its operator class. For example, B-trees impose a strict ordering on
keys, lesser to greater, and so operators like &#8220;less than&#8221; and &#8220;greater than or equal to&#8221; are interesting with respect to a
B-tree. Because PostgreSQL allows the user to define operators, PostgreSQL cannot look at the name of an
operator (e.g., &#x003C; or &#x003E;=) and tell what kind of comparison it is. Instead, the index method defines a set
of &#8220;strategies&#8221;, which can be thought of as generalized operators. Each operator class specifies which
actual operator corresponds to each strategy for a particular data type and interpretation of the index
semantics.
   <div class="newtheorem">
<!--l. 3559--><p class="noindent" ><span class="head">
<a 
 id="x1-87001r3"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 9.3.</span>  </span>The B-tree index method defines five strategies, shown in the next Table.
   <div class="tabular"> <table id="TBL-9" class="tabular" 
 
><colgroup id="TBL-9-1g"><col 
id="TBL-9-1"></colgroup><colgroup id="TBL-9-2g"><col 
id="TBL-9-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-1"  
class="td11">     <span 
class="ecbx-1000">Operation       </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-2"  
class="td11"> <span 
class="ecbx-1000">Strategy Number  </span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-2-1"  
class="td11">      less than          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-2-2"  
class="td11">         1              </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-3-1"  
class="td11"> less than or equal </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-9-3-2"  
class="td11"> 2</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-4-1"  
class="td11">        equal            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-4-2"  
class="td11">         3              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-5-1"  
class="td11"> greater than or equal  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-5-2"  
class="td11">         4              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-6-1"  
class="td11">     greater than        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-6-2"  
class="td11">         5              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-7-1"  
class="td11">                    </td> </tr></table></div>
   </div>
<!--l. 3585--><p class="indent" >
<!--l. 3587--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.5   </span> <a 
 id="x1-880009.5"></a>Steps to create a PostgreSQL extension</h4>
<!--l. 3588--><p class="noindent" >
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-88002x1">
     <!--l. 3589--><p class="noindent" >Create the appropriate file structure: <span 
class="cmmi-10">extension</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">version.sql</span>, <span 
class="cmmi-10">extension.c</span>, <span 
class="cmmi-10">Makefile</span>, <span 
class="cmmi-10">extension.control</span>.
     </li>
<li 
  class="enumerate" id="x1-88004x2">
     <!--l. 3591--><p class="noindent" >Create the data types.
     </li>
<li 
  class="enumerate" id="x1-88006x3">
     <!--l. 3592--><p class="noindent" >Create I/O functions.
     </li>
<li 
  class="enumerate" id="x1-88008x4">
     <!--l. 3593--><p class="noindent" >Create constructors, getters, setters.
     </li>
<li 
  class="enumerate" id="x1-88010x5">
     <!--l. 3594--><p class="noindent" >Create needed functions.
     </li>
<li 
  class="enumerate" id="x1-88012x6">
     <!--l. 3595--><p class="noindent" >Create operators <span 
class="cmr-10">=</span><span 
class="cmmi-10">,&#x003C;,</span><span 
class="cmsy-10">&#x2264;</span><span 
class="cmmi-10">,&#x003E;,</span><span 
class="cmsy-10">&#x2265;</span><span 
class="cmmi-10">,...</span>
     </li>
<li 
  class="enumerate" id="x1-88014x7">
     <!--l. 3596--><p class="noindent" >Define operator classes for indexes.</li></ol>
<!--l. 3598--><p class="noindent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;VI<br /></span><a 
 id="x1-89000VI"></a>Failure Recovery and concurrency control</h1>
   <h3 class="sectionHead"><span class="titlemark">10   </span> <a 
 id="x1-9000010"></a>Failure recovery</h3>
   <div class="tcolorbox tcolorbox" id="tcolobox-13">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 3605--><p class="noindent" ><span class="head">
<a 
 id="x1-90001r1"></a>
<span 
class="ecbx-1000">Definition 10.1.</span>   </span><span 
class="ecbx-1000">Integrity constraints </span>are predicates that all data in the database must satisfy.
<!--l. 3609--><p class="noindent" >A database is said to be in a <span 
class="ecbx-1000">consistent state </span>if it satisfies all constraints defined on it. In such case,
the database itself is said to be a <span 
class="ecbx-1000">consistent DB</span>.
</div>
<!--l. 3612--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 3615--><p class="noindent" ><span class="head">
<a 
 id="x1-90002r1"></a>
<span 
class="ecti-1000">Remark </span>10.1<span 
class="ecti-1000">.</span>  </span>Databases cannot be consistent at all times, because when some operations are being done, it is
possible to be in intermediate non-consistent states.
   </div>
<!--l. 3619--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-14">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><!--l. 3621--><p class="noindent" >A <span 
class="ecbx-1000">transaction </span>is a collection of actions that preserve consistency. Thus, a transaction should be the
smallest unit of processing in the database.  
</div> 
</div>
<!--l. 3626--><p class="noindent" >A fundamental assumption about transactions is the correctness principle:
   <div class="tcolorbox tcolorbox" id="tcolobox-15">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><!--l. 3629--><p class="noindent" ><span 
class="ecbx-1000">Correctness principle</span>: If a transaction executes in the absence of any other transactions or system
errors, and it starts with the database in a consistent state, then the database is also in a consistent
state when the transaction ends.  
</div> 
</div>
<!--l. 3635--><p class="indent" >   There is a converse to the correctness principle that forms the motivation for both the logging techniques that we
are going to see. This converse involves two points:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-90004x1">
     <!--l. 3639--><p class="noindent" >A transaction is <span 
class="ecbx-1000">atomic</span>, that is, it must be executed as a whole or not at all. If only part of a transaction
     executes, then the resulting database state may not be consistent. For example, if the system crashes in
     the middle of a transaction, if there is a media failure,...
     </li>
<li 
  class="enumerate" id="x1-90006x2">
     <!--l. 3644--><p class="noindent" >Transactions that execute simultaneously are likely to lead to an inconsistent state unless we take steps
     to control their interactions (refer to Section <a 
href="#x1-10000011">11<!--tex4ht:ref: sec:Concurrency-control --></a>).</li></ol>
                                                                                            
                                                                                            
<!--l. 3648--><p class="noindent" >In order to study the details of logging algorithms and other transactionmanagement algorithms, we need a notation
that describes all the operations that move data between address spaces. The primitives we shall use
are:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 3652--><p class="noindent" >INPUT(X): Copy the disk block containing database element X to a memory buffer.
     </li>
     <li class="itemize">
     <!--l. 3654--><p class="noindent" >READ(X,t): Copy the database element X to the transaction&#8217;s local variable t. More precisely, if the block
     containing database element X is not in a memory buffer then first execute INPUT (X). Next, assign the
     value of X to local variable t.
     </li>
     <li class="itemize">
     <!--l. 3658--><p class="noindent" >WRITE(X,t): Copy the value of local variable t to database element X in a memory buffer. More precisely,
     if the block containing database element X is not in a memory buffer then execute INPUT(X). Next, copy
     the value of t to X in the buffer.
     </li>
     <li class="itemize">
     <!--l. 3662--><p class="noindent" >OUTPUT (X): Copy the block containing X from its buffer to disk</li></ul>
<!--l. 3665--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">10.1   </span> <a 
 id="x1-9100010.1"></a>Key problem: unfinished transactions</h4>
<!--l. 3667--><p class="noindent" >Unfinished transactions are a great problem when dealing with consistency. If we assume the correctness principle and
all transactions execute completely (and isolated) then databases would always be consistent, and we would not be
studying this, so there are reasons that makes transactions not to finish completely, leading to inconsistent
states.
   <div class="newtheorem">
<!--l. 3672--><p class="noindent" ><span class="head">
<a 
 id="x1-91001r1"></a>
<span 
class="ecbx-1000">Example 10.1.</span>  </span>Imagine we impose the constraint <span 
class="cmmi-10">A </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">B </span>and we want to execute the transaction
<table 
class="align-star">
                                        <tr><td 
class="align-odd"><span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmr-10">:</span></td>                                        <td 
class="align-even"><span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                                        <td 
class="align-label"></td>                                        <td 
class="align-label">
                                        </td></tr><tr><td 
class="align-odd"></td>                                           <td 
class="align-even"><span 
class="cmmi-10">B </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">B </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                                        <td 
class="align-label"></td>                                        <td 
class="align-label"></td></tr></table>
                                                                                            
                                                                                            
<!--l. 3679--><p class="indent" >   It is obvious that if the database is consistent at the beginning of the transaction, it will also be consistent at the
end, because both values start being the same, and they are modified in the same way.
<!--l. 3684--><p class="indent" >   Let&#8217;s see how things can go wrong.
<!--l. 3686--><p class="indent" >   Imagine the following plan:
<table 
class="align-star">
                        <tr><td 
class="align-odd"><span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmr-10">:</span></td>                        <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary278x.png" alt="(A,t)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                        <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">
                        </td></tr><tr><td 
class="align-odd"></td>                           <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary279x.png" alt="(A,t)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"></td>                               <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">
                        </td></tr><tr><td 
class="align-odd"></td>                           <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary280x.png" alt="(B,t)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                        <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">
                        </td></tr><tr><td 
class="align-odd"></td>                           <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary281x.png" alt="(B,t)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"></td>                               <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">
                        </td></tr><tr><td 
class="align-odd"></td>                           <td 
class="align-even"><span 
class="cmmi-10">Output</span><img 
src="summary282x.png" alt="(A)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"></td>                               <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">
                        </td></tr><tr><td 
class="align-odd"></td>                           <td 
class="align-even"><span 
class="cmmi-10">Output</span><img 
src="summary283x.png" alt="(B)"  class="left" align="middle"><span 
class="cmr-10">;</span></td>                        <td 
class="align-odd"></td>                               <td 
class="align-even"></td>                        <td 
class="align-label"></td>                        <td 
class="align-label">                        </td></tr></table>
<!--l. 3695--><p class="indent" >   The initial state is:
   <div class="tabular"> <table id="TBL-10" class="tabular" 
 
><colgroup id="TBL-10-1g"><col 
id="TBL-10-1"></colgroup><colgroup id="TBL-10-2g"><col 
id="TBL-10-2"></colgroup><colgroup id="TBL-10-3g"><col 
id="TBL-10-3"></colgroup><colgroup id="TBL-10-4g"><col 
id="TBL-10-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-10-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-10-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-1"  
class="td11">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-2"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-4-1"  
class="td11">  </td> </tr></table></div>
<!--l. 3715--><p class="indent" >   After <span 
class="cmmi-10">Read</span><img 
src="summary284x.png" alt="(A, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-11" class="tabular" 
 
><colgroup id="TBL-11-1g"><col 
id="TBL-11-1"></colgroup><colgroup id="TBL-11-2g"><col 
id="TBL-11-2"></colgroup><colgroup id="TBL-11-3g"><col 
id="TBL-11-3"></colgroup><colgroup id="TBL-11-4g"><col 
id="TBL-11-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-11-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-11-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-2"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-2"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3740--><p class="indent" >   After <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span>:
   <div class="tabular"> <table id="TBL-12" class="tabular" 
 
><colgroup id="TBL-12-1g"><col 
id="TBL-12-1"></colgroup><colgroup id="TBL-12-2g"><col 
id="TBL-12-2"></colgroup><colgroup id="TBL-12-3g"><col 
id="TBL-12-3"></colgroup><colgroup id="TBL-12-4g"><col 
id="TBL-12-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-12-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-12-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-12-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-12-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-12-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-2-2"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-12-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-12-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-12-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-12-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-12-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-12-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-12-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-12-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-12-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-12-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3765--><p class="indent" >   After <span 
class="cmmi-10">Write</span><img 
src="summary285x.png" alt="(A, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-13" class="tabular" 
 
><colgroup id="TBL-13-1g"><col 
id="TBL-13-1"></colgroup><colgroup id="TBL-13-2g"><col 
id="TBL-13-2"></colgroup><colgroup id="TBL-13-3g"><col 
id="TBL-13-3"></colgroup><colgroup id="TBL-13-4g"><col 
id="TBL-13-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-13-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-13-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-13-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-13-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-13-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-13-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-13-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-13-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-13-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-13-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3790--><p class="indent" >   After <span 
class="cmmi-10">Read</span><img 
src="summary286x.png" alt="(B, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-14" class="tabular" 
 
><colgroup id="TBL-14-1g"><col 
id="TBL-14-1"></colgroup><colgroup id="TBL-14-2g"><col 
id="TBL-14-2"></colgroup><colgroup id="TBL-14-3g"><col 
id="TBL-14-3"></colgroup><colgroup id="TBL-14-4g"><col 
id="TBL-14-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-14-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-14-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-14-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-14-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-14-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-14-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-14-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-14-3-2"  
class="td11"> 8 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-14-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-14-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-14-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-14-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-4-2"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-14-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-14-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-14-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3815--><p class="indent" >   After <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span>:
   <div class="tabular"> <table id="TBL-15" class="tabular" 
 
><colgroup id="TBL-15-1g"><col 
id="TBL-15-1"></colgroup><colgroup id="TBL-15-2g"><col 
id="TBL-15-2"></colgroup><colgroup id="TBL-15-3g"><col 
id="TBL-15-3"></colgroup><colgroup id="TBL-15-4g"><col 
id="TBL-15-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-15-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-15-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-15-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-15-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-15-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-15-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-15-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-15-3-2"  
class="td11"> 8 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-15-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-15-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-15-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-15-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-15-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-15-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-15-5-1"  
class="td11"> </td> </tr></table>
</div>
                                                                                            
                                                                                            
<!--l. 3840--><p class="indent" >   After <span 
class="cmmi-10">Write</span><img 
src="summary287x.png" alt="(B, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-16" class="tabular" 
 
><colgroup id="TBL-16-1g"><col 
id="TBL-16-1"></colgroup><colgroup id="TBL-16-2g"><col 
id="TBL-16-2"></colgroup><colgroup id="TBL-16-3g"><col 
id="TBL-16-3"></colgroup><colgroup id="TBL-16-4g"><col 
id="TBL-16-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-16-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-16-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-16-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-16-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-16-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-16-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-16-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-16-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-16-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-16-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-16-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-16-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-16-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-16-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-16-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3865--><p class="indent" >   After <span 
class="cmmi-10">Output</span><img 
src="summary288x.png" alt="(A )"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-17" class="tabular" 
 
><colgroup id="TBL-17-1g"><col 
id="TBL-17-1"></colgroup><colgroup id="TBL-17-2g"><col 
id="TBL-17-2"></colgroup><colgroup id="TBL-17-3g"><col 
id="TBL-17-3"></colgroup><colgroup id="TBL-17-4g"><col 
id="TBL-17-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-17-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-17-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-17-1-3"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-17-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-17-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-2-4"  
class="td11"> 16  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-17-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-17-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-17-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-17-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-17-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-17-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-17-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-17-4-4"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-17-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-17-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3890--><p class="indent" >   After <span 
class="cmmi-10">Output</span><img 
src="summary289x.png" alt="(B )"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-18" class="tabular" 
 
><colgroup id="TBL-18-1g"><col 
id="TBL-18-1"></colgroup><colgroup id="TBL-18-2g"><col 
id="TBL-18-2"></colgroup><colgroup id="TBL-18-3g"><col 
id="TBL-18-3"></colgroup><colgroup id="TBL-18-4g"><col 
id="TBL-18-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-18-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-18-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-18-1-3"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-18-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-18-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-2-4"  
class="td11"> 16  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-18-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-18-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-18-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-18-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-18-3-4"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-18-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-18-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-18-4-4"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-18-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-18-5-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 3915--><p class="indent" >   If all actions execute, as we can see, the final state is consistent. Nonetheless, there is one point in the procedure
when a failure in the system can leave it in an inconsistent state: after <span 
class="cmmi-10">Output</span><img 
src="summary290x.png" alt="(A )"  class="left" align="middle"> and before <span 
class="cmmi-10">Output</span><img 
src="summary291x.png" alt="(B )"  class="left" align="middle"> the database
is inconsistent!
   </div>
<!--l. 3919--><p class="indent" >
We need to be able to ensure <span 
class="ecbx-1000">atomicity </span>of transactions: all actions are executed, or none of them. For this purpose,
<span 
class="ecbx-1000">logging </span>is an useful technique. Basically, the idea is to annotate all actions done in a file, and if the
system crashes, we can consult this file and rollback unfinished transactions, continuing from the point
left,...
<!--l. 3926--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">10.2   </span> <a 
 id="x1-9200010.2"></a>Logging</h4>
   <div class="tcolorbox tcolorbox" id="tcolobox-16">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 3929--><p class="noindent" ><span class="head">
<a 
 id="x1-92001r2"></a>
<span 
class="ecbx-1000">Definition 10.2.</span>   </span>A <span 
class="ecbx-1000">log </span>is a file of log records, each telling something about what some transaction has
done. If log records appear in nonvolatile storage, we can use them to restore the database to a consistent
state after a system crash.
</div>
<!--l. 3934--><p class="noindent" >
 
</div> 
</div>
<!--l. 3937--><p class="noindent" >There are several forms of log record that are used with each of the types of logging we discuss in this chapter. These
are:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-92003x1">
     <!--l. 3940--><p class="noindent" >&#x003C;START T&#x003E;: This record indicates that transaction T has begun.
     </li>
<li 
  class="enumerate" id="x1-92005x2">
     <!--l. 3941--><p class="noindent" >&#x003C;COMMIT T&#x003E;: Transaction T has completed successfully and will make no more changes to database
     elements. Any changes to the database made by T should appear on disk. However, because we cannot
     control when the buffer manager chooses to copy blocks from memory to disk, we cannot in general be
     sure that the changes are already on disk when we see the &#x003C;C0MMIT T&#x003E; log record. If we insist that
     the changes already be on disk, this requirement must be enforced by the log manager (as is the case for
                                                                                            
                                                                                            
     undo logging).
     </li>
<li 
  class="enumerate" id="x1-92007x3">
     <!--l. 3949--><p class="noindent" >&#x003C; ABORT T&#x003E;: Transaction T could not complete successfully. If transaction T aborts, no changes it
     made can have been copied to disk, and it is the job of the transaction manager to make sure that such
     changes never appear on disk, or that their effect on disk is cancelled if they do.</li></ol>
<!--l. 3956--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">10.2.1   </span> <a 
 id="x1-9300010.2.1"></a>Undo logging</h5>
<!--l. 3958--><p class="noindent" ><span 
class="ecbx-1000">Undo logging </span>makes repairs to the database state by undoing the effects of transactions that may not have completed
before the crash.
<!--l. 3962--><p class="indent" >   For an undo log, the only other kind of log record we need is an update record, which is a triple &#x003C; T ,X ,v&#x003E; . The
meaning of this record is: transaction T has changed database element X , and its former value was v. The change
reflected by an update record normally occurs in memory, not disk.
<!--l. 3968--><p class="indent" >   An undo log does not record the new value of a database element, only the old value. If recovery is necessary in a
system using undo logging, the only thing the recovery manager will do is cancel the possible effect of a transaction on
disk by restoring the old value.
   <div class="newtheorem">
<!--l. 3972--><p class="noindent" ><span class="head">
<a 
 id="x1-93001r2"></a>
<span 
class="ecbx-1000">Example 10.2.</span>  </span>Let&#8217;s repeat the previous example with an undo log added to the scheme.
<!--l. 3975--><p class="indent" >   Initially:
   <div class="tabular"> <table id="TBL-19" class="tabular" 
 
><colgroup id="TBL-19-1g"><col 
id="TBL-19-1"></colgroup><colgroup id="TBL-19-2g"><col 
id="TBL-19-2"></colgroup><colgroup id="TBL-19-3g"><col 
id="TBL-19-3"></colgroup><colgroup id="TBL-19-4g"><col 
id="TBL-19-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-19-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-19-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-19-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-19-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-19-2-1"  
class="td11">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-19-2-2"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-19-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-19-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-19-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-19-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-19-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-19-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-19-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-19-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-19-4-1"  
class="td11">  </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-20" class="tabular" 
 
><colgroup id="TBL-20-1g"><col 
id="TBL-20-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-20-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-20-1-1"  
class="td11"> <span 
class="ecbx-1000">Log  </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-20-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-20-2-1"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-20-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-20-3-1"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-20-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-20-4-1"  
class="td11">      </td></tr></table></div>
<!--l. 4005--><p class="indent" >   The transaction <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> starts:
   <div class="tabular"> <table id="TBL-21" class="tabular" 
 
><colgroup id="TBL-21-1g"><col 
id="TBL-21-1"></colgroup><colgroup id="TBL-21-2g"><col 
id="TBL-21-2"></colgroup><colgroup id="TBL-21-3g"><col 
id="TBL-21-3"></colgroup><colgroup id="TBL-21-4g"><col 
id="TBL-21-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-21-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-21-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-21-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-21-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-21-2-1"  
class="td11">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-21-2-2"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-21-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-21-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-21-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-21-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-21-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-21-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-21-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-21-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-21-4-1"  
class="td11">  </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-22" class="tabular" 
 
><colgroup id="TBL-22-1g"><col 
id="TBL-22-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-22-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-22-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-22-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-22-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-22-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-22-3-1"  
class="td11">            </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-22-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-22-4-1"  
class="td11">            </td></tr></table></div>
<!--l. 4035--><p class="indent" >   <span 
class="cmmi-10">Read</span><img 
src="summary292x.png" alt="(A,t)"  class="left" align="middle"><span 
class="cmr-10">;</span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span>:
   <div class="tabular"> <table id="TBL-23" class="tabular" 
 
><colgroup id="TBL-23-1g"><col 
id="TBL-23-1"></colgroup><colgroup id="TBL-23-2g"><col 
id="TBL-23-2"></colgroup><colgroup id="TBL-23-3g"><col 
id="TBL-23-3"></colgroup><colgroup id="TBL-23-4g"><col 
id="TBL-23-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-23-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-23-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-23-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-23-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-23-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-2-2"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-23-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-23-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-23-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-23-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-23-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-23-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-23-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-23-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-23-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-23-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-24" class="tabular" 
 
><colgroup id="TBL-24-1g"><col 
id="TBL-24-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-24-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-24-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-24-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-24-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-24-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-24-3-1"  
class="td11">            </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-24-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-24-4-1"  
class="td11">            </td></tr></table></div>
<!--l. 4070--><p class="indent" >   <span 
class="cmmi-10">Write</span><img 
src="summary293x.png" alt="(A, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-25" class="tabular" 
 
><colgroup id="TBL-25-1g"><col 
id="TBL-25-1"></colgroup><colgroup id="TBL-25-2g"><col 
id="TBL-25-2"></colgroup><colgroup id="TBL-25-3g"><col 
id="TBL-25-3"></colgroup><colgroup id="TBL-25-4g"><col 
id="TBL-25-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-25-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-25-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-25-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-25-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-25-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-25-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-25-3-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-25-3-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-25-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-25-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-25-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-25-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-25-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-25-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-25-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-26" class="tabular" 
 
><colgroup id="TBL-26-1g"><col 
id="TBL-26-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-26-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-26-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-26-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-26-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-26-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-26-3-1"  
class="td11">  &#x003C;T1,A,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-26-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-26-4-1"  
class="td11">            </td></tr></table></div>
<!--l. 4105--><p class="indent" >   <span 
class="cmmi-10">Reat</span><img 
src="summary294x.png" alt="(B, t)"  class="left" align="middle"><span 
class="cmr-10">;</span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span>:
                                                                                            
                                                                                            
   <div class="tabular"> <table id="TBL-27" class="tabular" 
 
><colgroup id="TBL-27-1g"><col 
id="TBL-27-1"></colgroup><colgroup id="TBL-27-2g"><col 
id="TBL-27-2"></colgroup><colgroup id="TBL-27-3g"><col 
id="TBL-27-3"></colgroup><colgroup id="TBL-27-4g"><col 
id="TBL-27-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-27-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-27-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-27-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-27-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-27-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-27-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-27-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-27-3-2"  
class="td11"> 8 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-27-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-27-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-27-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-27-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-27-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-27-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-27-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-28" class="tabular" 
 
><colgroup id="TBL-28-1g"><col 
id="TBL-28-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-28-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-28-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-28-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-28-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-28-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-28-3-1"  
class="td11">  &#x003C;T1,A,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-28-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-28-4-1"  
class="td11">            </td></tr></table></div>
<!--l. 4140--><p class="indent" >   <span 
class="cmmi-10">Write</span><img 
src="summary295x.png" alt="(B, t)"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-29" class="tabular" 
 
><colgroup id="TBL-29-1g"><col 
id="TBL-29-1"></colgroup><colgroup id="TBL-29-2g"><col 
id="TBL-29-2"></colgroup><colgroup id="TBL-29-3g"><col 
id="TBL-29-3"></colgroup><colgroup id="TBL-29-4g"><col 
id="TBL-29-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-29-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-29-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-29-1-3"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-29-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-29-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-2-4"  
class="td11"> 8  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-29-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-29-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-29-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-29-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-29-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-29-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-29-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-29-4-4"  
class="td11">   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-29-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-29-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-30" class="tabular" 
 
><colgroup id="TBL-30-1g"><col 
id="TBL-30-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-30-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-30-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-30-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-30-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-30-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-30-3-1"  
class="td11">  &#x003C;T1,A,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-30-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-30-4-1"  
class="td11">  &#x003C;T1,B,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-30-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-30-5-1"  
class="td11">            </td></tr></table></div>
<!--l. 4177--><p class="indent" >   <span 
class="cmmi-10">Output</span><img 
src="summary296x.png" alt="(A )"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-31" class="tabular" 
 
><colgroup id="TBL-31-1g"><col 
id="TBL-31-1"></colgroup><colgroup id="TBL-31-2g"><col 
id="TBL-31-2"></colgroup><colgroup id="TBL-31-3g"><col 
id="TBL-31-3"></colgroup><colgroup id="TBL-31-4g"><col 
id="TBL-31-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-31-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-31-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-31-1-3"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-31-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-31-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-2-4"  
class="td11"> 16  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-31-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-31-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-31-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-31-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-31-3-4"  
class="td11"> 8</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-31-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-31-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-31-4-4"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-31-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-31-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-32" class="tabular" 
 
><colgroup id="TBL-32-1g"><col 
id="TBL-32-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-32-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-32-1-1"  
class="td11">    <span 
class="ecbx-1000">Log     </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-32-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-32-2-1"  
class="td11"> &#x003C;T1,start&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-32-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-32-3-1"  
class="td11">  &#x003C;T1,A,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-32-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-32-4-1"  
class="td11">  &#x003C;T1,B,8&#x003E;   </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-32-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-32-5-1"  
class="td11">            </td></tr></table></div>
<!--l. 4214--><p class="indent" >   <span 
class="cmmi-10">Output</span><img 
src="summary297x.png" alt="(B )"  class="left" align="middle">:
   <div class="tabular"> <table id="TBL-33" class="tabular" 
 
><colgroup id="TBL-33-1g"><col 
id="TBL-33-1"></colgroup><colgroup id="TBL-33-2g"><col 
id="TBL-33-2"></colgroup><colgroup id="TBL-33-3g"><col 
id="TBL-33-3"></colgroup><colgroup id="TBL-33-4g"><col 
id="TBL-33-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-33-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-33-1-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  </td><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-33-1-3"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-33-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-33-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-2-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-2-3"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-2-4"  
class="td11"> 16  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-33-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-33-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-33-3-2"  
class="td11"> 16 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-33-3-3"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-33-3-4"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-33-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-33-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-4-2"  
class="td11">  16   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-4-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-33-4-4"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-33-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-33-5-1"  
class="td11"> </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-34" class="tabular" 
 
><colgroup id="TBL-34-1g"><col 
id="TBL-34-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-1-1"  
class="td11">     <span 
class="ecbx-1000">Log       </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-2-1"  
class="td11">  &#x003C;T1,start&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-3-1"  
class="td11">   &#x003C;T1,A,8&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-4-1"  
class="td11">   &#x003C;T1,B,8&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-5-1"  
class="td11"> &#x003C;T1,commit&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-34-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-34-6-1"  
class="td11">              </td></tr></table></div>
<!--l. 4253--><p class="indent" >   Imagine the system crashes after <span 
class="cmmi-10">Output</span><img 
src="summary298x.png" alt="(A)"  class="left" align="middle"> and before <span 
class="cmmi-10">Output</span><img 
src="summary299x.png" alt="(B )"  class="left" align="middle">. When we switch on the system again, the
database system manager would check the log and see that <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> is unfinished, so it would set the values of <span 
class="cmmi-10">A </span>and <span 
class="cmmi-10">B </span>to be
8, and consistency would be recovered.
   </div>
<!--l. 4258--><p class="indent" >
<!--l. 4260--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-9400010.2.1"></a>Complications</h5>
<!--l. 4262--><p class="noindent" >Another aspect to take into account, is that the log must be first written in memory, not written to disk on every
action, so some problems can arise.
   <div class="newtheorem">
<!--l. 4265--><p class="noindent" ><span class="head">
<a 
 id="x1-94001r3"></a>
<span 
class="ecbx-1000">Example 10.3.</span>  </span>First bad state: DB modified before log is written
   <div class="tabular"> <table id="TBL-35" class="tabular" 
 
><colgroup id="TBL-35-1g"><col 
id="TBL-35-1"></colgroup><colgroup id="TBL-35-2g"><col 
id="TBL-35-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-35-1-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>  
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-35-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-35-2-2"  
class="td11">  16   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-35-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-35-3-2"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-35-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-35-4-2"  
class="td11">  16   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-5-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-35-5-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Log:</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-6-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-35-6-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,start&#x003E;</div>  
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-7-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-35-7-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,A,8&#x003E;</div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-8-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-35-8-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,B,8&#x003E;</div>   
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-35-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-35-9-1"  
class="td11">    </td> </tr></table>
                                                                                            
                                                                                            
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-36" class="tabular" 
 
><colgroup id="TBL-36-1g"><col 
id="TBL-36-1"></colgroup><colgroup id="TBL-36-2g"><col 
id="TBL-36-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-36-1-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-36-2-1"  
class="td11"> A </td><td  style="white-space:nowrap; text-align:center;" id="TBL-36-2-2"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-36-3-1"  
class="td11"> B  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-36-3-2"  
class="td11">  8   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-36-4-1"  
class="td11">    </td></tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-37" class="tabular" 
 
><colgroup id="TBL-37-1g"><col 
id="TBL-37-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-1-1"  
class="td11"> <span 
class="ecbx-1000">Log  </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-2-1"  
class="td11">      </td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-3-1"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-4-1"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-5-1"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-37-6-1"  
class="td11">      </td></tr></table></div>
<!--l. 4318--><p class="indent" >   If the system crashes now, we lose the log information in memory, and we don&#8217;t have it on disk, so we would not be
able to recover to the previous consistent state.
   </div>
<!--l. 4321--><p class="indent" >
   <div class="newtheorem">
<!--l. 4323--><p class="noindent" ><span class="head">
<a 
 id="x1-94002r4"></a>
<span 
class="ecbx-1000">Example 10.4.</span>  </span>Second bad state: log written before DB modified
   <div class="tabular"> <table id="TBL-38" class="tabular" 
 
><colgroup id="TBL-38-1g"><col 
id="TBL-38-1"></colgroup><colgroup id="TBL-38-2g"><col 
id="TBL-38-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-1-1"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Memory</span></div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-38-2-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-38-2-2"  
class="td11">   16     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-38-3-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-38-3-2"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-38-4-1"  
class="td11"> t  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-38-4-2"  
class="td11">   16     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-5-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-5-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Log:</div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-6-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-6-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,start&#x003E;</div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-7-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-7-1"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,A,8&#x003E;</div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-8-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-8-1"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,B,8&#x003E;</div>    
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-9-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-38-9-1"  
class="td11"> <div class="multicolumn"  style="white-space:nowrap; text-align:center;">&#x003C;T1,commit&#x003E;</div>  
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-38-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-38-10-1"  
class="td11">    </td> </tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-39" class="tabular" 
 
><colgroup id="TBL-39-1g"><col 
id="TBL-39-1"></colgroup><colgroup id="TBL-39-2g"><col 
id="TBL-39-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-39-1-"><td colspan="2" style="white-space:nowrap; text-align:center;" id="TBL-39-1-1"  
class="td11">  <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="ecbx-1000">Disk</span></div>   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-39-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-39-2-1"  
class="td11"> A </td><td  style="white-space:nowrap; text-align:center;" id="TBL-39-2-2"  
class="td11"> 16</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-39-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-39-3-1"  
class="td11"> B  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-39-3-2"  
class="td11">  8   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-39-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-39-4-1"  
class="td11">    </td></tr></table>
</div><!--tex4ht:inline--><div class="tabular"> <table id="TBL-40" class="tabular" 
 
><colgroup id="TBL-40-1g"><col 
id="TBL-40-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-1-1"  
class="td11">     <span 
class="ecbx-1000">Log       </span></td>
</tr><tr 
class="hline"><td><hr></td></tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-2-1"  
class="td11">  &#x003C;T1,start&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-3-1"  
class="td11">   &#x003C;T1,A,8&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-4-1"  
class="td11">   &#x003C;T1,B,8&#x003E;    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-5-1"  
class="td11"> &#x003C;T1,commit&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-40-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-40-6-1"  
class="td11">              </td></tr></table></div>
<!--l. 4378--><p class="indent" >   If the system fails now, we would think that <span 
class="cmmi-10">B </span>has been correctly chanegd, because the buffer manager has not
issued the <span 
class="cmmi-10">Output</span><img 
src="summary300x.png" alt="(B )"  class="left" align="middle"> operator yet.
   </div>
<!--l. 4381--><p class="indent" >
An undo log is sufficient to allow recovery from a system failure, provided transactions and the buffer manager obey two
rules:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-94003x10.2.1">
     <!--l. 4385--><p class="noindent" >If transaction T modifies database element X , then the log record of the form &#x003C; T ,X ,v&#x003E; must be written
     to disk before the new value of X is written to disk.
     </li>
<li 
  class="enumerate" id="x1-94004x10.2.1">
     <!--l. 4388--><p class="noindent" >If a transaction commits, then its COMMIT log record must be written to disk only after all database
     elements changed by the transaction have been written to disk, but as soon thereafter as possible.</li></ol>
<!--l. 4392--><p class="noindent" >In order to force log records to disk, the log manager needs a fiush-log command that tells the buffer manager to copy to
disk any log blocks that have not previously been copied to disk or that have been changed since they were last copied.
In sequences of actions, we shall show FLUSH LOG explicitly.
   <div class="newtheorem">
<!--l. 4397--><p class="noindent" ><span class="head">
<a 
 id="x1-94005r5"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 10.5.</span>  </span>Let&#8217;s repeat the example with all this rules:
   <div class="tabular"> <table id="TBL-41" class="tabular" 
 
><colgroup id="TBL-41-1g"><col 
id="TBL-41-1"></colgroup><colgroup id="TBL-41-2g"><col 
id="TBL-41-2"></colgroup><colgroup id="TBL-41-3g"><col 
id="TBL-41-3"></colgroup><colgroup id="TBL-41-4g"><col 
id="TBL-41-4"></colgroup><colgroup id="TBL-41-5g"><col 
id="TBL-41-5"></colgroup><colgroup id="TBL-41-6g"><col 
id="TBL-41-6"></colgroup><colgroup id="TBL-41-7g"><col 
id="TBL-41-7"></colgroup><colgroup id="TBL-41-8g"><col 
id="TBL-41-8"></colgroup><colgroup id="TBL-41-9g"><col 
id="TBL-41-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-1"  
class="td11"> Step  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-2"  
class="td11">   Action     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-3"  
class="td11">  t   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-4"  
class="td11"> MemA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-5"  
class="td11"> MemB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-6"  
class="td11"> DiskA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-7"  
class="td11"> DiskB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-8"  
class="td11">   MemLog     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-9"  
class="td11">           DiskLog                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-1"  
class="td11">   1    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-8"  
class="td11">  &#x003C;Start T&#x003E;    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-1"  
class="td11">   2    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-2"  
class="td11">  <span 
class="cmmi-10">Read</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">A,t</span><span 
class="cmr-10">)   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-1"  
class="td11">   3    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-1"  
class="td11">   4    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary301x.png" alt="(A,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-8"  
class="td11">   &#x003C;T,A,8&#x003E;     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-1"  
class="td11">   5    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-2"  
class="td11">  <span 
class="cmmi-10">Read</span><img 
src="summary302x.png" alt="(B,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-1"  
class="td11">   6    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-1"  
class="td11">   7    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary303x.png" alt="(B, t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-8"  
class="td11">   &#x003C;T,B,8&#x003E;     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-1"  
class="td11">   8    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-2"  
class="td11">  <span 
class="cmmi-10">FlushLog   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-9"  
class="td11"> &#x003C;Start T&#x003E;;&#x003C;T,A,8&#x003E;;&#x003C;T,B,8&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-1"  
class="td11">   9    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary304x.png" alt="(A )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-1"  
class="td11">  10    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary305x.png" alt="(B )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-7"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-1"  
class="td11">  11    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-8"  
class="td11"> &#x003C;Commit T&#x003E;  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-9"  
class="td11">                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-1"  
class="td11">  12    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-2"  
class="td11">  <span 
class="cmmi-10">FlushLog   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-9"  
class="td11">        &#x003C;Commit T&#x003E;             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-14-"><td  style="white-space:nowrap; text-align:center;" id="TBL-41-14-1"  
class="td11">       </td> </tr></table></div>
<!--l. 4535--><p class="indent" >   In this case, at any point in the process, if there is a failure, we would be able to rollback to a previous consistent
state using the log written in disk.
   </div>
<!--l. 4538--><p class="indent" >
When an error ocurrs, there is a procedure to follow, which is detailed in Algorithm <a 
href="#x1-94016r6">6<!--tex4ht:ref: alg:Undo-logging:-recovery --></a>. Note that if a failure occurs
during recovery, nothing goes wrong, because the recovery procedure would start over again when the system is
switched on and the rollback operations would proceed in the same manner.
                                                                                            
                                                                                            
<!--l. 4545--><p class="indent" >   <a 
 id="x1-94016r6"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 4546-->
<div class="lstlisting" id="listing-31"><span class="label"><a 
 id="x1-94006r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">Let</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">set</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">of</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">transaction</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">with</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">start</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">but</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">no</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94007r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">commit</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">not</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">abort</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94008r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94009r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">v</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">reverse</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">order</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94010r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94011r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">write</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">v</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94012r7"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">output</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94013r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94014r9"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-94015r10"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">write</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">abort</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">to</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span></span></div>
 <div class="caption" 
><span class="id">Algorithm 6: </span><span  
class="content">Undo logging: recovery rules</span></div><!--tex4ht:label?: x1-94016r6 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
   <h5 class="subsubsectionHead"><span class="titlemark">10.2.2   </span> <a 
 id="x1-9500010.2.2"></a>Redo logging</h5>
<!--l. 4565--><p class="noindent" >Undo logging has a potential problem that we cannot commit a transaction without first writing all its changed data to
disk. Sometimes, we can save disk I/O &#8217;s if we let changes to the database reside only in main memory for a while. As
long as there is a log to fix things up in the event of a crash, it is safe to do so. The requirement for immediate backup
of database elements to disk can be avoided if we use a logging mechanism called redo logging. The principal differences
between redo and undo logging are:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-95002x1">
     <!--l. 4574--><p class="noindent" >While undo logging cancels the effect of incomplete transactions and ignores committed ones during
     recovery,  redo  logging  ignores  incomplete  transactions  and  repeats  the  changes  made  by  committed
     transactions.
     </li>
<li 
  class="enumerate" id="x1-95004x2">
     <!--l. 4577--><p class="noindent" >While undo logging requires us to write changed database elements to disk before the COMMIT log record
     reaches disk, redo logging requires that the COMMIT record appear on disk before any changed values
     reach disk.
     </li>
<li 
  class="enumerate" id="x1-95006x3">
     <!--l. 4581--><p class="noindent" >While the old values of changed database elements are exactly what we need to recover when the undo
     rules U1 and U2 are followed, to recover using redo logging, we need the new values instead.</li></ol>
<!--l. 4585--><p class="noindent" >In redo logging the meaning of a log record &#x003C;T, X , v&#x003E; is &#8220;<span 
class="ecti-1000">transaction T wrote new value v for database element X</span>&#8221;. There
is no indication of the old value of X in this record. Every time a transaction T modifies a database element X , a
record of the form &#x003C; T ,X ,v&#x003E; must be written to the log.
<!--l. 4591--><p class="indent" >   For redo logging, the order in which data and log entries reach disk can be described by a single &#8220;redo rule,&#8221; called
the <span 
class="ecbx-1000">write-ahead logging rule</span>.
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-95007x10.2.2">
     <!--l. 4595--><p class="noindent" >Before modifying any database element X on disk, it is necessary that all log records pertaining to this
     modification of X , including both the update record &#x003C; T ,X ,v&#x003E; and the &#x003C;C0MMIT T&#x003E; record, must
     appear on disk.</li></ol>
<div class="newtheorem">
<!--l. 4600--><p class="noindent" ><span class="head">
<a 
 id="x1-95008r6"></a>
<span 
class="ecbx-1000">Example 10.6.</span>  </span>Let&#8217;s repeat the same example with this new logic.
   <div class="tabular"> <table id="TBL-42" class="tabular" 
 
><colgroup id="TBL-42-1g"><col 
id="TBL-42-1"></colgroup><colgroup id="TBL-42-2g"><col 
id="TBL-42-2"></colgroup><colgroup id="TBL-42-3g"><col 
id="TBL-42-3"></colgroup><colgroup id="TBL-42-4g"><col 
id="TBL-42-4"></colgroup><colgroup id="TBL-42-5g"><col 
id="TBL-42-5"></colgroup><colgroup id="TBL-42-6g"><col 
id="TBL-42-6"></colgroup><colgroup id="TBL-42-7g"><col 
id="TBL-42-7"></colgroup><colgroup id="TBL-42-8g"><col 
id="TBL-42-8"></colgroup><colgroup id="TBL-42-9g"><col 
id="TBL-42-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-1"  
class="td11"> Step  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-2"  
class="td11">   Action     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-3"  
class="td11">  t   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-4"  
class="td11"> MemA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-5"  
class="td11"> MemB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-6"  
class="td11"> DiskA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-7"  
class="td11"> DiskB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-8"  
class="td11">   MemLog     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-1-9"  
class="td11">                  DiskLog                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-1"  
class="td11">   1    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-8"  
class="td11">  &#x003C;Start T&#x003E;    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-2-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-1"  
class="td11">   2    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-2"  
class="td11">  <span 
class="cmmi-10">Read</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">A,t</span><span 
class="cmr-10">)   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-3-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-1"  
class="td11">   3    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-4-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-1"  
class="td11">   4    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary306x.png" alt="(A,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-8"  
class="td11">   &#x003C;T,A,16&#x003E;    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-5-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-1"  
class="td11">   5    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-2"  
class="td11">  <span 
class="cmmi-10">Read</span><img 
src="summary307x.png" alt="(B,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-6-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-1"  
class="td11">   6    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-7-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-1"  
class="td11">   7    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary308x.png" alt="(B, t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-8"  
class="td11">   &#x003C;T,B,16&#x003E;    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-8-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-1"  
class="td11">   8    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-8"  
class="td11"> &#x003C;Commit T&#x003E;  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-9-9"  
class="td11">                                          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-1"  
class="td11"> 9 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-6"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-7"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-8"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-42-10-9"  
class="td11"> &#x003C;Start T&#x003E;;&#x003C;T,A,16&#x003E;;&#x003C;T,B,16&#x003E;;&#x003C;Commit T&#x003E;</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-1"  
class="td11">  10    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary309x.png" alt="(A )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-11-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-1"  
class="td11">  11    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary310x.png" alt="(B )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-7"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-42-12-9"  
class="td11">                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-42-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-42-13-1"  
class="td11">       </td> </tr></table></div>
                                                                                            
                                                                                            
</div>
<!--l. 4727--><p class="indent" >
The procedure to recover from a failure is different from that of undo logging. In undo logging, we discard uncommited
changes, because we are unsure if they are done in the database. In redo logging, we proceed by doing again those
changes that are commited, because these are now those that we are unsure about, while uncommitted changes we
know for sure that have not been made. The recovery rules for redo logging are illustrated in Algorithm
<a 
href="#x1-95019r7">7<!--tex4ht:ref: alg:Redo-logging:-recovery --></a>.
                                                                                            
                                                                                            
<!--l. 4736--><p class="noindent" ><a 
 id="x1-95019r7"></a><hr class="float"><div class="float" 
>
                                                                                            
                                                                                            
<!--l. 4737-->
<div class="lstlisting" id="listing-32"><span class="label"><a 
 id="x1-95009r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">Let</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">set</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">of</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">transaction</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">with</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">start</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">but</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">no</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95010r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">commit</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">not</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">end</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95011r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95012r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">v</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">forward</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">order</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95013r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">if</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">then</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95014r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">write</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">v</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95015r7"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">output</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">X</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95016r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95017r9"></a></span><span style="color:#000000"><span 
class="ectt-1000">for</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">each</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">in</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">S</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">do</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-95018r10"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">write</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">Ti</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">end</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003E;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">to</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">log</span></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span></span></div>
 <div class="caption" 
><span class="id">Algorithm 7: </span><span  
class="content">Redo logging: recovery rules</span></div><!--tex4ht:label?: x1-95019r7 -->
                                                                                            
                                                                                            
   </div><hr class="endfloat" />
   <h5 class="likesubsubsectionHead"><a 
 id="x1-9600010.2.2"></a>Combining &#x003C;Ti,end&#x003E; records</h5>
<!--l. 4756--><p class="noindent" >There exist objects that are accessed often, which are usually called <span 
class="ecbx-1000">hot objects</span>. One idea about this object is that as
they are accessed very often, they would require lots of I/O operations and, many times, updated values of these objects
would not even be needed to have been on disk, so we can try to delay writing them to disk as long as we can
work with their values in memory. This way, we can just write their latest value and perform less I/O
operations.
   <div class="newtheorem">
<!--l. 4763--><p class="noindent" ><span class="head">
<a 
 id="x1-96001r7"></a>
<span 
class="ecbx-1000">Example 10.7.</span>  </span>Imagine we have four transactions:
<!--l. 4766--><p class="indent" >   <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub>  <span 
class="cmr-10">: </span><span 
class="cmmi-10">..update</span><span 
class="cmmi-10">&#x00A0;X..</span>,<span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub>  <span 
class="cmr-10">: </span><span 
class="cmmi-10">..update</span><span 
class="cmmi-10">&#x00A0;X..</span>,<span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">3</span></sub>  <span 
class="cmr-10">: </span><span 
class="cmmi-10">..update</span><span 
class="cmmi-10">&#x00A0;X..</span>,<span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">4</span></sub>  <span 
class="cmr-10">: </span><span 
class="cmmi-10">..update</span><span 
class="cmmi-10">&#x00A0;X.. </span>which can be executed with the
following set of actions:
<!--l. 4769--><p class="indent" >
   <div class="math-display" >
<img 
src="summary311x.png" alt="W  rite(X)
Output(X )
W  rite(X)
Output(X )
W  rite(X)
Output(X )
W  rite(X)
Output(X )
" class="math-display" ></div>
<!--l. 4781--><p class="indent" >   And this way we would be updating <span 
class="cmmi-10">X </span>unnecessarily. A better way to handle this is:
<!--l. 4784--><p class="indent" >
   <div class="math-display" >
<img 
src="summary312x.png" alt="   W  rite(X)
   Ou-tp-ut-(X--)
   -W  rite(X)
   Ou-tp-ut-(X--)
   -W  rite(X)
   Ou-tp-ut-(X--)
   -W  rite(X)
   Output(X )
combined &#x003C; end &#x003E;
" class="math-display" ></div>
                                                                                            
                                                                                            
   </div>
<!--l. 4797--><p class="indent" >
Nonetheless, there is an even better way to tackle this problem: <span 
class="ecbx-1000">checkpointing</span>.
<!--l. 4800--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">10.2.3   </span> <a 
 id="x1-9700010.2.3"></a>Checkpointing with undo logging</h5>
<!--l. 4802--><p class="noindent" >As we observed, recovery requires that the entire log be examined, in principle. When logging follows the undo style,
once a transaction has its COMMIT log record written to disk, the log records of that transaction are no longer needed
during recovery. We might imagine that we could delete the log prior to a COMMIT, but sometimes we cannot. The
reason is that often many transactions execute at once. If we truncated the log after one transaction committed, log
records pertaining to some other active transaction T might be lost and could not be used to undo T if recovery were
necessary. The simplest way to untangle potential problems is to checkpoint the log periodically. In a simple checkpoint,
we:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-97002x1">
     <!--l. 4814--><p class="noindent" >Stop accepting new transactions.
     </li>
<li 
  class="enumerate" id="x1-97004x2">
     <!--l. 4815--><p class="noindent" >Wait until all currently active transactions commit or abort and have written a COMMIT or ABORT
     record on the log.
     </li>
<li 
  class="enumerate" id="x1-97006x3">
     <!--l. 4817--><p class="noindent" >Flush the log to disk.
     </li>
<li 
  class="enumerate" id="x1-97008x4">
     <!--l. 4818--><p class="noindent" >Write a log record &#x003C;CKPT&#x003E;, and flush the log again.
     </li>
<li 
  class="enumerate" id="x1-97010x5">
     <!--l. 4819--><p class="noindent" >Resume accepting transactions.</li></ol>
<div class="newtheorem">
<!--l. 4821--><p class="noindent" ><span class="head">
<a 
 id="x1-97011r8"></a>
<span 
class="ecbx-1000">Example 10.8.</span>  </span>An undo log with checkpointing:
<!--l. 4824--><p class="indent" >
   <div class="math-display" >
<img 
src="summary313x.png" alt=" &#x003C; Start T1 &#x003E;
  &#x003C; T1,A,5 &#x003E;
 &#x003C; Start T2 &#x003E;
 &#x003C; T2,B,10 &#x003E;
  - - - - - -
 &#x003C; T2,C,15 &#x003E;
 &#x003C; T1,D, 20 &#x003E;
&#x003C; Commit  T1 &#x003E;
&#x003C; Commit  T2 &#x003E;
  &#x003C; CKP  T &#x003E;
 &#x003C; Start T3 &#x003E;
 &#x003C; T3,E,25 &#x003E;
      ...
" class="math-display" ></div>
<!--l. 4842--><p class="indent" >   In the dotted line, a checkpoint was launched, so no more transactions are accepted to execute until <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> and
<span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> finish. When both transactions commit, we can now write the checkpoint and accept new transactions, such
as <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">3</span></sub>.
</div>
<!--l. 4846--><p class="indent" >
<!--l. 4848--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">10.2.4   </span> <a 
 id="x1-9800010.2.4"></a>Checkpointing with redo logging</h5>
<!--l. 4850--><p class="noindent" >The steps to perform a checkpoint of a redo log are as follows:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-98002x1">
     <!--l. 4852--><p class="noindent" >Write a log record &#x003C;START CKPT (Ti,... ,Tk)&#x003E;, where Ti,... ,Tk are all the active (uncommitted)
     transactions, and flush the log.
     </li>
<li 
  class="enumerate" id="x1-98004x2">
     <!--l. 4854--><p class="noindent" >Write to disk all database elements that were written to buffers but not yet to disk by transactions that
     had already committed when the START CKPT record was written to the log.
     </li>
<li 
  class="enumerate" id="x1-98006x3">
     <!--l. 4857--><p class="noindent" >Write an &#x003C;END CKPT&#x003E; record to the log and flush the log.</li></ol>
<div class="newtheorem">
<!--l. 4859--><p class="noindent" ><span class="head">
<a 
 id="x1-98007r9"></a>
<span 
class="ecbx-1000">Example 10.9.</span>  </span>A redo log with checkpointing:
<!--l. 4862--><p class="indent" >   When we start the checkpoint, only T2 is active, but the value of A written by T1 may have reached disk.
If not, then we must copy A to disk before the checkpoint can end.
<!--l. 4866--><p class="indent" >
                                                                                            
                                                                                            
   <div class="math-display" >
<img 
src="summary314x.png" alt="    &#x003C; Start T1 &#x003E;
     &#x003C; T1,A,5 &#x003E;
    &#x003C; Start T2 &#x003E;
   &#x003C; Commit  T1 &#x003E;
    &#x003C; T2,B,10 &#x003E;
&#x003C; Start CKP T (T2) &#x003E;
    &#x003C; T2,C,15 &#x003E;
    &#x003C; Start T3 &#x003E;
    &#x003C; T3,D, 20 &#x003E;
   &#x003C; End CKP  T &#x003E;
   &#x003C; Commit  T2 &#x003E;
   &#x003C; Commit  T3 &#x003E;
" class="math-display" ></div>
</div>
<!--l. 4882--><p class="indent" >
<!--l. 4884--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">10.2.5   </span> <a 
 id="x1-9900010.2.5"></a>Undo/Redo logging</h5>
<!--l. 4886--><p class="noindent" >We have seen two different approaches to logging, differentiated by whether the log holds old values or new values when
a database element is updated. Each has certain drawbacks:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 4890--><p class="noindent" >Undo logging requires that data be written to disk immediately after a transaction finishes, perhaps
     increasing the number of disk I/O operations that need to be performed.
     </li>
     <li class="itemize">
     <!--l. 4893--><p class="noindent" >On the other hand, redo logging requires us to keep all modified blocks in buffers until the transaction
     commits and the log records have been flushed, perhaps increasing the average number of buffers required
     by transactions.
     </li>
     <li class="itemize">
     <!--l. 4897--><p class="noindent" >Both  undo  and  redo  logs  may  put  contradictory  requirements  on  how  buffers  are  handled  during  a
     checkpoint, unless the database elements are complete blocks or sets of blocks. For instance, if a buffer
     contains one database element A that was changed by a committed transaction and another database
     element B that was changed in the same buffer by a transaction that has not yet had its COMMIT record
     written to disk, then we are required to copy the buffer to disk because of A but also forbidden to do so,
     because rule R1 applies to B.</li></ul>
<!--l. 4906--><p class="noindent" >An <span 
class="ecbx-1000">undo/redo log </span>has the same sorts of log records as the other kinds of log, with one exception. The update log record
that we write when a database element changes value has four components. Record &#x003C; T ,X ,v,w &#x003E; means
that transaction T changed the value of database element X; its former value was v, and its new value
is w. The constraints that an undo/redo logging system must follow are summarized by the following
rule:
                                                                                            
                                                                                            
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-99001x10.2.5">
     <!--l. 4914--><p class="noindent" >Before modifying any database element X on disk because of changes made by some transaction T, it is
     necessary that the update record &#x003C;T, X , v, w&#x003E; appear on disk.</li></ol>
<div class="newtheorem">
<!--l. 4918--><p class="noindent" ><span class="head">
<a 
 id="x1-99002r10"></a>
<span 
class="ecbx-1000">Example 10.10.</span>  </span>An undo/redo log. Let&#8217;s redo our typical example:
   <div class="tabular"> <table id="TBL-43" class="tabular" 
 
><colgroup id="TBL-43-1g"><col 
id="TBL-43-1"></colgroup><colgroup id="TBL-43-2g"><col 
id="TBL-43-2"></colgroup><colgroup id="TBL-43-3g"><col 
id="TBL-43-3"></colgroup><colgroup id="TBL-43-4g"><col 
id="TBL-43-4"></colgroup><colgroup id="TBL-43-5g"><col 
id="TBL-43-5"></colgroup><colgroup id="TBL-43-6g"><col 
id="TBL-43-6"></colgroup><colgroup id="TBL-43-7g"><col 
id="TBL-43-7"></colgroup><colgroup id="TBL-43-8g"><col 
id="TBL-43-8"></colgroup><colgroup id="TBL-43-9g"><col 
id="TBL-43-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-1"  
class="td11"> Step  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-2"  
class="td11">   Action     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-3"  
class="td11">  t   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-4"  
class="td11"> MemA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-5"  
class="td11"> MemB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-6"  
class="td11"> DiskA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-7"  
class="td11"> DiskB  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-8"  
class="td11">   MemLog     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-1-9"  
class="td11">             DiskLog                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-1"  
class="td11">   1    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-8"  
class="td11">  &#x003C;Start T&#x003E;    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-2-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-1"  
class="td11">   2    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-2"  
class="td11">  <span 
class="cmmi-10">Read</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">A,t</span><span 
class="cmr-10">)   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-3-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-1"  
class="td11">   3    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-4"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-4-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-1"  
class="td11">   4    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary315x.png" alt="(A,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-8"  
class="td11">  &#x003C;T,A,8,16&#x003E;   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-5-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-1"  
class="td11">   5    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-2"  
class="td11">  <span 
class="cmmi-10">Read</span><img 
src="summary316x.png" alt="(B,t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-6-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-1"  
class="td11">   6    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-2"  
class="td11">  <span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">t </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-5"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-7-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-1"  
class="td11">   7    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-2"  
class="td11"> <span 
class="cmmi-10">Write</span><img 
src="summary317x.png" alt="(B, t)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-6"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-8"  
class="td11">  &#x003C;T,B,8,16&#x003E;   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-8-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-1"  
class="td11">   8    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-2"  
class="td11">  <span 
class="cmmi-10">FlushLog   </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-9-9"  
class="td11"> &#x003C;Start T&#x003E;;&#x003C;T,A,8,16&#x003E;;&#x003C;T,B,8,16&#x003E;  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-1"  
class="td11">   9    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary318x.png" alt="(A )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-7"  
class="td11">   8     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-10-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-1"  
class="td11">  10    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-2"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-3"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-4"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-5"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-6"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-7"  
class="td11">       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-8"  
class="td11"> &#x003C;Commit T&#x003E;  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-11-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-1"  
class="td11">  11    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-2"  
class="td11">  <span 
class="cmmi-10">Output</span><img 
src="summary319x.png" alt="(B )"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-3"  
class="td11"> 16  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-4"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-5"  
class="td11">   16     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-6"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-7"  
class="td11">   16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-8"  
class="td11">              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-43-12-9"  
class="td11">                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-43-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-43-13-1"  
class="td11">       </td> </tr></table></div>
<!--l. 5046--><p class="indent" >   Note that, in this case, the last three steps could&#8217;ve appeared in any order.
</div>
<!--l. 5048--><p class="indent" >
The undo/redo recovery policy is:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-99004x1">
     <!--l. 5051--><p class="noindent" >Redo all the committed transactions in the order earlierst-first.
     </li>
<li 
  class="enumerate" id="x1-99006x2">
     <!--l. 5052--><p class="noindent" >Undo all the uncommitted transactions in the order latest-first.</li></ol>
<!--l. 5055--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">11   </span> <a 
 id="x1-10000011"></a>Concurrency control</h3>
<!--l. 5057--><p class="noindent" >Interactions among concurrently executing transactions can cause the database state to become inconsistent, even when
the transactions individually preserve correctness of the state, and there is no system failure. Thus, the timing of
individual steps of different transactions needs to be regulated in some manner. This regulation is the job of the
<span 
class="ecbx-1000">scheduler </span>component of the DBMS, and the general process of assuring that transactions preserve consistency when
executing simultaneously is called <span 
class="ecbx-1000">concurrency control</span>.
<!--l. 5066--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">11.1   </span> <a 
 id="x1-10100011.1"></a>Schedules: serial, serializable and conflict-serializable</h4>
   <div class="tcolorbox tcolorbox" id="tcolobox-17">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5069--><p class="noindent" ><span class="head">
<a 
 id="x1-101001r1"></a>
<span 
class="ecbx-1000">Definition 11.1.</span>   </span>A <span 
class="ecbx-1000">schedule </span>is a sequence of the important actions taken by one or more transactions.
</div>
<!--l. 5072--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 5075--><p class="noindent" ><span class="head">
<a 
 id="x1-101002r1"></a>
<span 
class="ecbx-1000">Example 11.1.</span>  </span>Imagine we have the constraint <span 
class="cmmi-10">A </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">B </span>and the following two transactions:
<table 
class="align-star">
                      <tr><td 
class="align-odd"><span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmr-10">:</span></td>                      <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary320x.png" alt="(A)"  class="left" align="middle"></td>                         <td 
class="align-odd"><span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmr-10">:</span></td>                      <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary321x.png" alt="          (A)"  class="left" align="middle"></td>                        <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label">
                      </td></tr><tr><td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">A </span><span 
class="cmr-10">+ 100</span></td>                      <td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">A </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label">
                      </td></tr><tr><td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary322x.png" alt="(A )"  class="left" align="middle"></td>                         <td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary323x.png" alt="           (A)"  class="left" align="middle"></td>                       <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label">
                      </td></tr><tr><td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary324x.png" alt="(B)"  class="left" align="middle"></td>                         <td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Read</span><img 
src="summary325x.png" alt="          (B)"  class="left" align="middle"></td>                       <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label">
                      </td></tr><tr><td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">B </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">B </span><span 
class="cmr-10">+ 100</span></td>                      <td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">B </span><span 
class="cmsy-10">&#x2190; </span><span 
class="cmmi-10">B </span><span 
class="cmsy-10">&#x00D7; </span><span 
class="cmr-10">2</span></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label">
                      </td></tr><tr><td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary326x.png" alt="(B )"  class="left" align="middle"></td>                         <td 
class="align-odd"></td>                         <td 
class="align-even"><span 
class="cmmi-10">Write</span><img 
src="summary327x.png" alt="           (B)"  class="left" align="middle"></td>                       <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td>                      <td 
class="align-label"></td></tr></table>
<!--l. 5085--><p class="indent" >   Note how each of the transactions individually preserves the consistency of the database. Nonetheless, there exist
some schedules that can make things go wrong!
<!--l. 5089--><p class="indent" >   <span 
class="ecbx-1000">Schedule A</span>:
   <div class="tabular"> <table id="TBL-44" class="tabular" 
 
><colgroup id="TBL-44-1g"><col 
id="TBL-44-1"></colgroup><colgroup id="TBL-44-2g"><col 
id="TBL-44-2"></colgroup><colgroup id="TBL-44-3g"><col 
id="TBL-44-3"></colgroup><colgroup id="TBL-44-4g"><col 
id="TBL-44-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-1-1"  
class="td11">        T1             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-1-2"  
class="td11">        T2            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-1-3"  
class="td11">  A   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-1-4"  
class="td11">  B   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-2-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-44-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-44-2-3"  
class="td11"> 25 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-44-2-4"  
class="td11"> 25</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-3-1"  
class="td11"> Read(A); A&#x003C;-A+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-3-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-3-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-3-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-4-1"  
class="td11">      Write(A);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-4-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-4-3"  
class="td11"> 125  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-4-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-5-1"  
class="td11"> Read(B); B&#x003C;-B+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-5-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-5-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-5-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-6-1"  
class="td11">      Write(B);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-6-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-6-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-6-4"  
class="td11"> 125  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-7-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-7-2"  
class="td11"> Read(B); A&#x003C;-A*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-7-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-7-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-8-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-8-2"  
class="td11">     Write(A);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-8-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-8-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-9-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-9-2"  
class="td11"> Read(B); B&#x003C;-B*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-9-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-9-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-10-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-10-2"  
class="td11">     Write(B);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-10-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-10-4"  
class="td11"> 250  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-11-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-11-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-11-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-44-11-4"  
class="td11"> 250  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-44-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-44-12-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 5151--><p class="indent" >   This schedule poses no problems.
                                                                                            
                                                                                            
<!--l. 5153--><p class="indent" >   <span 
class="ecbx-1000">Schedule B</span>:
   <div class="tabular"> <table id="TBL-45" class="tabular" 
 
><colgroup id="TBL-45-1g"><col 
id="TBL-45-1"></colgroup><colgroup id="TBL-45-2g"><col 
id="TBL-45-2"></colgroup><colgroup id="TBL-45-3g"><col 
id="TBL-45-3"></colgroup><colgroup id="TBL-45-4g"><col 
id="TBL-45-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-1-1"  
class="td11">        T1             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-1-2"  
class="td11">        T2            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-1-3"  
class="td11">  A   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-1-4"  
class="td11">  B   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-2-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-45-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-45-2-3"  
class="td11"> 25 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-45-2-4"  
class="td11"> 25</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-3-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-3-2"  
class="td11"> Read(A); A&#x003C;-A*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-3-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-3-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-4-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-4-2"  
class="td11">     Write(A);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-4-3"  
class="td11">  50   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-4-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-5-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-5-2"  
class="td11"> Read(B); B&#x003C;-B*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-5-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-5-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-6-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-6-2"  
class="td11">     Write(B);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-6-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-6-4"  
class="td11">  50   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-7-1"  
class="td11"> Read(A); A&#x003C;-A+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-7-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-7-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-7-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-8-1"  
class="td11">      Write(A);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-8-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-8-3"  
class="td11"> 150  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-8-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-9-1"  
class="td11"> Read(B); B&#x003C;-B+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-9-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-9-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-9-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-10-1"  
class="td11">      Write(B);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-10-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-10-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-10-4"  
class="td11"> 150  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-11-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-11-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-11-3"  
class="td11"> 150  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-45-11-4"  
class="td11"> 150  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-45-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-45-12-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 5215--><p class="indent" >   This schedule poses no problems. Note, nonetheless, how the different orderings affect the final result.
<!--l. 5218--><p class="indent" >   <span 
class="ecbx-1000">Schedule C</span>:
   <div class="tabular"> <table id="TBL-46" class="tabular" 
 
><colgroup id="TBL-46-1g"><col 
id="TBL-46-1"></colgroup><colgroup id="TBL-46-2g"><col 
id="TBL-46-2"></colgroup><colgroup id="TBL-46-3g"><col 
id="TBL-46-3"></colgroup><colgroup id="TBL-46-4g"><col 
id="TBL-46-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-1-1"  
class="td11">        T1             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-1-2"  
class="td11">        T2            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-1-3"  
class="td11">  A   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-1-4"  
class="td11">  B   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-2-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-46-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-46-2-3"  
class="td11"> 25 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-46-2-4"  
class="td11"> 25</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-3-1"  
class="td11"> Read(A); A&#x003C;-A+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-3-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-3-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-3-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-4-1"  
class="td11">      Write(A);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-4-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-4-3"  
class="td11"> 125  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-4-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-5-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-5-2"  
class="td11"> Read(A); A&#x003C;-A*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-5-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-5-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-6-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-6-2"  
class="td11">     Write(A);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-6-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-6-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-7-1"  
class="td11"> Read(B); B&#x003C;-B+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-7-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-7-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-7-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-8-1"  
class="td11">      Write(B);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-8-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-8-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-8-4"  
class="td11"> 125  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-9-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-9-2"  
class="td11"> Read(B); B&#x003C;-B*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-9-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-9-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-10-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-10-2"  
class="td11">     Write(B);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-10-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-10-4"  
class="td11"> 250  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-11-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-11-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-11-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-46-11-4"  
class="td11"> 250  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-46-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-46-12-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 5280--><p class="indent" >   This schedule poses no problems.
<!--l. 5282--><p class="indent" >   <span 
class="ecbx-1000">Schedule D</span>:
   <div class="tabular"> <table id="TBL-47" class="tabular" 
 
><colgroup id="TBL-47-1g"><col 
id="TBL-47-1"></colgroup><colgroup id="TBL-47-2g"><col 
id="TBL-47-2"></colgroup><colgroup id="TBL-47-3g"><col 
id="TBL-47-3"></colgroup><colgroup id="TBL-47-4g"><col 
id="TBL-47-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-1-1"  
class="td11">        T1             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-1-2"  
class="td11">        T2            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-1-3"  
class="td11">  A   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-1-4"  
class="td11">  B   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-2-1"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-47-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-47-2-3"  
class="td11"> 25 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-47-2-4"  
class="td11"> 25</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-3-1"  
class="td11"> Read(A); A&#x003C;-A+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-3-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-3-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-3-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-4-1"  
class="td11">      Write(A);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-4-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-4-3"  
class="td11"> 125  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-4-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-5-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-5-2"  
class="td11"> Read(A); A&#x003C;-A*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-5-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-5-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-6-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-6-2"  
class="td11">     Write(A);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-6-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-6-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-7-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-7-2"  
class="td11"> Read(B); B&#x003C;-B*2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-7-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-7-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-8-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-8-2"  
class="td11">     Write(B);       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-8-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-8-4"  
class="td11">  50   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-9-1"  
class="td11"> Read(B); B&#x003C;-B+100  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-9-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-9-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-9-4"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-10-1"  
class="td11">      Write(B);         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-10-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-10-3"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-10-4"  
class="td11"> 150  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-11-1"  
class="td11">                    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-11-2"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-11-3"  
class="td11"> 250  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-47-11-4"  
class="td11"> 150  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-47-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-47-12-1"  
class="td11"> </td> </tr></table>
</div>
<!--l. 5344--><p class="indent" >   But this schedule is problematic! The final state of the database is inconsistent.
   </div>
<!--l. 5346--><p class="indent" >
We want schedules that are &#8217;<span 
class="ecti-1000">good</span>&#8217;, in the sense that they ensure the final state of the database to be consistent,
independent of the transactions&#8217; semantics and the initial (consistent) state of the database.
<!--l. 5352--><p class="noindent" >For this, we should only look at the order of read and writes.
<!--l. 5354--><p class="indent" >   A schedule can be represented as its sequence of actions, where <span 
class="cmmi-10">r</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary328x.png" alt="(X )"  class="left" align="middle"> means <span 
class="cmmi-10">X </span>is read in transaction <span 
class="cmmi-10">i </span>and <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary329x.png" alt="(X )"  class="left" align="middle">
means <span 
class="cmmi-10">X </span>is written in transaction <span 
class="cmmi-10">i</span>.
<!--l. 5358--><p class="indent" >   For example, schedule C can be represented as
   <div class="math-display" >
<img 
src="summary330x.png" alt="SC = r1(A)w1 (A )r2(A)w2 (A )r1(B)w1 (B )r2(B)w2 (B).
" class="math-display" ></div>
   <div class="tcolorbox tcolorbox" id="tcolobox-18">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5364--><p class="noindent" ><span class="head">
<a 
 id="x1-101003r2"></a>
<span 
class="ecbx-1000">Definition 11.2.</span>   </span>A schedule is <span 
class="ecbx-1000">serial </span>if its actions consist of all the actions of one transaction, then all
actions of another transaction, and so on.
</div>
<!--l. 5368--><p class="noindent" >
 
</div> 
</div>
<!--l. 5371--><p class="indent" >   For example, Schedules A and B are serial.
   <div class="newtheorem">
<!--l. 5372--><p class="noindent" ><span class="head">
<a 
 id="x1-101004r1"></a>
<span 
class="ecti-1000">Remark </span>11.1<span 
class="ecti-1000">.</span>  </span>Note that all serial schedules work: they leave a consistent database, because of the correctness
principle.
   </div>
<!--l. 5375--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-19">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5377--><p class="noindent" ><span class="head">
<a 
 id="x1-101005r3"></a>
<span 
class="ecbx-1000">Definition 11.3.</span>   </span>A schedule <span 
class="cmmi-10">S </span>is serializable if there is a serial schedule <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032; </span>such that for every initial
database state, the effects of <span 
class="cmmi-10">S </span>and <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032; </span>are the same.
</div>
<!--l. 5381--><p class="noindent" >
 
</div> 
</div>
<!--l. 5384--><p class="indent" >   For example, Schedule C is serializable, with <span 
class="cmmi-10">C</span><span 
class="cmsy-10">&#x2032; </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">A</span>, but schedule D is not serializable, because it leads to an
inconsistent state.
<!--l. 5387--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-10200011.1"></a>The transaction game</h5>
<!--l. 5389--><p class="noindent" >It is a way to visually check for serializability (only for simple schedules).
   <div class="newtheorem">
<!--l. 5391--><p class="noindent" ><span class="head">
<a 
 id="x1-102001r2"></a>
<span 
class="ecbx-1000">Example 11.2.</span>  </span>For example, Schedule C is:
   <div class="tabular"> <table id="TBL-48" class="tabular" 
 
><colgroup id="TBL-48-1g"><col 
id="TBL-48-1"></colgroup><colgroup id="TBL-48-2g"><col 
id="TBL-48-2"></colgroup><colgroup id="TBL-48-3g"><col 
id="TBL-48-3"></colgroup><colgroup id="TBL-48-4g"><col 
id="TBL-48-4"></colgroup><colgroup id="TBL-48-5g"><col 
id="TBL-48-5"></colgroup><colgroup id="TBL-48-6g"><col 
id="TBL-48-6"></colgroup><colgroup id="TBL-48-7g"><col 
id="TBL-48-7"></colgroup><colgroup id="TBL-48-8g"><col 
id="TBL-48-8"></colgroup><colgroup id="TBL-48-9g"><col 
id="TBL-48-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-48-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-4"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-5"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-1-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-48-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-6"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-7"  
class="td11"> w </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-2-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-48-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-1"  
class="td11"> T1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-4"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-5"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-6"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-7"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-48-3-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-48-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-1"  
class="td11"> T2 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-4"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-5"  
class="td11"> w </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-6"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-7"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-48-4-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-48-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-48-5-1"  
class="td11">     </td> </tr></table></div>
<!--l. 5438--><p class="indent" >   Here, we represents taken by each transaction and the affected variable, in the order of the schedule. Now, two steps
can be exchanged if they are next to one another and they can slide without colliding.
   <div class="tabular"> <table id="TBL-49" class="tabular" 
 
><colgroup id="TBL-49-1g"><col 
id="TBL-49-1"></colgroup><colgroup id="TBL-49-2g"><col 
id="TBL-49-2"></colgroup><colgroup id="TBL-49-3g"><col 
id="TBL-49-3"></colgroup><colgroup id="TBL-49-4g"><col 
id="TBL-49-4"></colgroup><colgroup id="TBL-49-5g"><col 
id="TBL-49-5"></colgroup><colgroup id="TBL-49-6g"><col 
id="TBL-49-6"></colgroup><colgroup id="TBL-49-7g"><col 
id="TBL-49-7"></colgroup><colgroup id="TBL-49-8g"><col 
id="TBL-49-8"></colgroup><colgroup id="TBL-49-9g"><col 
id="TBL-49-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-49-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-2"  
class="td11"> <span id="textcolor1">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-3"  
class="td11"> <span id="textcolor2">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-4"  
class="td11"> <span id="textcolor3">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-5"  
class="td11"> <span id="textcolor4">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-1-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-49-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-6"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-7"  
class="td11"> w </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-2-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-49-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-1"  
class="td11"> T1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-2"  
class="td11"> <span id="textcolor5">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-3"  
class="td11"> <span id="textcolor6">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-4"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-5"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-6"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-7"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-49-3-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-49-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-1"  
class="td11"> T2 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-4"  
class="td11"> <span id="textcolor7">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-5"  
class="td11"> <span id="textcolor8">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-6"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-7"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-49-4-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-49-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-49-5-1"  
class="td11">     </td> </tr></table></div>
                                                                                            
                                                                                            
<!--l. 5486--><p class="indent" >   Here, the red colored steps cannot be exchanged, because they collide in the first row.
   <div class="tabular"> <table id="TBL-50" class="tabular" 
 
><colgroup id="TBL-50-1g"><col 
id="TBL-50-1"></colgroup><colgroup id="TBL-50-2g"><col 
id="TBL-50-2"></colgroup><colgroup id="TBL-50-3g"><col 
id="TBL-50-3"></colgroup><colgroup id="TBL-50-4g"><col 
id="TBL-50-4"></colgroup><colgroup id="TBL-50-5g"><col 
id="TBL-50-5"></colgroup><colgroup id="TBL-50-6g"><col 
id="TBL-50-6"></colgroup><colgroup id="TBL-50-7g"><col 
id="TBL-50-7"></colgroup><colgroup id="TBL-50-8g"><col 
id="TBL-50-8"></colgroup><colgroup id="TBL-50-9g"><col 
id="TBL-50-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-50-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-4"  
class="td11"> <span id="textcolor9">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-5"  
class="td11"> <span id="textcolor10">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-1-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-50-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-6"  
class="td11"> <span id="textcolor11">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-7"  
class="td11"> <span id="textcolor12">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-2-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-50-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-1"  
class="td11"> T1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-4"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-5"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-6"  
class="td11"> <span id="textcolor13">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-7"  
class="td11"> <span id="textcolor14">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-50-3-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-50-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-1"  
class="td11"> T2 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-4"  
class="td11"> <span id="textcolor15">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-5"  
class="td11"> <span id="textcolor16">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-6"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-7"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-50-4-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-50-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-50-5-1"  
class="td11">     </td> </tr></table></div>
<!--l. 5533--><p class="indent" >   But now, the green colored steps can be exchanged, because they are next to each other and they do not collide if
we slide the columns:
   <div class="tabular"> <table id="TBL-51" class="tabular" 
 
><colgroup id="TBL-51-1g"><col 
id="TBL-51-1"></colgroup><colgroup id="TBL-51-2g"><col 
id="TBL-51-2"></colgroup><colgroup id="TBL-51-3g"><col 
id="TBL-51-3"></colgroup><colgroup id="TBL-51-4g"><col 
id="TBL-51-4"></colgroup><colgroup id="TBL-51-5g"><col 
id="TBL-51-5"></colgroup><colgroup id="TBL-51-6g"><col 
id="TBL-51-6"></colgroup><colgroup id="TBL-51-7g"><col 
id="TBL-51-7"></colgroup><colgroup id="TBL-51-8g"><col 
id="TBL-51-8"></colgroup><colgroup id="TBL-51-9g"><col 
id="TBL-51-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-51-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-4"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-5"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-6"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-7"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-1-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-51-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-4"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-5"  
class="td11"> w </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-6"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-7"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-2-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-51-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-1"  
class="td11"> T1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-2"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-3"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-4"  
class="td11"> r  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-5"  
class="td11"> w  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-51-3-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-51-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-1"  
class="td11"> T2 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-6"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-7"  
class="td11"> w </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-8"  
class="td11"> r </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-51-4-9"  
class="td11"> w</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-51-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-51-5-1"  
class="td11">     </td> </tr></table></div>
<!--l. 5580--><p class="indent" >   And this is schedule A!
   </div>
<!--l. 5581--><p class="indent" >
   <div class="newtheorem">
<!--l. 5583--><p class="noindent" ><span class="head">
<a 
 id="x1-102002r3"></a>
<span 
class="ecbx-1000">Example 11.3.</span>  </span>Now, for schedule D:
   <div class="tabular"> <table id="TBL-52" class="tabular" 
 
><colgroup id="TBL-52-1g"><col 
id="TBL-52-1"></colgroup><colgroup id="TBL-52-2g"><col 
id="TBL-52-2"></colgroup><colgroup id="TBL-52-3g"><col 
id="TBL-52-3"></colgroup><colgroup id="TBL-52-4g"><col 
id="TBL-52-4"></colgroup><colgroup id="TBL-52-5g"><col 
id="TBL-52-5"></colgroup><colgroup id="TBL-52-6g"><col 
id="TBL-52-6"></colgroup><colgroup id="TBL-52-7g"><col 
id="TBL-52-7"></colgroup><colgroup id="TBL-52-8g"><col 
id="TBL-52-8"></colgroup><colgroup id="TBL-52-9g"><col 
id="TBL-52-9"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-52-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-1"  
class="td11"> A  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-2"  
class="td11"> <span id="textcolor17">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-3"  
class="td11"> <span id="textcolor18">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-4"  
class="td11"> <span id="textcolor19">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-5"  
class="td11"> <span id="textcolor20">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-8"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-1-9"  
class="td11">    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-52-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-1"  
class="td11"> B </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-4"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-5"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-6"  
class="td11"> <span id="textcolor21">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-7"  
class="td11"> <span id="textcolor22">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-8"  
class="td11"> <span id="textcolor23">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-2-9"  
class="td11"> <span id="textcolor24">w</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-52-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-1"  
class="td11"> T1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-2"  
class="td11"> <span id="textcolor25">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-3"  
class="td11"> <span id="textcolor26">w</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-4"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-5"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-6"  
class="td11">   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-7"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-8"  
class="td11"> <span id="textcolor27">r</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-52-3-9"  
class="td11"> <span id="textcolor28">w</span>  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-52-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-1"  
class="td11"> T2 </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-2"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-3"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-4"  
class="td11"> <span id="textcolor29">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-5"  
class="td11"> <span id="textcolor30">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-6"  
class="td11"> <span id="textcolor31">r</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-7"  
class="td11"> <span id="textcolor32">w</span> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-8"  
class="td11"> </td> <td  style="white-space:nowrap; text-align:center;" id="TBL-52-4-9"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-52-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-52-5-1"  
class="td11">     </td> </tr></table></div>
<!--l. 5630--><p class="indent" >   Everything is red!
   </div>
<!--l. 5631--><p class="indent" >
Let&#8217;s continue the discussion to try to understand why D is different from C.
   <div class="tcolorbox tcolorbox" id="tcolobox-20">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5636--><p class="noindent" ><span class="head">
<a 
 id="x1-102003r4"></a>
<span 
class="ecbx-1000">Definition 11.4.</span>   </span>We define <span 
class="ecbx-1000">conflicting actions </span>as those that cannot be reordered in a schedule. These
are:
</div>
<!--l. 5639--><p class="noindent" >
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5641--><p class="noindent" >Obviously, actions made by the same transactions cannot be reordered.
        </li>
        <li class="itemize">
        <!--l. 5642--><p class="noindent" >But there are also actions from different transactions whose reordering would affect the result:
              <ul class="itemize2">
              <li class="itemize">
              <!--l. 5645--><p class="noindent" ><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary331x.png" alt="(A)"  class="left" align="middle"> and <span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary332x.png" alt="(A)"  class="left" align="middle"> cannot be reordered
              </li>
              <li class="itemize">
              <!--l. 5646--><p class="noindent" ><span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary333x.png" alt="(A )"  class="left" align="middle"> and <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary334x.png" alt="(A)"  class="left" align="middle"> cannot be reordered
              </li>
              <li class="itemize">
              <!--l. 5647--><p class="noindent" ><span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary335x.png" alt="(A )"  class="left" align="middle"> and <span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary336x.png" alt="(A )"  class="left" align="middle"> cannot be reordered</li></ul>
        </li></ul>
 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-21">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5653--><p class="noindent" ><span class="head">
<a 
 id="x1-102004r5"></a>
<span 
class="ecbx-1000">Definition 11.5.</span>   </span>A  schedule  is  <span 
class="ecbx-1000">conflict  serializable </span>if  it  can  be  serialized  without  violating  any
conflicting action. If <span 
class="cmmi-10">S </span>is conflict serializable to <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032;</span>, then <span 
class="cmmi-10">S </span>and <span 
class="cmmi-10">S</span><span 
class="cmsy-10">&#x2032; </span>are <span 
class="ecbx-1000">conflict equivalent</span>.
</div>
<!--l. 5657--><p class="noindent" >
 
</div> 
</div>
<!--l. 5660--><p class="indent" >   These definitions allow us to create a mathematical tool for determining &#8217;<span 
class="ecti-1000">good</span>&#8217; schedules, understanding that as a
conflict serializable schedule. This goal is achieved by a precedence graph:
   <div class="tcolorbox tcolorbox" id="tcolobox-22">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5665--><p class="noindent" ><span class="head">
<a 
 id="x1-102005r6"></a>
<span 
class="ecbx-1000">Definition 11.6.</span>   </span>A <span 
class="ecbx-1000">precedence graph </span>of a schedule <span 
class="cmmi-10">S</span>, <span 
class="cmmi-10">P</span><img 
src="summary337x.png" alt="(S)"  class="left" align="middle">, is graph <span 
class="cmmi-10">P</span><img 
src="summary338x.png" alt="(S)"  class="left" align="middle"> <span 
class="cmr-10">= </span><img 
src="summary339x.png" alt="(N, E)"  class="left" align="middle"> where:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5669--><p class="noindent" >The nodes, <span 
class="cmmi-10">N</span>, are the transactions in <span 
class="cmmi-10">S</span>.
        </li>
        <li class="itemize">
        <!--l. 5670--><p class="noindent" >The arcs are directed, and <img 
src="summary340x.png" alt="(Ti,Tj)"  class="left" align="middle"> <span 
class="cmsy-10">&#x2208; </span><span 
class="cmmi-10">E </span>whenever:
              <ul class="itemize2">
              <li class="itemize">
              <!--l. 5672--><p class="noindent" ><span 
class="cmmi-10">p</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary341x.png" alt="(A)"  class="left" align="middle"><span 
class="cmmi-10">,q</span><sub><span 
class="cmmi-7">j</span></sub><img 
src="summary342x.png" alt="(A)"  class="left" align="middle"> are actions in <span 
class="cmmi-10">S</span>
            </li>
            <li class="itemize">
            <!--l. 5673--><p class="noindent" ><span 
class="cmmi-10">p</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary343x.png" alt="(A)"  class="left" align="middle"> <span 
class="cmmi-10">&#x003C;</span> <sub><span 
class="cmmi-7">S</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">j</span></sub><img 
src="summary344x.png" alt="(A )"  class="left" align="middle">, i.e., <span 
class="cmmi-10">p</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary345x.png" alt="(A)"  class="left" align="middle"> precedes <span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">j</span></sub><img 
src="summary346x.png" alt="(A )"  class="left" align="middle">
              </li>
              <li class="itemize">
              <!--l. 5675--><p class="noindent" >at least one of <span 
class="cmmi-10">p</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,q</span><sub><span 
class="cmmi-7">j</span></sub> is a write</li></ul>
        </li></ul>
</div>
<!--l. 5678--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 5681--><p class="noindent" ><span class="head">
<a 
 id="x1-102006r4"></a>
<span 
class="ecbx-1000">Example 11.4.</span>  </span>Let&#8217;s compute <span 
class="cmmi-10">P</span><img 
src="summary347x.png" alt="(S)"  class="left" align="middle"> for
   <div class="math-display" >
<img 
src="summary348x.png" alt="S = w3 (A)w2 (C )r1(A)w1 (B)r1(C)w2 (A)r4(A)w4 (D)
" class="math-display" ></div>
<!--l. 5687--><p class="indent" >   <img 
src="36_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___em_Architecture_LectureNotes_source_pegado2.png" alt="PIC"  
>
   </div>
<!--l. 5688--><p class="indent" >
                                                                                            
                                                                                            
<!--l. 5690--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-10300011.1"></a>How to use precedence graphs to determine conflict-serializability?</h5>
<!--l. 5692--><p class="noindent" >To tell whether a schedule <span 
class="cmmi-10">S </span>is conflict-serializable, construct the precedence graph for <span 
class="cmmi-10">S </span>and ask if there are any cycles.
If so, then <span 
class="cmmi-10">S </span>is not conflict-serializable. But if the graph is acyclic, then <span 
class="cmmi-10">S </span>is conflict-serializable.
   <div class="newtheorem">
<!--l. 5696--><p class="noindent" ><span class="head">
<a 
 id="x1-103001r5"></a>
<span 
class="ecbx-1000">Example 11.5.</span>  </span>The schedule in Example <a 
href="#x1-102006r4">11.4<!--tex4ht:ref: ex:precedence-graph --></a> is not conflict serializable, because there is cycle between nodes
1 and 2.
   </div>
<!--l. 5699--><p class="indent" >
   <div class="newtheorem">
<!--l. 5701--><p class="noindent" ><span class="head">
<a 
 id="x1-103002r6"></a>
<span 
class="ecbx-1000">Example 11.6.</span>  </span>Is <span 
class="cmmi-10">S </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary349x.png" alt="(A)"  class="left" align="middle"><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary350x.png" alt="(A )"  class="left" align="middle"><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">3</span></sub><img 
src="summary351x.png" alt="(A)"  class="left" align="middle"><span 
class="cmmi-10">w</span><sub><span 
class="cmr-7">4</span></sub><img 
src="summary352x.png" alt="(A )"  class="left" align="middle"> conflict serializable?
<!--l. 5705--><p class="indent" >   First, construct the precedence graph:
<!--l. 5707--><p class="indent" >   <img 
src="37_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___em_Architecture_LectureNotes_source_pegado3.png" alt="PIC"  
>
<!--l. 5709--><p class="indent" >   In this case, there are no cycles, so <span 
class="cmmi-10">S </span>is conflict serializable.
   </div>
<!--l. 5710--><p class="indent" >
<!--l. 5712--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">11.2   </span> <a 
 id="x1-10400011.2"></a>How to enforce serializability: locking</h4>
<!--l. 5714--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">11.2.1   </span> <a 
 id="x1-10500011.2.1"></a>Option 1: let luck be our friend</h5>
<!--l. 5716--><p class="noindent" >Run the system, recording the precedence graphs of the schedules used. At the end of the day (at some decided point in
time), check for <span 
class="cmmi-10">P</span><img 
src="summary353x.png" alt="(S )"  class="left" align="middle"> cycles and declared if the execution was good.
<!--l. 5720--><p class="indent" >   Of course, this is not a very good option, because we are letting luck decide whether we are losing time and energy
or not.
<!--l. 5723--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">11.2.2   </span> <a 
 id="x1-10600011.2.2"></a>Option 2: a locking protocol</h5>
<!--l. 5725--><p class="noindent" >Prevent cycles from occurring!
<!--l. 5727--><p class="indent" >   Now, we define two new actions:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 5729--><p class="noindent" >LOCK(A),&#x00A0;<span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary354x.png" alt="(A )"  class="left" align="middle">: lock access to object <span 
class="cmmi-10">A</span>, i.e., only transaction <span 
class="cmmi-10">i </span>can access object <span 
class="cmmi-10">A </span>both for read and
     write.
     </li>
     <li class="itemize">
     <!--l. 5731--><p class="noindent" >UNLOCK(A), <span 
class="cmmi-10">u</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary355x.png" alt="(A )"  class="left" align="middle">: unlock <span 
class="cmmi-10">A </span>so it can be accessed by other transactions.</li></ul>
                                                                                            
                                                                                            
<div class="tcolorbox tcolorbox" id="tcolobox-23">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5735--><p class="noindent" ><span class="head">
<a 
 id="x1-106001r7"></a>
<span 
class="ecbx-1000">Definition 11.7.</span>   </span><span 
class="ecbx-1000">Rule 1: </span>A transaction is <span 
class="ecbx-1000">well-formed </span>if before performing any operation on an
object <span 
class="cmmi-10">A</span>, it has locked it before, and it unlocks it afterwards.
</div>
<!--l. 5739--><p class="noindent" >
<div class="newtheorem">
<!--l. 5741--><p class="noindent" ><span class="head">
<a 
 id="x1-106002r8"></a>
<span 
class="ecbx-1000">Definition 11.8.</span>   </span><span 
class="ecbx-1000">Rule 2: </span>A schedule is <span 
class="ecbx-1000">legal </span>if all objects that are locked, have been previously
unlocked (or never locked before).
</div>
<!--l. 5744--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 5747--><p class="noindent" ><span class="head">
<a 
 id="x1-106003r7"></a>
<span 
class="ecbx-1000">Example 11.7.</span>  </span>Let&#8217;s analyze some schedules in terms of well-form and legality:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 5750--><p class="noindent" >S1=l1(A)l1(B)r1(A)w1(B)l2(B)u1(A)u1(B)r2(B)w2(B)u2(B)l3(B)r3(B)u3(B) ç
     <!--l. 5753--><p class="noindent" >Let&#8217;s start assessing if all transactions are well-formed:
     <!--l. 5755--><p class="noindent" >S1=<span id="textcolor33">l1(A)</span><span id="textcolor34">l1(B)</span><span id="textcolor35">r1(A)</span><span id="textcolor36">w1(B)</span><span id="textcolor37">l2(B)</span><span id="textcolor38">u1(A)</span><span id="textcolor39">u1(B)</span><span id="textcolor40">r2(B)w2(B)u2(B)</span><span id="textcolor41">l3(B)r3(B)u3(B)</span>
     <!--l. 5757--><p class="noindent" >As we can see, all actions of each transaction are preceded by a lock to the pertinent object and an unlock
     afterwards, so all transactions are well formed.
     <!--l. 5761--><p class="noindent" >Regarding legality:
     <!--l. 5763--><p class="noindent" >S1=l1(A)<span id="textcolor42">l1(B)</span>r1(A)<span id="textcolor43">w1(B)</span><span id="textcolor44">l2(B)</span>u1(A)<span id="textcolor45">u1(B)</span>r2(B)w2(B)u2(B)l3(B)r3(B)u3(B)
     <!--l. 5765--><p class="noindent" >We can see how object B is locked by transaction 2 before being unlocked by transaction 1, so the schedule
     is not legal.
     </li>
     <li class="itemize">
     <!--l. 5767--><p class="noindent" >S2=l1(A)r1(A)w1(B)u1(A)u1(B)l2(B)r2(B)w2(B)l3(B)r3(B)u3(B)
     <!--l. 5769--><p class="noindent" >Regarding well-form:
     <!--l. 5771--><p class="noindent" >S2=<span id="textcolor46">¿?</span>l1(A)r1(A)<span id="textcolor47">w1(B)</span>u1(A)u1(B)<span id="textcolor48">l2(B)r2(B)w2(B)</span><span id="textcolor49">l3(B)r3(B)u3(B)</span><span id="textcolor50">¿?</span>
     <!--l. 5773--><p class="noindent" >B is modified by transaction 1 before being locked, so transaction 1 is not well formed.
     <!--l. 5776--><p class="noindent" >B is locked, read and written by transaction 2, but it is never unlocked, so transaction 2 is also not well
     formed.
     <!--l. 5779--><p class="noindent" >Transaction 3 is well formed.
     <!--l. 5781--><p class="noindent" >Regarding legality, we can see how B is locked by transaction 3 before being unlocked by transacion 2, so
     the schedule is not legal.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 5783--><p class="noindent" >S3=<span id="textcolor51">l1(A)r1(A)u1(A)</span><span id="textcolor52">l1(B)w1(B)u1(B)</span><span id="textcolor53">l2(B)r2(B)w2(B)u2(B)</span><span id="textcolor54">l3(B)r3(B)u3(B)</span>
     <!--l. 5785--><p class="noindent" >This schedule is obviously legal and all transactions are well formed.</li></ul>
   </div>
<!--l. 5787--><p class="indent" >
<div class="tcolorbox tcolorbox" id="tcolobox-24">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5789--><p class="noindent" ><span class="head">
<a 
 id="x1-106004r9"></a>
<span 
class="ecbx-1000">Definition 11.9.</span>   </span><span 
class="ecbx-1000">Rule 3: </span>The <span 
class="ecbx-1000">two phase locking (2PL) </span>scheme refers to a strategy for scheduling
in which there are no unlocks for transaction <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> until all locks for <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> have been acquired, and there are
no locks for <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> after any unlock for <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub>, i.e., all locks are acquired before any unlock is performed.
</div>
<!--l. 5795--><p class="noindent" >
 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-25">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5799--><p class="noindent" ><span class="head">
<a 
 id="x1-106005r1"></a>
<span 
class="ecbx-1000">Theorem 11.1.</span>   </span><span 
class="ecti-1000">All schedules verifying rules 1,2 and 3 are conflict-serializable. Meaning, if a schedule</span>
<span 
class="ecti-1000">has all its transactions well-formed, the schedule is legal and it uses the 2PL locking scheme, then the</span>
<span 
class="ecti-1000">schedule is conflict-serializable.</span>
</div>
<!--l. 5804--><p class="noindent" >
 
</div> 
</div>
   <div class="newtheorem">
<!--l. 5807--><p class="noindent" ><span class="head">
<a 
 id="x1-106006r2"></a>
<span 
class="ecti-1000">Remark </span>11.2<span 
class="ecti-1000">.</span>  </span>Note that the converse is not true: there are conflict-serializable schedules that are not 2PL.
   </div>
<!--l. 5810--><p class="indent" >
Beyond the 2PL protocol, it is all a matter of improving performance and allowing more concurrency, for these, there
exist more artifacts, such as shared locks, multiple granularity locks,...
<!--l. 5815--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">11.3   </span> <a 
 id="x1-10700011.3"></a>Shared locks</h4>
<!--l. 5817--><p class="noindent" >Until now, we are locking an object before any action can be applied to it, but sometimes it is possible to actually grant
access to several transactions to interact with the same object, if the actions that they need to perform are not in
conflict. For example, if two transactions want to read from the same variable, they can do it without problem, but with
our scheme we don&#8217;t allow this.
<!--l. 5824--><p class="indent" >   A way to amend this is to define <span 
class="ecbx-1000">shared locks </span>which are locks that can be shared by several transactions, provided
they only want to read the object.
                                                                                            
                                                                                            
<!--l. 5828--><p class="indent" >   We define new actions:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 5830--><p class="noindent" >EXCLUSIVE-LOCK(A), <span 
class="cmmi-10">xl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary356x.png" alt="(A)"  class="left" align="middle">: lock object A in exclusive mode, i.e., no other transaction can lock it
     until it is unlocked.
     </li>
     <li class="itemize">
     <!--l. 5832--><p class="noindent" >SHARED-LOCK(A), <span 
class="cmmi-10">sl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary357x.png" alt="(A)"  class="left" align="middle">: lock object A in shared mode, i.e., other transactions can lock it in shared
     mode, but not in exclusive mode.
     </li>
     <li class="itemize">
     <!--l. 5835--><p class="noindent" >EXCLUSIVE-UNLOCK(A), <span 
class="cmmi-10">xu</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary358x.png" alt="(A )"  class="left" align="middle">: unlock A from exclusive lock.
     </li>
     <li class="itemize">
     <!--l. 5837--><p class="noindent" >SHARED-UNLOCK(A), <span 
class="cmmi-10">su</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary359x.png" alt="(A)"  class="left" align="middle">: unlock A from shared lock.</li></ul>
<!--l. 5839--><p class="noindent" >Note that it is usual to just represent both unlocks by <span 
class="cmmi-10">u</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary360x.png" alt="(A)"  class="left" align="middle">, assuming the computer will execute the correct action
depending on the state of the object.
<!--l. 5843--><p class="indent" >   Now, we have to redefine our rules:
   <div class="tcolorbox tcolorbox" id="tcolobox-26">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5846--><p class="noindent" ><span class="head">
<a 
 id="x1-107001r10"></a>
<span 
class="ecbx-1000">Definition 11.10.</span>   </span><span 
class="ecbx-1000">Rule 1: </span>a transaction is <span 
class="ecbx-1000">well-formed </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5849--><p class="noindent" >Before performing a read action on an object, it has been previously locked, exclusively or shared
        (but better if it is shared locked, allowing for increased performance).
        </li>
        <li class="itemize">
        <!--l. 5852--><p class="noindent" >Before performing a write action on an object, it has been previously exclusively locked.</li></ul>
<!--l. 5855--><p class="noindent" ><span 
class="ecbx-1000">Rule 2: </span>a schedule is <span 
class="ecbx-1000">legal </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5857--><p class="noindent" >No exclusive lock is performed on a locked (exclusive or shared) object, until it has been unlocked.
        </li>
        <li class="itemize">
        <!--l. 5859--><p class="noindent" >No lock (exclusive or shared) is performed on a exclusively locked object, until it has been unlocked.</li></ul>
<!--l. 5862--><p class="noindent" >This rule can be summarize in a <span 
class="ecbx-1000">compatibility matrix</span>, which shows which state changes are
allowed:
<div class="tabular"> <table id="TBL-53" class="tabular" 
 
><colgroup id="TBL-53-1g"><col 
id="TBL-53-1"></colgroup><colgroup id="TBL-53-2g"><col 
id="TBL-53-2"></colgroup><colgroup id="TBL-53-3g"><col 
id="TBL-53-3"></colgroup><colgroup id="TBL-53-4g"><col 
id="TBL-53-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-1-1"  
class="td11">         </td><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-53-1-2"  
class="td11">      <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">j</span></sub> asks for</div>         
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-2-1"  
class="td11"> <div class="multirow"><!-- rows=3 -->
<span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> holds</div>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-2-2"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-2-3"  
class="td11">   S    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-2-4"  
class="td11">   X    </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-3-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-4-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-5-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-6-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-6-2"  
class="td11"> S  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-6-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-6-4"  
class="td11"> False  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-7-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-8-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-9-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-10-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-10-2"  
class="td11"> X  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-10-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-53-10-4"  
class="td11"> False  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-53-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-53-11-1"  
class="td11"> </td></tr></table></div>
<!--l. 5885--><p class="noindent" ><span 
class="ecbx-1000">Rule 3: </span>a schedule respect the <span 
class="ecbx-1000">2PL protocol </span>if for any two-phase locked transaction <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub>, no action <span 
class="cmmi-10">xl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary361x.png" alt="(A )"  class="left" align="middle"> or
<span 
class="cmmi-10">sl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary362x.png" alt="(A )"  class="left" align="middle"> is preceded by an action <span 
class="cmmi-10">u</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary363x.png" alt="(B)"  class="left" align="middle"> for any object <span 
class="cmmi-10">B</span>.
</div>
<!--l. 5889--><p class="noindent" >
 
</div> 
</div>
<!--l. 5892--><p class="indent" >   Notice that there are transactions that read and write the same object, so what should we do about this? There are
two main options:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-107003x1">
     <!--l. 5895--><p class="noindent" >We can just request an exclusive lock from the beginning.
     </li>
<li 
  class="enumerate" id="x1-107005x2">
     <!--l. 5896--><p class="noindent" >We can use an <span 
class="ecbx-1000">upgrade </span>scheme, in which a shared lock is acquired if we are unsure if we will need to write
     the object later. When we need to write it, we &#8217;<span 
class="ecti-1000">upgrade</span>&#8217; the shared lock to be an exclusive lock. This can
     be technically achieved by allowing transactions to have two locks on the same object: one shared and one
                                                                                            
                                                                                            
     exclusive; or by releasing the shared lock and getting the exclusive lock<span class="footnote-mark"><a 
href="summary9.html#fn7x0"><sup class="textsuperscript">7</sup></a></span><a 
 id="x1-107006f7"></a> .</li></ol>
<!--l. 5905--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">11.4   </span> <a 
 id="x1-10800011.4"></a>More types of locks</h4>
<!--l. 5907--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">11.4.1   </span> <a 
 id="x1-10900011.4.1"></a>Increment lock</h5>
<!--l. 5909--><p class="noindent" >We can define a new action, which is an <span 
class="ecbx-1000">atomic increment action</span>, as
   <div class="math-display" >
<img 
src="summary364x.png" alt="INi (A,k) &#x2261; {Read (A);A &#x2190; A + k;W rite (A )} .
" class="math-display" ></div>
<!--l. 5914--><p class="indent" >   A property of these actions is that they are commutative, so they do not conflict between each other, even though
they involve writing the objects. This allows for more flexibility, because we can define a new lock, the <span 
class="ecbx-1000">increment</span>
<span 
class="ecbx-1000">lock</span>:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 5919--><p class="noindent" >INCREMENT-LOCK(A), <span 
class="cmmi-10">il</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary365x.png" alt="(A )"  class="left" align="middle">: lock object <span 
class="cmmi-10">A </span>to perform increment actions on it.</li></ul>
<!--l. 5922--><p class="noindent" >And we have to, again, redefine the rules:
   <div class="tcolorbox tcolorbox" id="tcolobox-27">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 5925--><p class="noindent" ><span class="head">
<a 
 id="x1-109001r11"></a>
<span 
class="ecbx-1000">Definition 11.11.</span>   </span><span 
class="ecbx-1000">Rule 1: </span>a transaction is <span 
class="ecbx-1000">well-formed </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5928--><p class="noindent" >Before performing a read action on an object, it has been previously locked, exclusively or shared
        (but better if it is shared locked, allowing for increased performance).
        </li>
        <li class="itemize">
        <!--l. 5931--><p class="noindent" >Before performing a write action on an object, it has been previously exclusively locked.
        </li>
        <li class="itemize">
        <!--l. 5933--><p class="noindent" >Before performing an increment action on an object, it has been previously increment-locked.</li></ul>
<!--l. 5936--><p class="noindent" ><span 
class="ecbx-1000">Rule 2: </span>a schedule is <span 
class="ecbx-1000">legal </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 5938--><p class="noindent" >No exclusive lock is performed on a locked (exclusive, increase or shared) object, until it has been
        unlocked.
        </li>
        <li class="itemize">
        <!--l. 5940--><p class="noindent" >No lock (exclusive, increase or shared) is performed on a exclusively locked object, until it has been
        unlocked.
        </li>
        <li class="itemize">
        <!--l. 5942--><p class="noindent" >An increase lock can only be performed on unlocked objects or increase-locked objects.</li></ul>
<!--l. 5945--><p class="noindent" >This rule can be summarize in a <span 
class="ecbx-1000">compatibility matrix</span>, which shows which state changes are
allowed:
<div class="tabular"> <table id="TBL-54" class="tabular" 
 
><colgroup id="TBL-54-1g"><col 
id="TBL-54-1"></colgroup><colgroup id="TBL-54-2g"><col 
id="TBL-54-2"></colgroup><colgroup id="TBL-54-3g"><col 
id="TBL-54-3"></colgroup><colgroup id="TBL-54-4g"><col 
id="TBL-54-4"></colgroup><colgroup id="TBL-54-5g"><col 
id="TBL-54-5"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-1-1"  
class="td11">         </td><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-54-1-2"  
class="td11"></td>          <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">j</span></sub> asks for</div>                
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-2-1"  
class="td11"> <div class="multirow"><!-- rows=3 -->
<span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> holds</div>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-2-2"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-2-3"  
class="td11">   S    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-2-4"  
class="td11">   X    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-2-5"  
class="td11">   I     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-3-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-4-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-5-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-6-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-7-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-7-2"  
class="td11"> S  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-7-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-7-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-7-5"  
class="td11"> False  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-54-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-8-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-9-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-10-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-11-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-12-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-12-2"  
class="td11"> X  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-12-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-12-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-12-5"  
class="td11"> False  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-13-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-14-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-14-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-15-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-15-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-16-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-16-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-17-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-17-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-17-2"  
class="td11">  I  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-17-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-17-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-54-17-5"  
class="td11"> True  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-54-18-"><td  style="white-space:nowrap; text-align:center;" id="TBL-54-18-1"  
class="td11">         </td></tr></table></div>
<!--l. 5976--><p class="noindent" ><span 
class="ecbx-1000">Rule 3: </span>a schedule respect the <span 
class="ecbx-1000">2PL protocol </span>if for any two-phase locked transaction <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub>, no action <span 
class="cmmi-10">xl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary366x.png" alt="(A )"  class="left" align="middle">,
<span 
class="cmmi-10">sl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary367x.png" alt="(A )"  class="left" align="middle"> or <span 
class="cmmi-10">il</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary368x.png" alt="(A )"  class="left" align="middle"> is preceded by an action <span 
class="cmmi-10">u</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary369x.png" alt="(B)"  class="left" align="middle"> for any object <span 
class="cmmi-10">B</span>.
</div>
<!--l. 5980--><p class="noindent" >
 
</div> 
</div>
                                                                                            
                                                                                            
<!--l. 5984--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">11.4.2   </span> <a 
 id="x1-11000011.4.2"></a>Update lock</h5>
<!--l. 5986--><p class="noindent" >A common deadlock problem that arises when we use upgrading shared locks is depicted below:
<div class="center" 
>
<!--l. 5988--><p class="noindent" >
<div class="tabular"> <table id="TBL-55" class="tabular" 
 
><colgroup id="TBL-55-1g"><col 
id="TBL-55-1"></colgroup><colgroup id="TBL-55-2g"><col 
id="TBL-55-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-1-1"  
class="td11">   T1    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-55-1-2"  
class="td11">   T2     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-2-1"  
class="td11"> <span 
class="cmmi-10">sl</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary370x.png" alt="(A)"  class="left" align="middle">  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-55-2-2"  
class="td11">        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-3-1"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-55-3-2"  
class="td11"> <span 
class="cmmi-10">sl</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary371x.png" alt="(A)"  class="left" align="middle">  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-4-1"  
class="td11"> <span id="textcolor55"><span 
class="cmmi-10">lx</span><sub><span 
class="cmr-7">1</span></sub><img 
src="summary372x.png" alt="(A)"  class="left" align="middle"></span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-55-4-2"  
class="td11">        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-5-1"  
class="td11">        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-55-5-2"  
class="td11"> <span id="textcolor56"><span 
class="cmmi-10">lx</span><sub><span 
class="cmr-7">2</span></sub><img 
src="summary373x.png" alt="(A)"  class="left" align="middle"></span>  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-55-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-55-6-1"  
class="td11">        </td></tr></table></div>
</div>
<!--l. 6010--><p class="indent" >   In this case, both transactions are waiting for the other to release the object <span 
class="cmmi-10">A </span>to be able to lock it exclusively, so
there is a deadlock.
<!--l. 6013--><p class="indent" >   The <span 
class="ecbx-1000">solution </span>implies decreasing the level of concurrency, but it is worthy to avoid such problematic
cases. We define a new lock, in which a transaction which is unsure about if it will need to write an
object, it acquire an <span 
class="ecbx-1000">update lock </span>instead of the shared lock, and upgrades can only be made from this
lock:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6019--><p class="noindent" >UPDATE-LOCK(A), <span 
class="cmmi-10">ul</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary374x.png" alt="(A)"  class="left" align="middle">: lock object <span 
class="cmmi-10">A </span>and might upgrade later.</li></ul>
<!--l. 6022--><p class="noindent" >Note that if an object is shared-locked, it can be update-locked, but not the other way round (if we allow this, the behavior
would not change).
<!--l. 6026--><p class="indent" >   Let&#8217;s redefine our three rules for this case:
   <div class="tcolorbox tcolorbox" id="tcolobox-28">    
<div class="tcolorbox-title">
                                                                                            
                                                                                            
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 6029--><p class="noindent" ><span class="head">
<a 
 id="x1-110001r12"></a>
<span 
class="ecbx-1000">Definition 11.12.</span>   </span><span 
class="ecbx-1000">Rule 1: </span>a transaction is <span 
class="ecbx-1000">well-formed </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 6032--><p class="noindent" >Before performing a read action on an object, it has been previously locked, exclusively, update or
        shared (but better if it is shared locked, allowing for increased performance).
        </li>
        <li class="itemize">
        <!--l. 6035--><p class="noindent" >Before performing a write action on an object, it has been previously exclusively locked.
        </li>
        <li class="itemize">
        <!--l. 6037--><p class="noindent" >Before upgrading a lock, it has been previously update-locked.</li></ul>
<!--l. 6039--><p class="noindent" ><span 
class="ecbx-1000">Rule 2: </span>a schedule is <span 
class="ecbx-1000">legal </span>if:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 6041--><p class="noindent" >No exclusive lock is performed on a locked (exclusive, update or shared) object, until it has been
        unlocked.
        </li>
        <li class="itemize">
        <!--l. 6043--><p class="noindent" >No lock (exclusive, update or shared) is performed on a exclusively locked object, until it has been
        unlocked.
        </li>
        <li class="itemize">
        <!--l. 6045--><p class="noindent" >An update lock can only be performed on unlocked objects or shared-locked objects.</li></ul>
<!--l. 6048--><p class="noindent" >This rule can be summarize in a <span 
class="ecbx-1000">compatibility matrix</span>, which shows which state changes are
allowed:
<div class="tabular"> <table id="TBL-56" class="tabular" 
 
><colgroup id="TBL-56-1g"><col 
id="TBL-56-1"></colgroup><colgroup id="TBL-56-2g"><col 
id="TBL-56-2"></colgroup><colgroup id="TBL-56-3g"><col 
id="TBL-56-3"></colgroup><colgroup id="TBL-56-4g"><col 
id="TBL-56-4"></colgroup><colgroup id="TBL-56-5g"><col 
id="TBL-56-5"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-1-1"  
class="td11">         </td><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-56-1-2"  
class="td11"></td>          <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">j</span></sub> asks for</div>                
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-2-1"  
class="td11"> <div class="multirow"><!-- rows=3 -->
<span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> holds</div>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-2-2"  
class="td11">    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-2-3"  
class="td11">   S    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-2-4"  
class="td11">   X    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-2-5"  
class="td11">   U    </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-3-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-4-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-5-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-6-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-7-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-7-2"  
class="td11"> S  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-7-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-7-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-7-5"  
class="td11"> True  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-56-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-8-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-9-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-10-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-11-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-12-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-12-2"  
class="td11"> X  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-12-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-12-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-12-5"  
class="td11"> False  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-13-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-14-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-14-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-15-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-15-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-16-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-16-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-17-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-17-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-17-2"  
class="td11"> U  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-17-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-17-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-56-17-5"  
class="td11"> False  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-56-18-"><td  style="white-space:nowrap; text-align:center;" id="TBL-56-18-1"  
class="td11">         </td></tr></table></div>
<!--l. 6079--><p class="noindent" >Note that in this case, an object can be locked in several modes (for instance, it can be locked in
shared and update mode at the same time), so transitions are based on the most restrictive lock
mode.
<!--l. 6083--><p class="noindent" ><span 
class="ecbx-1000">Rule 3: </span>a schedule respect the <span 
class="ecbx-1000">2PL protocol </span>if for any two-phase locked transaction <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub>, no action <span 
class="cmmi-10">xl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary375x.png" alt="(A )"  class="left" align="middle"> or
<span 
class="cmmi-10">sl</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary376x.png" alt="(A )"  class="left" align="middle"> is preceded by an action <span 
class="cmmi-10">u</span><sub><span 
class="cmmi-7">i</span></sub><img 
src="summary377x.png" alt="(B)"  class="left" align="middle"> for any object <span 
class="cmmi-10">B</span>.
</div>
<!--l. 6087--><p class="noindent" >
 
</div> 
</div>
                                                                                            
                                                                                            
<!--l. 6091--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">11.5   </span> <a 
 id="x1-11100011.5"></a>Lock granularity</h4>
<!--l. 6093--><p class="noindent" >We have been talking about locking objects, but we have not specified which are these objects. They can be tuples,
pages, relations,... In all cases the scheme works, but choosing the appropriate size for what we are locking is obviously
going to affect performance. For instance:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6099--><p class="noindent" >If we lock at tuple level, we gain in concurrency capabilities, but we will need to increase the efforts to
     control the concurrent access. For example, the memory needed to store all locks would increase.
     </li>
     <li class="itemize">
     <!--l. 6102--><p class="noindent" >If we lock at relation level, it is easier to address the concurrency issues, but we lose many concurrency
     capabilities because as soon as some transaction is trying to modify one tuple of one relation, the whole
     relation would be inaccessible for other transactions.</li></ul>
<!--l. 6107--><p class="noindent" >We can define <span 
class="ecbx-1000">multi-granular locks</span>, which can specify at what level they want to lock the objects involved.
<!--l. 6110--><p class="indent" >   For this, we define <span 
class="ecbx-1000">intentional locks</span>, which can be of any of the types we have seen, but with a slightly different
meaning:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6113--><p class="noindent" >An intentional lock on an object, <span 
class="cmmi-10">A</span>, is trying to obtain a lock on a subobject, <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">s</span></sub>.
     </li>
     <li class="itemize">
     <!--l. 6115--><p class="noindent" >Intentional locks indicate the type of the lock of the subobjects.</li></ul>
<div class="newtheorem">
<!--l. 6117--><p class="noindent" ><span class="head">
<a 
 id="x1-111001r8"></a>
<span 
class="ecbx-1000">Example 11.8.</span>  </span>Imagine  we  have  the  relation  <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>  which  has  four  tuples.  If  transaction  1,  <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">1</span></sub>,  wants  to
shared-lock the second tuple, <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">2</span></sub>, we need to obtain an intentional shared-lock on <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub> and then a shared-lock on
<span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">2</span></sub>. This is depicted below:
<!--l. 6123--><p class="indent" >   <img 
src="38_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_0.png" alt="PIC"  
width="43" height="43" >
<!--l. 6125--><p class="indent" >   Now, imagine <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub>  wants a shared-lock in the whole relation, then, it will can be acquired, because the
compatibility matrix allows it. But it wanted an exclusive-lock in the whole relation, it would need to wait until
the locked tuple is unlocked.
</div>
<!--l. 6129--><p class="indent" >
<div class="newtheorem">
<!--l. 6131--><p class="noindent" ><span class="head">
<a 
 id="x1-111002r9"></a>
<span 
class="ecbx-1000">Example 11.9.</span>  </span>Another example is starting with the previous one:
<!--l. 6134--><p class="indent" >   <img 
src="38_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_0.png" alt="PIC"  
width="43" height="43" >
                                                                                            
                                                                                            
<!--l. 6136--><p class="indent" >   Now, imagine <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub>  wants to exclusively lock <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">4</span></sub>: this can be done, because <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">4</span></sub>  is unlocked. In this case, <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub>
needs to ask for an intentional exclusive lock on <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>, which would be granted because the relation <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">1</span></sub>  is not
fully locked. Then at tuple level, <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> would ask for an exclusive lock for <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">4</span></sub>, an it would be granted because it is
unlocked:
<!--l. 6143--><p class="indent" >   <img 
src="39_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_1.png" alt="PIC"  
width="43" height="43" >
</div>
<!--l. 6144--><p class="indent" >
Again, we can build the compatibility matrix for this new kind of locks:
<div class="center" 
>
<!--l. 6147--><p class="noindent" >
<div class="tabular"> <table id="TBL-57" class="tabular" 
 
><colgroup id="TBL-57-1g"><col 
id="TBL-57-1"></colgroup><colgroup id="TBL-57-2g"><col 
id="TBL-57-2"></colgroup><colgroup id="TBL-57-3g"><col 
id="TBL-57-3"></colgroup><colgroup id="TBL-57-4g"><col 
id="TBL-57-4"></colgroup><colgroup id="TBL-57-5g"><col 
id="TBL-57-5"></colgroup><colgroup id="TBL-57-6g"><col 
id="TBL-57-6"></colgroup><colgroup id="TBL-57-7g"><col 
id="TBL-57-7"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-1-1"  
class="td11">         </td><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-57-1-2"  
class="td11"></td>                   <div class="multicolumn"  style="white-space:nowrap; text-align:center;"><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">j</span></sub> asks for</div>                              
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-1"  
class="td11"> <div class="multirow"><!-- rows=3 -->
<span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> holds</div>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-2"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-3"  
class="td11">  IS    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-4"  
class="td11">  IX   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-5"  
class="td11">   S    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-6"  
class="td11">  SIX   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-2-7"  
class="td11">   X    </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-3-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-4-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-5-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-6-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-7-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-8-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-2"  
class="td11">  IS   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-4"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-5"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-6"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-9-7"  
class="td11"> False  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-57-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-10-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-11-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-12-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-13-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-14-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-14-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-15-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-15-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-16-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-2"  
class="td11">  IX   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-4"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-5"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-6"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-16-7"  
class="td11"> False  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-17-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-17-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-18-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-18-1"  
class="td11"></td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-19-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-19-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-20-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-20-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-21-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-21-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-22-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-22-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-23-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-2"  
class="td11">  S   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-5"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-6"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-23-7"  
class="td11"> False  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-57-24-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-24-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-25-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-25-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-26-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-26-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-27-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-27-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-28-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-28-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-29-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-29-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-30-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-2"  
class="td11"> SIX  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-3"  
class="td11"> True  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-5"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-6"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-30-7"  
class="td11"> False  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-57-31-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-31-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-32-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-32-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-33-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-33-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-34-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-34-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-35-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-35-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-36-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-36-1"  
class="td11">
</td></tr><tr 
class="cline"><td></td><td></td><td></td><td></td><td></td><td></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-37-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-1"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-2"  
class="td11">  X   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-3"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-4"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-5"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-6"  
class="td11"> False  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-57-37-7"  
class="td11"> False  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-57-38-"><td  style="white-space:nowrap; text-align:center;" id="TBL-57-38-1"  
class="td11">         </td></tr></table></div>
</div>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6199--><p class="noindent" >IS, intentional shared lock: lock some subobjects in share mode.
     </li>
     <li class="itemize">
     <!--l. 6200--><p class="noindent" >IX, intentional exclusive lock: lock some subobjects in exclusive mode.
     </li>
     <li class="itemize">
     <!--l. 6202--><p class="noindent" >S, shared lock: lock an object in shared mode.
     </li>
     <li class="itemize">
     <!--l. 6203--><p class="noindent" >SIX, shared intentional exclusive lock: lock an object in shared mode and some subobjects in exclusive
     mode.
     </li>
     <li class="itemize">
     <!--l. 6205--><p class="noindent" >X, exclusive lock: lock an object in exclusive mode.</li></ul>
<!--l. 6207--><p class="noindent" >Also, there are restrictions in which states can subobjects have in terms of the states of the parent object:
                                                                                            
                                                                                            
<div class="center" 
>
<!--l. 6209--><p class="noindent" >
<div class="tabular"> <table id="TBL-58" class="tabular" 
 
><colgroup id="TBL-58-1g"><col 
id="TBL-58-1"></colgroup><colgroup id="TBL-58-2g"><col 
id="TBL-58-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-1-1"  
class="td11"> Parent state  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-1-2"  
class="td11"> Child possible states  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-2-1"  
class="td11">      IS         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-2-2"  
class="td11">        IS,S             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-3-1"  
class="td11">      IX         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-3-2"  
class="td11">    IS,S,IX,X,SIX      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-4-1"  
class="td11">      S          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-4-2"  
class="td11">        none            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-5-1"  
class="td11">     SIX        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-5-2"  
class="td11">        X,IX            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-6-1"  
class="td11">      X         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-58-6-2"  
class="td11">        none            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-58-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-58-7-1"  
class="td11">             </td></tr></table></div>
</div>
<!--l. 6234--><p class="indent" >   The rules to follow are the following:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-111004x1">
     <!--l. 6236--><p class="noindent" >Follow the multiple granularity compatibility matrix.
     </li>
<li 
  class="enumerate" id="x1-111006x2">
     <!--l. 6237--><p class="noindent" >Lock root of tree first.
     </li>
<li 
  class="enumerate" id="x1-111008x3">
     <!--l. 6238--><p class="noindent" >Node <span 
class="cmmi-10">Q </span>can be locked by <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> in S or IS only if <span 
class="cmmi-10">parent</span><img 
src="summary378x.png" alt="(Q)"  class="left" align="middle"> is locked by <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> in IX or IS.
     </li>
<li 
  class="enumerate" id="x1-111010x4">
     <!--l. 6240--><p class="noindent" >Node <span 
class="cmmi-10">Q </span>can be locked by <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> in X,SIX,IX only if <span 
class="cmmi-10">parent</span><img 
src="summary379x.png" alt="(Q)"  class="left" align="middle"> is locked by <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> in IX,SIX.
     </li>
<li 
  class="enumerate" id="x1-111012x5">
     <!--l. 6242--><p class="noindent" ><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> is two-phase.
     </li>
<li 
  class="enumerate" id="x1-111014x6">
     <!--l. 6243--><p class="noindent" ><span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub> can unlock node <span 
class="cmmi-10">Q </span>only if none of <span 
class="cmmi-10">Q</span>&#8217;s children are locked by <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">i</span></sub>.</li></ol>
<div class="newtheorem">
<!--l. 6246--><p class="noindent" ><span class="head">
<a 
 id="x1-111015r10"></a>
<span 
class="ecbx-1000">Example 11.10.</span>  </span>Let&#8217;s do some practice.
<!--l. 6249--><p class="indent" >   <span 
class="ecbx-1000">1) </span>Start with this setup:
<!--l. 6251--><p class="indent" >   <img 
src="40_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_2.png" alt="PIC"  
width="28" height="28" >
<!--l. 6253--><p class="indent" >   Can <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> access object <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">22</span></sub> in mode X? If so, what locks would <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> get?
<!--l. 6256--><p class="indent" >   Yes, it can, because all the locks in the sequence are compatible with another IX lock and <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">2</span><span 
class="cmmi-7">,</span><span 
class="cmr-7">2</span></sub> is unlocked:
<!--l. 6259--><p class="indent" >   <img 
src="41_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_3.png" alt="PIC"  
width="28" height="28" >
<!--l. 6261--><p class="indent" >   <span 
class="ecbx-1000">2) </span>Start with this setup:
<!--l. 6263--><p class="indent" >   <img 
src="42_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_4.png" alt="PIC"  
width="28" height="28" >
<!--l. 6265--><p class="indent" >   Can <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> access object <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">22</span></sub> in mode X? If so, what locks would <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> get?
<!--l. 6268--><p class="indent" >   No, it cannot, because parent <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">2</span></sub> is in X mode, so it cannot be locked in IX mode by <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub>.
                                                                                            
                                                                                            
<!--l. 6271--><p class="indent" >   <span 
class="ecbx-1000">3) </span>From the last setup: can <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> access object <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">3</span><span 
class="cmmi-7">,</span><span 
class="cmr-7">1</span></sub> in X mode? What locks would <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> get?
<!--l. 6274--><p class="indent" >   Yes, it can, because <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">3</span><span 
class="cmmi-7">,</span><span 
class="cmr-7">1</span></sub> is unlocked, its parent <span 
class="cmmi-10">t</span><sub><span 
class="cmr-7">3</span></sub> is unlocked, and its parent is in IX state, compatible with
another IX state:
<!--l. 6278--><p class="indent" >   <img 
src="43_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_5.png" alt="PIC"  
width="28" height="28" >
<!--l. 6280--><p class="indent" >   <span 
class="ecbx-1000">4) </span>Start with this setup:
<!--l. 6282--><p class="indent" >   <img 
src="44_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_6.png" alt="PIC"  
width="28" height="28" >
<!--l. 6284--><p class="indent" >   Can <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> access object <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">2</span><span 
class="cmmi-7">,</span><span 
class="cmr-7">2</span></sub> in S mode? What locks would <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> get?
<!--l. 6287--><p class="indent" >   Yes, because SIX and IX and compatible with IS:
<!--l. 6289--><p class="indent" >   <img 
src="45_home_runner_work_BDMA_Notes_BDMA_Notes_ULB_D___ure_LectureNotes_source_intentional_locks_7.png" alt="PIC"  
width="28" height="28" >
<!--l. 6291--><p class="indent" >   <span 
class="ecbx-1000">5) </span>In the previous setup: can <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> access object <span 
class="cmmi-10">f</span><sub><span 
class="cmr-7">2</span><span 
class="cmmi-7">,</span><span 
class="cmr-7">2</span></sub> in X mode? What locks would <span 
class="cmmi-10">T</span><sub><span 
class="cmr-7">2</span></sub> get?
<!--l. 6294--><p class="indent" >   No, because SIX is not compatible with IX.
</div>
<!--l. 6295--><p class="indent" >
                                                                                            
                                                                                            
   <h1 class="partHead"><span class="titlemark">Part&#x00A0;VII<br /></span><a 
 id="x1-112000VII"></a>Distributed Databases</h1>
   <h3 class="sectionHead"><span class="titlemark">12   </span> <a 
 id="x1-11300012"></a>Distributed databases</h3>
<!--l. 6302--><p class="noindent" >Distributed database management systems distribute and replicate data over multiple machines to try to meet the
availability, durability, performance, regulatory amd scale requirements of large organizations, subject to
physics.
<!--l. 6307--><p class="indent" >   A distributed database does two things:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6309--><p class="noindent" ><span 
class="ecbx-1000">Distribution</span>: place partitions of data on different machines.
     </li>
     <li class="itemize">
     <!--l. 6310--><p class="noindent" ><span 
class="ecbx-1000">Replication</span>: place copies of data on different machines.</li></ul>
<!--l. 6312--><p class="noindent" >The <span 
class="ecbx-1000">goal </span>is to offer the same functionality and transactional semantics as a RDBMS with distributed features.
<!--l. 6315--><p class="indent" >   The <span 
class="ecbx-1000">reality </span>is that there need to be done concessions in terms of functionality, transactional semantics and
performance.
<!--l. 6318--><p class="indent" >   There are three main challenges in distributed databases, which are how to distribute the data, how to access the
data and how to perform distributed transactions.
   <div class="tcolorbox tcolorbox" id="tcolobox-29">    
<div class="tcolorbox-title">
   </div> 
<div class="tcolorbox-content"><div class="newtheorem">
<!--l. 6323--><p class="noindent" ><span class="head">
<a 
 id="x1-113001r1"></a>
<span 
class="ecbx-1000">Definition 12.1.</span>   </span>A <span 
class="ecbx-1000">shard </span>is a horizontal partition of data in a database.
</div>
<!--l. 6325--><p class="noindent" >
 
</div> 
</div>
<!--l. 6329--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.1   </span> <a 
 id="x1-11400012.1"></a>Data distribution</h4>
<!--l. 6331--><p class="noindent" >There are several ways to distribute the data:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6333--><p class="noindent" ><span 
class="ecbx-1000">Range distribution</span>: tables are partitioned by a <span 
class="ecti-1000">distribution key</span>, which is usualy part of a primary key. Each
     shard contains a range of the values.
     <div class="newtheorem">
     <!--l. 6336--><p class="noindent" ><span class="head">
<a 
 id="x1-114001r1"></a>
    <span 
class="ecbx-1000">Example 12.1.</span>  </span>Imagine a CUSTOMER table that is distributed in two servers: in one server we maintain
     all names starting by a letter in the range A-N and in the other server all starting with a letter in the
     range M-Z.
     </div>
     <!--l. 6340--><p class="noindent" >
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 6341--><p class="noindent" ><span 
class="ecbx-1000">Hash distribution</span>: there two ways to implement this:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 6343--><p class="noindent" >Each shard contains a modulo of a hash value.
         </li>
         <li class="itemize">
         <!--l. 6344--><p class="noindent" >Each shard contains a range of hash values.</li></ul>
     </li></ul>
<!--l. 6347--><p class="noindent" >In the context of data distribution, it is usually desirable to maintain approximately the same amount of data in each node.
To achieve this, <span 
class="ecbx-1000">rebalancing </span>is used. Rebalancing encompasses:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6351--><p class="noindent" >Moving shards to achieve better data distribution across nodes.
     </li>
     <li class="itemize">
     <!--l. 6352--><p class="noindent" >Splitting shards to achieve better data distributions across nodes.</li></ul>
<!--l. 6354--><p class="noindent" >Another important concept is that of <span 
class="ecbx-1000">co-location</span>, which makes use of the fact that some tables share some attributes. If a
shared attribute is related to the distribution key, then we can store different tables in a distributed manner, in such a
way that if we perform a join between these tables using this attribute, we minimize the interaction between tables from
different nodes.
<!--l. 6361--><p class="indent" >   Other times, for the same purpose of increasing the efficiency of distributed joins it is useful to replicate
small tables to enable fast joins, foreign keys and other operations. This technique is called <span 
class="ecbx-1000">reference</span>
<span 
class="ecbx-1000">tables</span>.
<!--l. 6366--><p class="indent" >   There are more ways to tackle data distribution:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6368--><p class="noindent" >Use random distributions to distribute the data.
     </li>
     <li class="itemize">
     <!--l. 6369--><p class="noindent" >Use list distribution, assigning labels to the different partitions.
     </li>
     <li class="itemize">
     <!--l. 6370--><p class="noindent" >Use spatial distribution, locating data in the servers where it will be of use.</li></ul>
<!--l. 6374--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.2   </span> <a 
 id="x1-11500012.2"></a>Distributed data access: distributed SQL</h4>
<!--l. 6376--><p class="noindent" >To scale query throughput linearly with the number of nodes, queries should only access one node. The techniques of
co-location and reference table enable relatively complex queries. This idea of using the nodes information inside the
queries to only access the desired nodes is called <span 
class="ecbx-1000">routing queries</span>.
   <div class="newtheorem">
<!--l. 6381--><p class="noindent" ><span class="head">
<a 
 id="x1-115001r2"></a>
                                                                                            
                                                                                            
<span 
class="ecbx-1000">Example 12.2.</span>  </span>A routing query trying to access only the node where the distribution key is 36:
   <!--l. 6385-->
   <div class="lstlisting" id="listing-33"><span class="label"><a 
 id="x1-115002r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">INSERT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">INTO</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">VALUES</span></span><span style="color:#000000"><span 
class="ectt-1000">(36,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">11);</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115003r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115004r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">*</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115005r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115006r5"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">=36</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;11;</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115007r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115008r7"></a></span><span style="color:#000000"><span 
class="ectt-1000">UPDATE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115009r8"></a></span><span style="color:#000000"><span 
class="ectt-1000">SET</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">=3</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-115010r9"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">=36</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AND</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;11;</span></span></div>
   
   </div>
<!--l. 6396--><p class="indent" >
Nonetheless, the relational algebra can be extended to work in distributed system: it is
called the <span 
class="ecbx-1000">multi-relational algebra</span>, and it adds to the usual relational algebra the
operations<span class="footnote-mark"><a 
href="summary10.html#fn8x0"><sup class="textsuperscript">8</sup></a></span><a 
 id="x1-115011f8"></a> :
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6402--><p class="noindent" >COLLECT: takes data from several nodes and single output data stream combining all of them.
     </li>
     <li class="itemize">
     <!--l. 6404--><p class="noindent" >REPARTITION: takes data from some nodes and sends it to other nodes.
     </li>
     <li class="itemize">
     <!--l. 6405--><p class="noindent" >BROADCAST: sends its input rows to multiple consumers on demand. Each consumer gets all of the
     rows.</li></ul>
<!--l. 6408--><p class="noindent" >As in standard SQL, in distributed SQL it is needed to perform logical planning of the queries before executing them, with
the need that the final result is the same as it would be if all data were in one node.
   <div class="newtheorem">
<!--l. 6412--><p class="noindent" ><span class="head">
<a 
 id="x1-115012r3"></a>
<span 
class="ecbx-1000">Example 12.3.</span>  </span>Imagine we want to compute the mean of an attribute in a table which is distributed in different
nodes. The steps to follow would be:
   </div>
<!--l. 6415--><p class="indent" >
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-115014x1">
     <!--l. 6417--><p class="noindent" >In each node: SUM(A) and COUNT(A)
     </li>
<li 
  class="enumerate" id="x1-115016x2">
     <!--l. 6418--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-115018x1">
         <!--l. 6420--><p class="noindent" >COLLECT all data: sum_ = SUM(SUM(N-&#x003E;T.A), N in Nodes), count_ = SUM(COUNT(N-&#x003E;T.A),
         N in Nodes)
                                                                                            
                                                                                            
         </li>
<li 
  class="enumerate" id="x1-115020x2">
         <!--l. 6422--><p class="noindent" >mean = sum_ / count_</li></ol>
     </li></ol>
<!--l. 6425--><p class="noindent" >Also, different plans can be defined and the best one should be chosen following some optimization criteria.
   <h5 class="likesubsubsectionHead"><a 
 id="x1-11600012.2"></a>Co-located joins</h5>
<!--l. 6430--><p class="noindent" >Imagine we have the query:
   <!--l. 6432-->
   <div class="lstlisting" id="listing-34"><span class="label"><a 
 id="x1-116001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(*)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-116002r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-116003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">JOIN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ON</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-116004r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">44</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-116005r5"></a></span><span style="color:#000000"><span 
class="ectt-1000">GROUP</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 6440--><p class="indent" >   One way to do this is:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-116007x1">
     <!--l. 6442--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-116009x1">
         <!--l. 6444--><p class="noindent" >Scan dist1
         </li>
<li 
  class="enumerate" id="x1-116011x2">
         <!--l. 6445--><p class="noindent" >Scan dist2 and filter dist2.value &#x003C; 44</li></ol>
     </li>
<li 
  class="enumerate" id="x1-116013x2">
     <!--l. 6447--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-116015x1">
         <!--l. 6449--><p class="noindent" >Collect all dist1
         </li>
<li 
  class="enumerate" id="x1-116017x2">
         <!--l. 6450--><p class="noindent" >Collect all filtered dist2
         </li>
<li 
  class="enumerate" id="x1-116019x3">
         <!--l. 6451--><p class="noindent" >Perform the join
         </li>
<li 
  class="enumerate" id="x1-116021x4">
         <!--l. 6452--><p class="noindent" >Aggregate</li></ol>
     </li></ol>
                                                                                            
                                                                                            
<!--l. 6455--><p class="noindent" >But as we are using the distribution key for joining, we know that the tables that will join are stored together, so we can
make use of the co-location by changing the plan to:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-116023x1">
     <!--l. 6459--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-116025x1">
         <!--l. 6461--><p class="noindent" >Scan dist1
         </li>
<li 
  class="enumerate" id="x1-116027x2">
         <!--l. 6462--><p class="noindent" >Scan dist2 and filter dist2.value &#x003C; 44
         </li>
<li 
  class="enumerate" id="x1-116029x3">
         <!--l. 6463--><p class="noindent" >Perform the join
         </li>
<li 
  class="enumerate" id="x1-116031x4">
         <!--l. 6464--><p class="noindent" >Aggregate</li></ol>
     </li>
<li 
  class="enumerate" id="x1-116033x2">
     <!--l. 6466--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-116035x1">
         <!--l. 6468--><p class="noindent" >Collect the values</li></ol>
     </li></ol>
<!--l. 6471--><p class="noindent" >For this changes to work, we are using that: filter is commutative with collect, group by dist_key is commutative with
collect and join is co-located, so it is commutative with collect.
<!--l. 6475--><p class="indent" >   When we do this, we are working with much smaller tables, thus reducing the response time.
<!--l. 6478--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-11700012.2"></a>Re-partition joins</h5>
<!--l. 6480--><p class="noindent" >Now imagine the query:
   <!--l. 6482-->
   <div class="lstlisting" id="listing-35"><span class="label"><a 
 id="x1-117001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(*)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-117002r2"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-117003r3"></a></span><span style="color:#000000"><span 
class="ectt-1000">JOIN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">ON</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">=</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">other_key</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-117004r4"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">value</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">44</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-117005r5"></a></span><span style="color:#000000"><span 
class="ectt-1000">GROUP</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span style="color:#000000"><span 
class="ectt-1000">.</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">;</span></span></div>
   
<!--l. 6490--><p class="indent" >   In this case, the initial plan also work, but again we can do better repartitioning the dist2 tables to the nodes where
they will be needed. This might seem like too heavy work to do, but if the tables are large enough, the whole relations
might not even fit in only one node, so this can be the only way to be able to produce the response. The alternative
plan is:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-117007x1">
     <!--l. 6497--><p class="noindent" >In each node:
                                                                                            
                                                                                            
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-117009x1">
         <!--l. 6499--><p class="noindent" >Scan dist2
         </li>
<li 
  class="enumerate" id="x1-117011x2">
         <!--l. 6500--><p class="noindent" >Filter dist2.value &#x003C; 44</li></ol>
     </li>
<li 
  class="enumerate" id="x1-117013x2">
     <!--l. 6502--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-117015x1">
         <!--l. 6504--><p class="noindent" >Repartition filtered tuples from dist2 with corresponding other_key to dist_key of this node
         </li>
<li 
  class="enumerate" id="x1-117017x2">
         <!--l. 6506--><p class="noindent" >Scan dist1
         </li>
<li 
  class="enumerate" id="x1-117019x3">
         <!--l. 6507--><p class="noindent" >Perform the join
         </li>
<li 
  class="enumerate" id="x1-117021x4">
         <!--l. 6508--><p class="noindent" >Aggregate</li></ol>
     </li>
<li 
  class="enumerate" id="x1-117023x3">
     <!--l. 6510--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-117025x1">
         <!--l. 6512--><p class="noindent" >Collect the values</li></ol>
     </li></ol>
<!--l. 6516--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-11800012.2"></a>Broadcast joins</h5>
<!--l. 6518--><p class="noindent" >Now, imagine the query:
   <!--l. 6520-->
   <div class="lstlisting" id="listing-36"><span class="label"><a 
 id="x1-118001r1"></a></span><span style="color:#000000"><span 
class="ectt-1000">WITH</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">top10</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">AS</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118002r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">,</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">count</span></span><span style="color:#000000"><span 
class="ectt-1000">(*)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118003r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118004r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">GROUP</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">1</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118005r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">ORDER</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">BY</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118006r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">LIMIT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">10</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118007r7"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1000">)</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118008r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118009r9"></a></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">*</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118010r10"></a></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist2</span></span><span 
class="ectt-1000">&#x00A0;</span><br /> 
<span class="label"><a 
 id="x1-118011r11"></a></span><span style="color:#000000"><span 
class="ectt-1000">WHERE</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">other_key</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">IN</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">(</span></span><span style="color:#000000"><span 
class="ectt-1000">SELECT</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">dist_key</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">FROM</span></span><span style="color:#000000"><span 
class="ectt-1000">&#x00A0;</span></span><span style="color:#000000"><span 
class="ectt-1000">top10</span></span><span style="color:#000000"><span 
class="ectt-1000">);</span></span></div>
   
<!--l. 6534--><p class="indent" >   The naïve plan is:
                                                                                            
                                                                                            
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-118013x1">
     <!--l. 6536--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118015x1">
         <!--l. 6538--><p class="noindent" >Scan dist1
         </li>
<li 
  class="enumerate" id="x1-118017x2">
         <!--l. 6539--><p class="noindent" >Scan dist2</li></ol>
     </li>
<li 
  class="enumerate" id="x1-118019x2">
     <!--l. 6541--><p class="noindent" >In requesting node
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118021x1">
         <!--l. 6543--><p class="noindent" >Collect dist1
         </li>
<li 
  class="enumerate" id="x1-118023x2">
         <!--l. 6544--><p class="noindent" >Aggregate dist1
         </li>
<li 
  class="enumerate" id="x1-118025x3">
         <!--l. 6545--><p class="noindent" >Sort/limit dist1
         </li>
<li 
  class="enumerate" id="x1-118027x4">
         <!--l. 6546--><p class="noindent" >Collect dist2
         </li>
<li 
  class="enumerate" id="x1-118029x5">
         <!--l. 6547--><p class="noindent" >Perform the join</li></ol>
     </li></ol>
<!--l. 6550--><p class="noindent" >But this can be improved by creating a subplan that handles order/limit under join and broadcasting the subplan to pull
the collect above the join. The idea is that TOP10 among all the data is the same that the TOP10 among all the
TOP10s in each node:
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-118031x1">
     <!--l. 6555--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118033x1">
         <!--l. 6557--><p class="noindent" >Scan dist1
                                                                                            
                                                                                            
         </li>
<li 
  class="enumerate" id="x1-118035x2">
         <!--l. 6558--><p class="noindent" >Preaggregate: get TOP10 of the node</li></ol>
     </li>
<li 
  class="enumerate" id="x1-118037x2">
     <!--l. 6560--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118039x1">
         <!--l. 6562--><p class="noindent" >Collect TOP10 of each node
         </li>
<li 
  class="enumerate" id="x1-118041x2">
         <!--l. 6563--><p class="noindent" >Merge all TOP10
         </li>
<li 
  class="enumerate" id="x1-118043x3">
         <!--l. 6564--><p class="noindent" >Sort/limit and get final TOP10
         </li>
<li 
  class="enumerate" id="x1-118045x4">
         <!--l. 6565--><p class="noindent" >Broadcast this TOP10 to all nodes</li></ol>
     </li>
<li 
  class="enumerate" id="x1-118047x3">
     <!--l. 6567--><p class="noindent" >In each node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118049x1">
         <!--l. 6569--><p class="noindent" >Scan dist2
         </li>
<li 
  class="enumerate" id="x1-118051x2">
         <!--l. 6570--><p class="noindent" >Join dist2 with broadcasted TOP10</li></ol>
     </li>
<li 
  class="enumerate" id="x1-118053x4">
     <!--l. 6572--><p class="noindent" >In requesting node:
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-118055x1">
         <!--l. 6574--><p class="noindent" >Collect the values</li></ol>
     </li></ol>
                                                                                            
                                                                                            
<!--l. 6578--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-11900012.2"></a>Observations</h5>
<!--l. 6580--><p class="noindent" >As we have seen, the query plans depend heavily on the distribution key.
<!--l. 6583--><p class="indent" >   Runtime also depends on the query, data, the data size, network speed,...
<!--l. 6585--><p class="indent" >   This menas distributed databases require adjusting the distribution keys and queries to each other to achieve high
performance.
<!--l. 6588--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.3   </span> <a 
 id="x1-12000012.3"></a>Distributed transactions</h4>
<!--l. 6590--><p class="noindent" >Ideally, we have ACID transactions: Atomicity, Consistency, Isolation and Durability.
<!--l. 6593--><p class="indent" >   The main distribution challenges are:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6595--><p class="noindent" >Atomicity: commit on all nodes or none of them.
     </li>
     <li class="itemize">
     <!--l. 6596--><p class="noindent" >Isolation: see other distributed transactions as commited/aborted</li></ul>
<!--l. 6598--><p class="noindent" >Additionally, it is important to have a mechanism for distributed deadlock detection.
<!--l. 6601--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.3.1   </span> <a 
 id="x1-12100012.3.1"></a>Atomicity</h5>
<!--l. 6603--><p class="noindent" >Atomicity is achieved through 2PC (2-Phase Commit):
     <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-121001x12.3.1">
     <!--l. 6605--><p class="noindent" >Store transactions on all nodes
     </li>
<li 
  class="enumerate" id="x1-121002x12.3.1">
     <!--l. 6606--><p class="noindent" >Store final commit decision and
         <ol  class="enumerate2" >
<li 
  class="enumerate" id="x1-121004x1">
         <!--l. 6608--><p class="noindent" >If success: commit all stored transactions
         </li>
<li 
  class="enumerate" id="x1-121006x2">
         <!--l. 6609--><p class="noindent" >If error: abort all prepared transactions</li></ol>
     </li>
<li 
  class="enumerate" id="x1-121007x12.3.1">
     <!--l. 6611--><p class="noindent" >Commit/abort prepared transactions after system failure</li></ol>
                                                                                            
                                                                                            
<!--l. 6614--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.3.2   </span> <a 
 id="x1-12200012.3.2"></a>Isolation</h5>
<!--l. 6616--><p class="noindent" >If we query different nodes at different times, we may see a concurrent transaction as commited on one node, but not
yet committed on another one.
<!--l. 6620--><p class="indent" >   <span 
class="ecbx-1000">Distributed snapshot isolation </span>means we have the same view of what is commited and what not on all
nodes.
<!--l. 6623--><p class="indent" >   We must also ensure <span 
class="ecbx-1000">consistency</span>: any preceding write is seen as committed.
<!--l. 6626--><p class="indent" >   A common approach is to add a timestamp to each query, so queries see all commits with lower timestamps.
<!--l. 6629--><p class="indent" >   There are different ways of dealing with clock synchronization:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6631--><p class="noindent" ><span 
class="ecbx-1000">TrueTime</span>: synchronize clocks using GPS/atomic clocks. Commits pause until all clock move past commit
     time.
     </li>
     <li class="itemize">
     <!--l. 6633--><p class="noindent" ><span 
class="ecbx-1000">Clock-SI</span>: queries collect current time from all nodes involved, pick the highest timestamp and wait for
     it to pass.
     </li>
     <li class="itemize">
     <!--l. 6635--><p class="noindent" ><span 
class="ecbx-1000">HLC (Hybrid Logical Clocks)</span>: they are increased whenever an event occurs or a message from another
     node is received with a higher timestamp.</li></ul>
<!--l. 6640--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.3.3   </span> <a 
 id="x1-12300012.3.3"></a>Considerations</h5>
<!--l. 6642--><p class="noindent" >Fully resolving a 2PC might take time in case of system failure.
<!--l. 6644--><p class="indent" >   Distributed deadlock detection is essential to stability, but not always implemented.
<!--l. 6647--><p class="indent" >   Snapshot isolation avoids seeing partially committed transactions, but at a cost, and read-your-writes consistency
can be at risk.
<!--l. 6650--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.4   </span> <a 
 id="x1-12400012.4"></a>Replication</h4>
<!--l. 6652--><p class="noindent" >Replication means to store the same data in different nodes. It can be useful for:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6655--><p class="noindent" >Availability: resume from replica in case of node failure.
     </li>
     <li class="itemize">
     <!--l. 6656--><p class="noindent" >Durability: restore from replica in case of disk failure.
     </li>
     <li class="itemize">
     <!--l. 6657--><p class="noindent" >Read throughput: divide reads across read replicas.
     </li>
     <li class="itemize">
     <!--l. 6658--><p class="noindent" >Read latency: local/nearby replica gives lower read latency.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 6659--><p class="noindent" >Write latency: local/nearby replica gives lower write latency.</li></ul>
<!--l. 6662--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.4.1   </span> <a 
 id="x1-12500012.4.1"></a>Quorums</h5>
<!--l. 6664--><p class="noindent" >The basic idea is to read from R nodes and write to W nodes, where R+W&#x003E;N, being N the total number of
nodes.
<!--l. 6667--><p class="indent" >   The challenge is to apply events in the same order wverywhere.
<!--l. 6669--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.4.2   </span> <a 
 id="x1-12600012.4.2"></a>Follow the leader</h5>
<!--l. 6671--><p class="noindent" >We can also assign a temporary leader to serialize writes efficiently. This leader would then feed the rest of the nodes
with the new data.
<!--l. 6674--><p class="indent" >   If one node fails (<span 
class="ecbx-1000">standby fail</span>), the leader will continue writing to other replica.
<!--l. 6677--><p class="indent" >   If the leader fails (<span 
class="ecbx-1000">primary fail</span>), a failover is initiated, a replica is promoted to leader and the rest of the replicas
follow the new leader.
<!--l. 6681--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">12.4.3   </span> <a 
 id="x1-12700012.4.3"></a>N-directional</h5>
<!--l. 6683--><p class="noindent" >All nodes accept writes and then decide how to reconcile conflicting changes.
<!--l. 6686--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.5   </span> <a 
 id="x1-12800012.5"></a>CAP theorem</h4>
<!--l. 6688--><p class="noindent" >Basically, the CAP theorem states that a database can only have two out of the three properties: <span 
class="ecbx-1000">C</span>onsistency,
<span 
class="ecbx-1000">A</span>vailability and <span 
class="ecbx-1000">P</span>artitioning. In the case of distributed databases, partitioning is a must, so one must decide between
C and A (note, nonetheless, that even though the theorem ensure that one cannot get the three properties in their most
strict form, it is possible to have them in relaxed, yet good, ways). So, basically, according to this theorem, we need to
decide between:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6697--><p class="noindent" >Availability (AP): keep writing to a minority of nodes, and the majority does not see it.
     </li>
     <li class="itemize">
     <!--l. 6699--><p class="noindent" >Consistency (CP): make writes/reads temporary unavailable because consistency must be preserved.</li></ul>
<!--l. 6702--><p class="noindent" >But this is an incomplete picture of the trade-offs that appear in a distributed database.
<!--l. 6705--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.6   </span> <a 
 id="x1-12900012.6"></a>PACELC theorem</h4>
<!--l. 6707--><p class="noindent" >This is an improved version of the CAP theorem, but is still oversimplified:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6709--><p class="noindent" >If network <span 
class="ecbx-1000">P</span>artition: choose <span 
class="ecbx-1000">A</span>vailability or <span 
class="ecbx-1000">C</span>onsistency.
                                                                                            
                                                                                            
     </li>
     <li class="itemize">
     <!--l. 6710--><p class="noindent" ><span 
class="ecbx-1000">E</span>lse: choose <span 
class="ecbx-1000">L</span>atency or <span 
class="ecbx-1000">C</span>onsistency.</li></ul>
<!--l. 6713--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">12.7   </span> <a 
 id="x1-13000012.7"></a>More trade-offs</h4>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 6715--><p class="noindent" >Consistency: read-your-writes, no lost updates, linearizability
     </li>
     <li class="itemize">
     <!--l. 6716--><p class="noindent" >Availability: for reads, for writes, handle availability zone failure
     </li>
     <li class="itemize">
     <!--l. 6717--><p class="noindent" >Partition-tolerance: for reads, for writes.
     </li>
     <li class="itemize">
     <!--l. 6718--><p class="noindent" >Durability: node failure does not result in data loss, writes are archived in a timely manner.
     </li>
     <li class="itemize">
     <!--l. 6720--><p class="noindent" >Low latency: low read latency, low write latency, global latency VS local latency.
     </li>
     <li class="itemize">
     <!--l. 6722--><p class="noindent" >Complexity: dependencies on other systems, multiple node types, optimizations.</li></ul>
<!--l. 6724--><p class="noindent" >
                                                                                            
                                                                                            
   <h3 class="likesectionHead"><a 
 id="x1-13100012.7"></a>References</h3>
<!--l. 1--><p class="noindent" >
   <div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="XsystemR"></a>M.&#x00A0;M. Astrahan, M.&#x00A0;W. Blasgen, D.&#x00A0;D. Chamberlin, K.&#x00A0;P. Eswaran, J.&#x00A0;N. Gray, P.&#x00A0;P. Griffiths, W.&#x00A0;F.
   King, R.&#x00A0;A. Lorie, P.&#x00A0;R. McJones, J.&#x00A0;W. Mehl, G.&#x00A0;R. Putzolu, I.&#x00A0;L. Traiger, B.&#x00A0;W. Wade, and V.&#x00A0;Watson.
   System r: Relational approach to database management. <span 
class="ecti-1000">ACM Transactional Database Systems</span>.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xgarcia2002"></a>Hector Garcia-Molina, Jeffrey Ullman&#x00A0;D, and Jennifer Widom. <span 
class="ecti-1000">Database Systems: The Complete Book</span>.
   01 2002.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [3]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="XSakr2022"></a>Mahmoud Sakr. Infoh417 database systems architecture. Lecture Notes.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [4]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="XSQLtoRA"></a>Jan Van&#x00A0;den Bussche and Stijn Vansummeren. Translating sql into the relational algebra.
</p>
   </div>
    
</body></html> 

                                                                                            
                                                                                            
                                                                                            


